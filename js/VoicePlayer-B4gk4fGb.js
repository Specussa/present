import{a2 as ee,a3 as oe,a4 as ae,a5 as te,a6 as re,a7 as ne}from"./vendor-@element-plus-DBVaehOC.js";import{E as A}from"./vendor-element-plus-Dx0wd8qm.js";import{d as ie,b as r,e as s,m as le,U as se,al as $,o as g,c as x,R as N,a as h,u as b,E as U,Q as ce,a4 as ue,M as E,I,D as q}from"./vendor-@vue-Bz_wJ882.js";import{u as H}from"./vendor-vue-i18n-DztdJ-Qd.js";import{_ as ve}from"./index-DtGRqvgB.js";const de={class:"voice"},me={class:"voice__controls"},pe={class:"voice__controls_left"},_e={key:0,class:"voice__membrane"},fe={class:"voice__waves"},ge={class:"voice__controls_right"},he=ie({__name:"VoicePlayer",emits:["toggleHelp","send"],setup(be,{emit:G}){const{locale:L}=H(),{t}=H(),a={micDenied:r(()=>t("voice.microphoneDenied")),micNotFound:r(()=>t("voice.microphoneNotFound")),browserNoMic:r(()=>t("voice.browserNoMicrophone")),micError:r(()=>t("voice.microphoneError")),browserNoMedia:r(()=>t("voice.browserNoMedia")),allowMic:r(()=>t("voice.allowMicrophone")),micConnected:r(()=>t("voice.microphoneConnected")),browserNoSpeech:r(()=>t("voice.browserNoSpeech")),speechNotSupported:r(()=>t("voice.speechNotSupported")),recognitionInterrupted:r(()=>t("voice.recognitionInterrupted")),speechNotDetected:r(()=>t("voice.speechNotDetected")),recordingStarted:r(()=>t("voice.recordingStarted")),recordingStopped:r(()=>t("voice.recordingStopped")),startRecordError:r(()=>t("voice.startRecordingError")),stopRecordError:r(()=>t("voice.stopRecordingError")),networkIssues:r(()=>t("voice.networkIssues")),error:r(()=>t("voice.error")),textCleared:r(()=>t("voice.textCleared")),messagePlaceholder:r(()=>t("voice.messagePlaceholder"))},_=s(""),v=s(!1),F=s(!1),d=s(!1),u=s(!1),V=s(!1),i=s(null),C=s(""),f=s(null),p=s(null),S=s(null),w=s(0),R=s(!1),k=s(null),Q=async e=>{try{k.value=e,f.value=new AudioContext,p.value=f.value.createAnalyser();const o=f.value.createMediaStreamSource(e);p.value.fftSize=256,p.value.smoothingTimeConstant=.8,o.connect(p.value),j()}catch(o){console.error("Error initializing audio analyzer:",o)}},j=()=>{R.value=!0;const e=()=>{if(!p.value||!R.value)return;const o=new Uint8Array(p.value.frequencyBinCount);p.value.getByteFrequencyData(o);let m=0;for(let c=0;c<o.length;c++)m+=o[c];const l=m/o.length;w.value=Math.min(l/100,1),S.value=requestAnimationFrame(e)};e()},D=()=>{R.value=!1,w.value=0,S.value&&(cancelAnimationFrame(S.value),S.value=null),k.value&&(k.value.getTracks().forEach(e=>e.stop()),k.value=null),f.value&&(f.value.close(),f.value=null),p.value=null},J=()=>{const e=window.SpeechRecognition||window.webkitSpeechRecognition;return d.value=!!e,!!e},n=e=>{A.error(e)},y=e=>{A.info(e)},K=e=>{A.success(e)},z=async()=>{var e;if(!((e=navigator.mediaDevices)!=null&&e.getUserMedia))return n(a.browserNoMedia.value),!1;V.value=!0;try{const o=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1});return await Q(o),u.value=!1,P(),K(a.micConnected.value),!0}catch(o){return u.value=!0,o instanceof Error?o.name==="NotAllowedError"?n(a.micDenied.value):o.name==="NotFoundError"?n(a.micNotFound.value):o.name==="NotSupportedError"?n(a.browserNoMic.value):n(a.micError.value):n(a.micError.value),!1}finally{V.value=!1}},P=()=>{if(!J()){n(a.browserNoSpeech.value);return}const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e){n(a.speechNotSupported.value);return}i.value=new e,i.value.continuous=!0,i.value.interimResults=!0,i.value.lang=L.value,i.value.onstart=()=>{v.value=!0,y(a.recordingStarted.value)},i.value.onresult=o=>{let m="";for(let l=o.resultIndex;l<o.results.length;l++){const c=o.results[l],B=c[0].transcript;c.isFinal?C.value+=B+" ":m+=B}_.value=C.value+m},i.value.onerror=o=>{switch(o.error){case"not-allowed":case"service-not-allowed":u.value=!0,n(a.micDenied.value);break;case"audio-capture":n(a.micNotFound.value);break;case"aborted":n(a.recognitionInterrupted.value);break;case"network":n(a.networkIssues.value);break;case"no-speech":y(a.speechNotDetected.value);break;default:n(`${a.error.value}: ${o.error}`)}M()},i.value.onend=()=>{v.value&&!F.value&&i.value?setTimeout(()=>{if(v.value&&i.value)try{i.value.start()}catch{M()}},100):(v.value=!1,y(a.recordingStopped.value))}},T=async()=>{d.value&&(u.value&&!await z()||(v.value?M():O()))},O=()=>{if(i.value)try{i.value.start(),y(a.recordingStarted.value)}catch(e){e instanceof Error&&(e.message.includes("permission")||e.name==="NotAllowedError")?(u.value=!0,D(),n(a.allowMic.value)):n(a.startRecordError.value)}},M=()=>{if(i.value)try{i.value.stop(),v.value=!1,F.value=!1,D()}catch{n(a.stopRecordError.value)}},W=()=>{_.value="",C.value="",y(a.textCleared.value)},X=async()=>{var e;try{if(!((e=navigator.mediaDevices)!=null&&e.enumerateDevices)){u.value=!0;return}const m=(await navigator.mediaDevices.enumerateDevices()).some(l=>l.kind==="audioinput"&&l.label!=="");u.value=!m}catch{u.value=!0}};le(async()=>{await X(),P()}),se(()=>{D()});const Y=G,Z=()=>{Y("toggleHelp")};return(e,o)=>{const m=$("el-input"),l=$("el-button");return g(),x("div",de,[N(m,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=c=>_.value=c),type:"textarea",placeholder:a.messagePlaceholder.value,rows:6,resize:"none",class:"voice__textarea"},null,8,["modelValue","placeholder"]),h("div",me,[h("div",pe,[N(l,{type:"success",onClick:o[1]||(o[1]=c=>e.$emit("send",_.value)),class:"voice__btn voice__btn_help",disabled:!_.value,icon:b(ee),circle:""},null,8,["disabled","icon"]),N(l,{type:"primary",onClick:Z,class:"voice__btn voice__btn_send",icon:b(oe),circle:""},null,8,["icon"])]),v.value&&!u.value?(g(),x("div",_e,[h("div",{class:"voice__visualizer",style:U({transform:`scale(${.8+w.value*.4})`,opacity:.7+w.value*.3})},[h("div",fe,[(g(),x(ce,null,ue(3,c=>h("div",{key:c,class:"voice__wave",style:U({animationDelay:`${c*.2}s`,transform:`scale(${1+w.value*c*.3})`})},null,4)),64))])],4)])):E("",!0),h("div",ge,[u.value&&d.value?(g(),I(l,{key:0,type:"warning",onClick:z,class:"voice__btn voice__btn_permission",icon:b(ae),circle:""},null,8,["icon"])):E("",!0),!u.value&&d.value&&v.value?(g(),I(l,{key:1,type:"primary",onClick:T,class:q(["voice__btn",{voice__btn_recording:v.value,voice__btn_disabled:!d.value}]),disabled:!d.value,icon:b(te),circle:""},null,8,["class","disabled","icon"])):E("",!0),!u.value&&d.value?(g(),I(l,{key:2,type:"danger",onClick:T,class:q(["voice__btn",{voice__btn_recording:v.value,voice__btn_disabled:!d.value}]),disabled:!d.value,icon:b(re),circle:""},null,8,["class","disabled","icon"])):E("",!0),N(l,{type:"danger",onClick:W,class:"voice__btn voice__btn_clear",disabled:!_.value,icon:b(ne),circle:""},null,8,["disabled","icon"])])])])}}}),Ee=ve(he,[["__scopeId","data-v-ce2f160f"]]);export{Ee as V};
