import{g as $e,o as Me,A as le,T as re}from"./index-CeIVK-MH.js";import{H as Ye}from"./Header-DO_1jpz7.js";import{F as Ie}from"./Footer-BLXiLM6S.js";import{G as Be}from"./GoBack-XUseLnKq.js";import{R as Ee}from"./ReportsFaq-DJOpMsXe.js";import{B as Ae}from"./Back-Bt820i-G.js";import{P as Te}from"./Preloader-DrdSGP2z.js";import{E as k}from"./vendor-element-plus-DdPevIeu.js";import{d as Pe,e as h,b as T,f as j,k as Fe,m as ne,U as ie,c as b,R as o,I as w,a as e,P as u,u as p,J as d,Q as x,a4 as Y,M as S,K as Oe,D as P,al as m,ar as Le,o as i,O as D}from"./vendor-@vue-Bz_wJ882.js";import{u as Ue}from"./vendor-vue-i18n-DztdJ-Qd.js";import{_ as ze}from"./LogoSVG-DbKoxXUD.js";import"./vendor-geotiff-CNG5SH6k.js";import"./vendor-xml-utils-DQPdAQjV.js";import"./vendor-dayjs-B_aAqRSu.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-BuCIBY1L.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-vue-router-0eOeNsIj.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-@element-plus-l10nAwNe.js";import"./vendor-vue-tel-input-BG99aFNs.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-lodash-es-Cq1PUQc0.js";import"./vendor-@vueuse-DRxsj0DG.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";import"./VideoPlayer-3QfyBQ52.js";const Ke={key:1,class:"reports"},Ne={class:"reports__container container"},We={class:"reports__block"},je={class:"reports__flex list_flex"},qe={key:0,class:"reports__left list_left"},Qe={class:"reports__scroll list_scroll"},Ge={class:"reports__top"},He={class:"reports__head"},Je={class:"reports__title"},Xe={class:"reports__form"},Ze={class:"reports__standart"},et={class:"reports__date-range"},tt={class:"reports__date_item full-width"},st={class:"reports__standart_label text_three"},ot={class:"reports__buttons"},at={class:"reports__available"},lt={class:"reports__available_head"},rt={class:"reports__available_title"},nt={class:"reports__net_count el-table_count text_four"},it={class:"reports__available_content"},pt={class:"reports__available_desc text_two"},_t={class:"reports__available_list"},ct={class:"reports__right list_right"},dt={class:"breadcrumbs"},ut={class:"breadcrumbs__list"},mt={class:"breadcrumbs__item"},vt={class:"breadcrumbs__item"},bt={class:"breadcrumbs__item"},ht=["title"],gt={class:"faq__icon"},ft={key:0,class:"reports__mobile_controls"},yt={class:"reports__mobile_management"},kt={class:"reports__head"},wt={class:"reports__title"},Dt={class:"reports__form"},Ct={class:"reports__date-range"},xt={class:"reports__date_item full-width"},St={class:"reports__standart_label text_three"},Vt={class:"reports__buttons"},Rt={class:"reports__mobile_columns"},$t={class:"reports__available_head"},Mt={class:"reports__net_count el-table_count text_four"},Yt={key:1,class:"reports__net"},It={class:"reports__net_head"},Bt={class:"reports__net_title"},Et={class:"reports__net_count el-table_count text_four"},At={class:"reports__net_list"},Tt=["onDragstart","onDrop"],Pt={key:0,class:"reports__empty"},Ft={class:"reports__table"},Ot={class:"reports__table_head"},Lt={class:"reports__table_title"},Ut={key:0,class:"el-table_count text_four"},zt={key:0,class:"reports__table_footer"},Kt={class:"reset_popup__scroll popup__scroll_buttons"},Nt={class:"reset_popup__block popup__block"},Wt={class:"reset_popup__head popup__head"},jt={class:"reset_popup__message popup__message text_two"},qt={class:"popup__buttons"},Qt={class:"ipopup__scroll popup__scroll"},Gt={class:"ipopup__block popup__block"},Ht=Pe({__name:"Reports",setup(Jt){const{t:_}=Ue(),V=h(!1),K=h(!1),F=h(!1),N=()=>{F.value=!F.value,K.value=!K.value,F.value?document.documentElement.classList.add("noscroll"):document.documentElement.classList.remove("noscroll")},I=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],O=h([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),R=h(""),q=T(()=>_("reports.constructor")),pe=T(()=>{if(!R.value)return q.value;const s=r.value.map(n=>n.prop),t=O.value.find(n=>n.columns.length===s.length&&n.columns.every(l=>s.includes(l)));return t?t.name:q.value});j(R,s=>{if(!s)return;const t=O.value.find(l=>l.name===s);if(!t)return;const n=[];t.columns.forEach(l=>{const c=I.find(v=>v.prop===l);c&&n.push({...c})}),n.length>0&&(r.value=n,k.success(`Применен набор "${s}"`))});const r=h([]),f=h([]),g=Fe({startDate:"",endDate:""}),B=h(null),E=h(null),_e=T(()=>{const s={};return I.forEach(t=>{s[t.category]||(s[t.category]=[]),s[t.category].push(t)}),s}),ce=T(()=>{const s=r.value.map(t=>t.prop);return I.filter(t=>!s.includes(t.prop))}),de=T(()=>!!g.startDate&&!!g.endDate),ue={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},W=s=>{const t=r.value.findIndex(n=>n.prop===s.prop);if(t>=0){if(r.value.length<=0){k.warning("Должен остаться хотя бы один столбец");return}r.value.splice(t,1),k.success(`Столбец "${s.label}" удален`)}else r.value.push({...s}),k.success(`Столбец "${s.label}" добавлен`)},me=s=>{E.value=s},ve=s=>{s.preventDefault()},be=s=>{if(E.value===null||E.value===s)return;const t=r.value.splice(E.value,1)[0];r.value.splice(s,0,t),E.value=null},Q=async()=>{if(!de.value){k.warning("Пожалуйста, выберите диапазон дат");return}V.value=!0;try{const s=await he();f.value=s.data,k.success(`Загружено ${s.data.length} записей`)}catch(s){k.error("Ошибка при загрузке данных"),console.error("API Error:",s)}finally{V.value=!1}},he=()=>new Promise(s=>{setTimeout(()=>{const t=Array.from({length:15},(n,l)=>{const c={id:l+1};return r.value.forEach(v=>{if(v.prop!=="id")switch(v.type){case"number":c[v.prop]=Math.floor(Math.random()*1e3);break;case"date":c[v.prop]=new Date().toISOString().split("T")[0];break;case"datetime":c[v.prop]=new Date().toISOString();break;default:c[v.prop]=`Значение ${l+1} для ${v.label}`}}),c});s({data:t})},1e3)}),G=()=>{if(f.value.length===0){k.warning("Нет данных для экспорта");return}const s=r.value.map(v=>`"${v.label}"`).join(","),t=f.value.map(v=>r.value.map(U=>`"${v[U.prop]||""}"`).join(",")).join(`
`),n=`data:text/csv;charset=utf-8,${s}
${t}`,l=encodeURI(n),c=document.createElement("a");c.setAttribute("href",l),c.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)},C=h(!1),H=()=>{C.value=!0},ge=()=>{r.value=[],A.value=[],g.startDate="",g.endDate="",B.value=null,f.value=[],R.value="",C.value=!1,k.success("Таблица сброшена")},J=s=>{if(s&&s[0]&&s[1]){const t=typeof s[0]=="string"?new Date(s[0]):s[0],n=typeof s[1]=="string"?new Date(s[1]):s[1];g.startDate=t.toISOString().split("T")[0],g.endDate=n.toISOString().split("T")[0]}else g.startDate="",g.endDate=""},A=h([]);j(r,s=>{A.value=s.map(t=>t.prop)},{deep:!0});const fe=s=>{const t=[];s.forEach(n=>{const l=I.find(c=>c.prop===n);l&&t.push({...l})}),t.length>0?r.value=t:s.length===0&&r.value.length>0&&(A.value=r.value.map(n=>n.prop),k.warning("Должен остаться хотя бы один столбец"))};j(r,s=>{const t=s.map(l=>l.prop),n=O.value.find(l=>l.columns.length===t.length&&l.columns.every(c=>t.includes(c)));R.value=n?n.name:""},{deep:!0});const L=h(window.innerWidth),X=()=>{L.value=window.innerWidth};ne(()=>{window.addEventListener("resize",X)}),ie(()=>{window.removeEventListener("resize",X)});const Z=h($e(le.BACK,!1));return ne(()=>{const s=Me(t=>{Z.value=t},le.BACK);ie(()=>{s()})}),(s,t)=>{const n=m("BrushFilled"),l=m("el-icon"),c=m("el-option"),v=m("el-select"),U=m("el-date-picker"),ee=m("Search"),z=m("el-button"),te=m("Download"),ye=m("Plus"),ke=m("Close"),se=m("el-tag"),oe=m("RouterLink"),we=m("QuestionFilled"),De=m("Rank"),Ce=m("el-empty"),xe=m("el-table-column"),Se=m("el-table"),Ve=m("el-pagination"),ae=m("CloseBold"),Re=Le("loading");return i(),b(x,null,[o(Ye),V.value?(i(),w(Te,{key:0})):(i(),b("section",Ke,[e("div",Ne,[e("div",We,[e("div",je,[L.value>=1280?(i(),b("div",qe,[e("div",Qe,[e("div",Ge,[e("div",He,[e("span",Je,u(p(_)("reports.reportManagement")),1),e("button",{onClick:H,class:"reports__reset"},[o(l,null,{default:d(()=>[o(n)]),_:1})])]),e("div",Xe,[e("div",Ze,[t[8]||(t[8]=e("label",{class:"reports__standart_label text_three"},"Набор столбцов:",-1)),o(v,{modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=a=>R.value=a),placeholder:pe.value,class:"reports__standart_select"},{default:d(()=>[(i(!0),b(x,null,Y(O.value,a=>(i(),w(c,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128)),o(c,{label:p(_)("reports.constructor"),value:""},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),e("div",et,[e("div",tt,[e("label",st,u(p(_)("table.dateRange"))+":",1),o(U,{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=a=>B.value=a),type:"daterange","range-separator":"—","start-placeholder":p(_)("table.startDate"),"end-placeholder":p(_)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:J,"unlink-panels":!1},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",ot,[o(z,{type:"primary",onClick:Q,loading:V.value,disabled:!g.startDate||!g.endDate||r.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(ee)]),_:1}),t[9]||(t[9]=D(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:G,disabled:f.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(te)]),_:1}),t[10]||(t[10]=D(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",at,[e("div",lt,[e("span",rt,u(p(_)("reports.availableColumns")),1),e("span",nt,u(ce.value.length),1)]),e("div",it,[(i(!0),b(x,null,Y(_e.value,(a,$)=>(i(),b("div",{key:$,class:"reports__available_group"},[e("p",pt,u(ue[$]||$),1),e("div",_t,[(i(!0),b(x,null,Y(a,y=>(i(),w(se,{key:y.prop,type:r.value.some(M=>M.prop===y.prop)?"success":"primary",closable:!1,class:P(["reports__available_tag",{active:r.value.some(M=>M.prop===y.prop)}]),onClick:M=>W(y)},{default:d(()=>[D(u(y.label)+" ",1),o(l,{class:"reports__available_icon"},{default:d(()=>[r.value.some(M=>M.prop===y.prop)?(i(),w(ke,{key:1})):(i(),w(ye,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])])])])):S("",!0),e("div",ct,[e("div",dt,[e("ul",ut,[e("li",mt,[o(Be)]),e("li",vt,[o(oe,{class:"breadcrumbs__link text_four",to:p(re).i18nRoute({name:"preloader"})},{default:d(()=>[D(u(p(_)("header.home")),1)]),_:1},8,["to"])]),e("li",bt,[o(oe,{class:"breadcrumbs__link text_four",to:p(re).i18nRoute({name:"reports"})},{default:d(()=>[D(u(p(_)("header.reports")),1)]),_:1},8,["to"])])]),e("button",{class:"breadcrumbs__instructions title_three",title:p(_)("header.instructions"),onClick:N},[e("span",gt,[o(l,null,{default:d(()=>[o(we)]),_:1})])],8,ht)]),L.value<1280?(i(),b("div",ft,[e("div",yt,[e("div",kt,[e("span",wt,u(p(_)("reports.reportManagement")),1),e("button",{onClick:t[2]||(t[2]=a=>H()),class:"reports__reset"},[o(l,null,{default:d(()=>[o(n)]),_:1})])]),e("div",Dt,[e("div",Ct,[e("div",xt,[e("label",St,u(p(_)("table.dateRange"))+":",1),o(U,{modelValue:B.value,"onUpdate:modelValue":t[3]||(t[3]=a=>B.value=a),type:"daterange","range-separator":"—","start-placeholder":p(_)("table.startDate"),"end-placeholder":p(_)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:J},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",Vt,[o(z,{type:"primary",onClick:Q,loading:V.value,disabled:!g.startDate||!g.endDate||r.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(ee)]),_:1}),t[11]||(t[11]=D(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:G,disabled:f.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(te)]),_:1}),t[12]||(t[12]=D(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",Rt,[e("div",$t,[t[13]||(t[13]=e("span",{class:"reports__available_title"},"Выбор столбцов",-1)),e("span",Mt,u(r.value.length),1)]),o(v,{modelValue:A.value,"onUpdate:modelValue":t[4]||(t[4]=a=>A.value=a),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Выберите столбцы",class:"reports__mobile_select",onChange:fe},{default:d(()=>[(i(),b(x,null,Y(I,a=>o(c,{key:a.prop,label:a.label,value:a.prop},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):S("",!0),L.value>=1280?(i(),b("div",Yt,[e("div",It,[e("span",Bt,u(p(_)("reports.activeColumns")),1),e("span",Et,u(r.value.length),1)]),e("div",At,[(i(!0),b(x,null,Y(r.value,(a,$)=>(i(),b("div",{key:a.prop,class:"reports__net_item",draggable:"true",onDragstart:y=>me($),onDragover:ve,onDrop:y=>be($)},[o(se,{closable:"","disable-transitions":!1,onClose:y=>W(a),onClick:y=>W(a),class:"reports__available_tag reports__available_grab"},{default:d(()=>[o(l,{class:"reports__drag"},{default:d(()=>[o(De)]),_:1}),D(" "+u(a.label),1)]),_:2},1032,["onClose","onClick"])],40,Tt))),128)),r.value.length===0?(i(),b("div",Pt,[o(Ce,{description:p(_)("reports.addColumns"),"image-size":60},null,8,["description"])])):S("",!0)])])):S("",!0),e("div",Ft,[e("div",Ot,[e("span",Lt,u(p(_)("reports.reportData")),1),f.value.length>0?(i(),b("span",Ut,u(f.value.length),1)):S("",!0)]),Oe((i(),w(Se,{data:f.value,border:"",stripe:"",style:{width:"100%"},"empty-text":p(_)("table.noData"),class:"reports__table_element"},{default:d(()=>[(i(!0),b(x,null,Y(r.value,a=>(i(),w(xe,{key:a.prop,prop:a.prop,label:a.label,"min-width":a.width,sortable:a.sortable},null,8,["prop","label","min-width","sortable"]))),128))]),_:1},8,["data","empty-text"])),[[Re,V.value]]),f.value.length>0?(i(),b("div",zt,[o(Ve,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:f.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):S("",!0)]),Z.value?(i(),w(Ae,{key:2})):S("",!0)])])])])])),e("div",{class:P(["overlay_full",{active:C.value}]),onClick:t[5]||(t[5]=a=>C.value=!1)},null,2),e("div",{class:P(["reset_popup popup popup__small",{active:C.value}])},[e("div",Kt,[e("div",Nt,[e("button",{class:"reset_popup__close popup__close",onClick:t[6]||(t[6]=a=>C.value=!1)},[o(l,null,{default:d(()=>[o(ae)]),_:1})]),e("h4",Wt,u(p(_)("reports.resetTable")),1),e("p",jt,u(p(_)("reports.resetMessage")),1)])]),e("div",qt,[e("button",{class:"popup__button button__second button",onClick:t[7]||(t[7]=a=>C.value=!1)},[e("span",null,u(p(_)("button.cancel")),1)]),e("button",{class:"popup__button button__primary button",onClick:ge},[e("span",null,u(p(_)("button.clear")),1)])])],2),e("div",{class:P(["overlay_full",{active:K.value}]),onClick:N},null,2),e("div",{class:P(["ipopup popup",{active:F.value}])},[e("div",Qt,[e("div",Gt,[e("button",{class:"ipopup__close popup__close",onClick:N},[o(l,null,{default:d(()=>[o(ae)]),_:1})]),o(Ee)])])],2),o(Ie)],64)}}}),Is=ze(Ht,[["__scopeId","data-v-4e2dacf6"]]);export{Is as default};
