import{H as ce}from"./Header-DYBkyk_B.js";import{F as _e}from"./Footer-DnMac6lQ.js";import{E as b,a as ue}from"./vendor-element-plus-DLLATbAB.js";import{d as ve,b as h,k as P,e as A,X as me,j as ge,S as be,c as _,Q as r,a,I as d,O as y,P as w,a4 as S,L as V,J as he,H as M,al as u,ar as fe,o as p,M as f,C as ye}from"./vendor-@vue-Cg4sS8W0.js";import{_ as we}from"./index-DcG0OPbQ.js";import"./LogoSVG-B87iPVjo.js";import"./vendor-vue-router-BMJZZRG0.js";import"./vendor-vue-i18n-D0pj9gOW.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-@element-plus-Bv-RgaI4.js";import"./vendor-lodash-es-C-zDejYo.js";import"./vendor-@vueuse-D3zzmj5p.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-dayjs-D6RD0Zoz.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";import"./vendor-geotiff-BjC_-_Sy.js";import"./vendor-xml-utils-BmThcpyG.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-B0C9zqkp.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-vue-tel-input-BZrepA_w.js";const De={class:"reports"},ke={class:"reports__container container"},Ce={class:"reports__block"},xe={class:"reports__flex list_flex"},Se={key:0,class:"reports__left list_left"},Ve={class:"reports__scroll list_scroll"},Me={class:"reports__top"},Ye={class:"reports__head"},$e={class:"reports__form"},Ie={class:"reports__standart"},Ee={class:"reports__date-range"},Te={class:"reports__date-range-item full-width"},Re={class:"reports__buttons"},Be={class:"reports__available"},Oe={class:"reports__available_head"},Pe={class:"reports__net_count el-table_count text_four"},Ue={class:"reports__available_content"},Ae={class:"reports__available_desc text_two"},ze={class:"reports__available_list"},Le={class:"reports__right list_right"},je={key:0,class:"reports__mobile-controls"},We={class:"reports__mobile-management"},Fe={class:"reports__head"},He={class:"reports__form"},Ne={class:"reports__date-range"},Je={class:"reports__date-range-item full-width"},Qe={class:"reports__buttons"},Xe={class:"reports__mobile-columns"},qe={class:"reports__available_head"},Ge={class:"reports__net_count el-table_count text_four"},Ke={key:1,class:"reports__net"},Ze={class:"reports__net_head"},et={class:"reports__net_count el-table_count text_four"},tt={class:"reports__net_list"},at=["onDragstart","onDrop"],st={key:0,class:"reports__empty"},ot={class:"reports__table"},lt={class:"reports__table_head"},rt={key:0,class:"el-table_count text_four"},nt={key:0,class:"reports__table_footer"},it=ve({__name:"Reports",setup(pt){const Y=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],R=h([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),D=h(""),J=P(()=>{if(!D.value)return"Конструктор";const t=o.value.map(s=>s.prop),e=R.value.find(s=>s.columns.length===t.length&&s.columns.every(n=>t.includes(n)));return e?e.name:"Конструктор"});A(D,t=>{if(!t)return;const e=R.value.find(n=>n.name===t);if(!e)return;const s=[];e.columns.forEach(n=>{const i=Y.find(c=>c.prop===n);i&&s.push({...i})}),s.length>0&&(o.value=s,b.success(`Применен набор "${t}"`))});const o=h([]),m=h([]),$=h(!1),v=me({startDate:"",endDate:""}),I=h(null),E=h(null),Q=P(()=>{const t={};return Y.forEach(e=>{t[e.category]||(t[e.category]=[]),t[e.category].push(e)}),t}),X=P(()=>{const t=o.value.map(e=>e.prop);return Y.filter(e=>!t.includes(e.prop))}),q=P(()=>!!v.startDate&&!!v.endDate),G={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},U=t=>{const e=o.value.findIndex(s=>s.prop===t.prop);if(e>=0){if(o.value.length<=0){b.warning("Должен остаться хотя бы один столбец");return}o.value.splice(e,1),b.success(`Столбец "${t.label}" удален`)}else o.value.push({...t}),b.success(`Столбец "${t.label}" добавлен`)},K=t=>{E.value=t},Z=t=>{t.preventDefault()},ee=t=>{if(E.value===null||E.value===t)return;const e=o.value.splice(E.value,1)[0];o.value.splice(t,0,e),E.value=null},z=async()=>{if(!q.value){b.warning("Пожалуйста, выберите диапазон дат");return}$.value=!0;try{const t=await te();m.value=t.data,b.success(`Загружено ${t.data.length} записей`)}catch(t){b.error("Ошибка при загрузке данных"),console.error("API Error:",t)}finally{$.value=!1}},te=()=>new Promise(t=>{setTimeout(()=>{const e=Array.from({length:15},(s,n)=>{const i={id:n+1};return o.value.forEach(c=>{if(c.prop!=="id")switch(c.type){case"number":i[c.prop]=Math.floor(Math.random()*1e3);break;case"date":i[c.prop]=new Date().toISOString().split("T")[0];break;case"datetime":i[c.prop]=new Date().toISOString();break;default:i[c.prop]=`Значение ${n+1} для ${c.label}`}}),i});t({data:e})},1e3)}),L=()=>{if(m.value.length===0){b.warning("Нет данных для экспорта");return}const t=o.value.map(c=>`"${c.label}"`).join(","),e=m.value.map(c=>o.value.map(O=>`"${c[O.prop]||""}"`).join(",")).join(`
`),s=`data:text/csv;charset=utf-8,${t}
${e}`,n=encodeURI(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},j=async()=>{try{await ue.confirm("Это действие очистит все данные и настройки таблицы. Продолжить?","Сброс таблицы",{confirmButtonText:"Сбросить",cancelButtonText:"Отмена",type:"warning"}),o.value=[],T.value=[],v.startDate="",v.endDate="",I.value=null,m.value=[],D.value="",b.success("Таблица сброшена")}catch{}},W=t=>{if(t&&t[0]&&t[1]){const e=typeof t[0]=="string"?new Date(t[0]):t[0],s=typeof t[1]=="string"?new Date(t[1]):t[1];v.startDate=e.toISOString().split("T")[0],v.endDate=s.toISOString().split("T")[0]}else v.startDate="",v.endDate=""},T=h([]);A(o,t=>{T.value=t.map(e=>e.prop)},{deep:!0});const ae=t=>{const e=[];t.forEach(s=>{const n=Y.find(i=>i.prop===s);n&&e.push({...n})}),e.length>0?o.value=e:t.length===0&&o.value.length>0&&(T.value=o.value.map(s=>s.prop),b.warning("Должен остаться хотя бы один столбец"))};A(o,t=>{const e=t.map(n=>n.prop),s=R.value.find(n=>n.columns.length===e.length&&n.columns.every(i=>e.includes(i)));D.value=s?s.name:""},{deep:!0});const B=h(window.innerWidth),F=()=>{B.value=window.innerWidth};return ge(()=>{window.addEventListener("resize",F)}),be(()=>{window.removeEventListener("resize",F)}),(t,e)=>{const s=u("el-button"),n=u("el-option"),i=u("el-select"),c=u("el-date-picker"),O=u("Search"),k=u("el-icon"),H=u("Download"),se=u("Plus"),oe=u("Close"),N=u("el-tag"),le=u("Rank"),re=u("el-empty"),ne=u("el-table-column"),ie=u("el-table"),pe=u("el-pagination"),de=fe("loading");return p(),_(w,null,[r(ce),a("section",De,[a("div",ke,[a("div",Ce,[a("div",xe,[B.value>=1280?(p(),_("div",Se,[a("div",Ve,[a("div",Me,[a("div",Ye,[e[5]||(e[5]=a("span",{class:"reports__title"},"Управление отчетом",-1)),r(s,{type:"danger",text:"",onClick:j,class:"reports__reset"},{default:d(()=>e[4]||(e[4]=[f("Сбросить")])),_:1})]),a("div",$e,[a("div",Ie,[e[6]||(e[6]=a("label",{class:"reports__standart_label"},"Набор столбцов:",-1)),r(i,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=l=>D.value=l),placeholder:J.value,class:"reports__standart_select"},{default:d(()=>[(p(!0),_(w,null,S(R.value,l=>(p(),M(n,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))),128)),r(n,{label:"Конструктор",value:""})]),_:1},8,["modelValue","placeholder"])]),a("div",Ee,[a("div",Te,[e[7]||(e[7]=a("label",{class:"reports__date-range-label"},"Диапазон дат:",-1)),r(c,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=l=>I.value=l),type:"daterange","range-separator":"до","start-placeholder":"Начальная дата","end-placeholder":"Конечная дата",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date-range-picker",onChange:W,"unlink-panels":!1},null,8,["modelValue"])])]),a("div",Re,[r(s,{type:"primary",onClick:z,loading:$.value,disabled:!v.startDate||!v.endDate||o.value.length===0,class:"reports__button"},{default:d(()=>[r(k,null,{default:d(()=>[r(O)]),_:1}),e[8]||(e[8]=f(" Запросить данные "))]),_:1},8,["loading","disabled"]),r(s,{type:"warning",onClick:L,disabled:m.value.length===0,class:"reports__button"},{default:d(()=>[r(k,null,{default:d(()=>[r(H)]),_:1}),e[9]||(e[9]=f(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),a("div",Be,[a("div",Oe,[e[10]||(e[10]=a("span",{class:"reports__available_title"},"Доступные столбцы",-1)),a("span",Pe,y(X.value.length),1)]),a("div",Ue,[(p(!0),_(w,null,S(Q.value,(l,C)=>(p(),_("div",{key:C,class:"reports__available_group"},[a("p",Ae,y(G[C]||C),1),a("div",ze,[(p(!0),_(w,null,S(l,g=>(p(),M(N,{key:g.prop,type:o.value.some(x=>x.prop===g.prop)?"success":"primary",closable:!1,class:ye(["reports__available_tag",{active:o.value.some(x=>x.prop===g.prop)}]),onClick:x=>U(g)},{default:d(()=>[f(y(g.label)+" ",1),r(k,{class:"reports__available_icon"},{default:d(()=>[o.value.some(x=>x.prop===g.prop)?(p(),M(oe,{key:1})):(p(),M(se,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])])])])):V("",!0),a("div",Le,[B.value<1280?(p(),_("div",je,[a("div",We,[a("div",Fe,[e[12]||(e[12]=a("span",{class:"reports__title"},"Управление отчетом",-1)),r(s,{type:"danger",text:"",onClick:j,class:"reports__reset"},{default:d(()=>e[11]||(e[11]=[f("Сбросить")])),_:1})]),a("div",He,[a("div",Ne,[a("div",Je,[e[13]||(e[13]=a("label",{class:"reports__date-range-label"},"Диапазон дат:",-1)),r(c,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=l=>I.value=l),type:"daterange","range-separator":"до","start-placeholder":"Начальная дата","end-placeholder":"Конечная дата",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date-range-picker",onChange:W},null,8,["modelValue"])])]),a("div",Qe,[r(s,{type:"primary",onClick:z,loading:$.value,disabled:!v.startDate||!v.endDate||o.value.length===0,class:"reports__button"},{default:d(()=>[r(k,null,{default:d(()=>[r(O)]),_:1}),e[14]||(e[14]=f(" Запросить данные "))]),_:1},8,["loading","disabled"]),r(s,{type:"warning",onClick:L,disabled:m.value.length===0,class:"reports__button"},{default:d(()=>[r(k,null,{default:d(()=>[r(H)]),_:1}),e[15]||(e[15]=f(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),a("div",Xe,[a("div",qe,[e[16]||(e[16]=a("span",{class:"reports__available_title"},"Выбор столбцов",-1)),a("span",Ge,y(o.value.length),1)]),r(i,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=l=>T.value=l),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Выберите столбцы",class:"reports__mobile-select",onChange:ae},{default:d(()=>[(p(),_(w,null,S(Y,l=>r(n,{key:l.prop,label:l.label,value:l.prop},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):V("",!0),B.value>=1280?(p(),_("div",Ke,[a("div",Ze,[e[17]||(e[17]=a("span",{class:"reports__net_title"},"Активные столбцы",-1)),a("span",et,y(o.value.length),1)]),a("div",tt,[(p(!0),_(w,null,S(o.value,(l,C)=>(p(),_("div",{key:l.prop,class:"reports__net_item",draggable:"true",onDragstart:g=>K(C),onDragover:Z,onDrop:g=>ee(C)},[r(N,{closable:"","disable-transitions":!1,onClose:g=>U(l),onClick:g=>U(l),class:"reports__available_tag reports__available_grab"},{default:d(()=>[r(k,{class:"reports__drag"},{default:d(()=>[r(le)]),_:1}),f(" "+y(l.label),1)]),_:2},1032,["onClose","onClick"])],40,at))),128)),o.value.length===0?(p(),_("div",st,[r(re,{description:"Добавьте столбцы из списка выше","image-size":60})])):V("",!0)])])):V("",!0),a("div",ot,[a("div",lt,[e[18]||(e[18]=a("span",{class:"reports__table_title"},"Данные отчета",-1)),m.value.length>0?(p(),_("span",rt,y(m.value.length),1)):V("",!0)]),he((p(),M(ie,{data:m.value,border:"",stripe:"",style:{width:"100%"},"empty-text":"Нет данных для отображения",class:"reports__table_element"},{default:d(()=>[(p(!0),_(w,null,S(o.value,l=>(p(),M(ne,{key:l.prop,prop:l.prop,label:l.label,"min-width":l.width,sortable:l.sortable},null,8,["prop","label","min-width","sortable"]))),128))]),_:1},8,["data"])),[[de,$.value]]),m.value.length>0?(p(),_("div",nt,[r(pe,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:m.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):V("",!0)])])])])])]),r(_e)],64)}}}),At=we(it,[["__scopeId","data-v-129c5c1b"]]);export{At as default};
