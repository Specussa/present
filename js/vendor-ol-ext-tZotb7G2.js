import{m as qe,C as We,V as je,I as Xe,a as re,b as ve,e as Ye,c as he,P as B,F as G,B as Pe,M as _e,d as j,u as q,i as Ze,f as Ke,T as Me,g as Je,H as Qe,S as $e,h as et,j as tt,L as it,k as at,t as K,l as st,n as H,o as W,p as ne,q as ie,r as U,s as ye,v as pe,w as Ce,x as oe,y as ce,z as rt,A as nt,D as ke,E as ae,G as ot,J as Ae,R as ue,K as fe,N as le,O as lt,Q as Ne,U as ht,W as ct,X as dt}from"./vendor-ol-DREyhpH7.js";function be(n){const e=n.frameState,t=qe(n.inversePixelTransform.slice(),e.coordinateToPixelTransform);return new We(n.context,e.pixelRatio,e.extent,t,e.viewState.rotation)}var se=je.split(".");se=parseInt(se[0])*100+parseInt(se[1]);var me=function(n,e){var t=n.frameState.pixelRatio;if(se>605&&se<700&&t!==1&&e.getImage()instanceof Xe){e=e.clone();var i=e.getImage();i.setScale(i.getScale()*t);var a=i.getAnchor();if(a&&i.setDisplacement){var s=i.getDisplacement();s&&(s[0]-=a[0]/t,s[1]+=a[1]/t,i.setAnchor([0,0]))}else a&&(a[0]/=t,a[1]/=t)}return e},St=class extends re{constructor(e){var t=e||{};super(t),this.oldcluster=new ve,this.clusters=[],this.animation={start:!1},this.set("animationDuration",typeof t.animationDuration=="number"?t.animationDuration:700),this.set("animationMethod",t.animationMethod||Ye),this.on(["precompose","prerender"],this.animate.bind(this)),this.on(["postcompose","postrender"],this.postanimate.bind(this))}setSource(e){this._saveClusterFn||(this._saveClusterFn=this.saveCluster.bind(this)),this.getSource()&&this.getSource().un("change",this._saveClusterFn),re.prototype.setSource.call(this,e),this.getSource()&&this.getSource().on("change",this._saveClusterFn)}saveCluster(){if(this.oldcluster){if(this.oldcluster.clear(),!this.get("animationDuration"))return;var e=this.getSource().getFeatures();e.length&&e[0].get("features")&&(this.oldcluster.addFeatures(this.clusters),this.clusters=e.slice(0),this.sourceChanged=!0)}}getClusterForFeature(e,t){for(var i=0,a;a=t[i];i++){var s=a.get("features");if(s&&s.length){for(var r=0,l;l=s[r];r++)if(e===l)return a}}return!1}stopAnimation(){this.animation.start=!1,this.animation.cA=[],this.animation.cB=[]}animate(e){var t=this.get("animationDuration");if(t){var i=e.frameState.viewState.resolution,a,s,r=this.animation,l=e.frameState.time;if(r.resolution!=i&&this.sourceChanged){var h=e.frameState.extent;for(r.resolution<i?(h=he(h,100*i),r.cA=this.oldcluster.getFeaturesInExtent(h),r.cB=this.getSource().getFeaturesInExtent(h),r.revers=!1):(h=he(h,100*i),r.cA=this.getSource().getFeaturesInExtent(h),r.cB=this.oldcluster.getFeaturesInExtent(h),r.revers=!0),r.clusters=[],a=0,s;s=r.cA[a];a++){var c=s.get("features");if(c&&c.length){var u=this.getClusterForFeature(c[0],r.cB);u&&r.clusters.push({f:s,pt:u.getGeometry().getCoordinates()})}}if(r.resolution=i,this.sourceChanged=!1,!r.clusters.length||r.clusters.length>1e3){this.stopAnimation();return}l=r.start=new Date().getTime()}if(r.start){var d=e.vectorContext||be(e),f=(l-r.start)/t;f>1&&(this.stopAnimation(),f=1),f=this.get("animationMethod")(f);var g=this.getStyle(),p=typeof g=="function"?g:g.length?function(){return g}:function(){return[g]};for(e.context.save(),e.context.globalAlpha=this.getOpacity(),a=0,u;u=r.clusters[a];a++){var m=u.f.getGeometry().getCoordinates(),L=m[0]-u.pt[0],w=m[1]-u.pt[1];r.revers?(m[0]=u.pt[0]+f*L,m[1]=u.pt[1]+f*w):(m[0]=m[0]-f*L,m[1]=m[1]-f*w);var T=p(u.f,i,!0);if(Array.isArray(T)||(T=[T]),u.f.get("features").length===1&&!L&&!w)c=u.f.get("features")[0];else{var k=new B(m);c=new G(k)}for(var x=0,A;A=T[x];x++)if(A.getText()&&/\n/.test(A.getText().getText())){var y=A.getText().getOffsetX(),v=A.getText().getOffsetY(),E=A.getText().getRotation()||0,M=Number((A.getText().getFont()||"10px").match(/\d+/))*1.2,S=A.getText().getText().split(`
`),C,b=S.length-1,_=A.clone();S.forEach(function(I,P){switch(P==1&&(_.setImage(),_.setFill(),_.setStroke()),A.getText().getTextBaseline()){case"alphabetic":case"ideographic":case"bottom":{C=b;break}case"hanging":case"top":{C=0;break}default:{C=b/2;break}}_.getText().setOffsetX(y-Math.sin(E)*M*(P-C)),_.getText().setOffsetY(v+Math.cos(E)*M*(P-C)),_.getText().setText(I),d.drawFeature(c,me(e,_))})}else d.drawFeature(c,me(e,A))}e.context.restore(),e.frameState.animate=!0,e.context.save(),e.context.beginPath(),e.context.rect(0,0,0,0),e.context.clip(),this.clip_=!0}}}postanimate(e){this.clip_&&(e.context.restore(),this.clip_=!1)}},ut=class extends Pe{constructor(e){e=e||{},super();var t=this.input=e.input;t||(t=this.input=document.createElement("input"),e.type&&t.setAttribute("type",e.type),e.min!==void 0&&t.setAttribute("min",e.min),e.max!==void 0&&t.setAttribute("max",e.max),e.step!==void 0&&t.setAttribute("step",e.step),e.parent&&e.parent.appendChild(t)),e.disabled&&(t.disabled=!0),e.checked!==void 0&&(t.checked=!!e.checked),e.val!==void 0&&(t.value=e.val),e.hidden&&t.classList.add("ol-input-hidden"),t.addEventListener("focus",(function(){this.element&&this.element.classList.add("ol-focus")}).bind(this));var i;t.addEventListener("focusout",(function(){this.element&&(i&&clearTimeout(i),i=setTimeout((function(){this.element.classList.remove("ol-focus")}).bind(this),0))}).bind(this))}_listenDrag(e,t){var i=(function(a){this.moving=!0,this.element.classList.add("ol-moving");var s=(function(r){r.type==="pointerup"&&(document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",s),document.removeEventListener("pointercancel",s),setTimeout((function(){this.moving=!1,this.element.classList.remove("ol-moving")}).bind(this))),r.target===e&&t(r),r.stopPropagation(),r.preventDefault()}).bind(this);document.addEventListener("pointermove",s,!1),document.addEventListener("pointerup",s,!1),document.addEventListener("pointercancel",s,!1),a.stopPropagation(),a.preventDefault()}).bind(this);e.addEventListener("mousedown",i,!1),e.addEventListener("touchstart",i,!1)}setValue(e){e!==void 0&&(this.input.value=e),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},Le=class extends ut{constructor(e){e=e||{},super(e);var t=this.element=document.createElement("label");e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html),t.className=("ol-ext-check ol-ext-checkbox "+(e.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(t,this.input),t.appendChild(this.input),t.appendChild(document.createElement("span")),e.after&&t.appendChild(document.createTextNode(e.after)),this.input.addEventListener("change",(function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}).bind(this))}isChecked(){return this.input.checked}},ft=class extends Le{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-toggle-switch "+(e.className||"")).trim()}},gt=class extends Le{constructor(e){e=e||{},super(e),this.element.className=("ol-ext-check ol-ext-radio "+(e.className||"")).trim()}},o={};o.create=function(n,e){e=e||{};var t;if(n==="TEXT")t=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(t);else{t=document.createElement(n.toLowerCase()),/button/i.test(n)&&t.setAttribute("type","button");for(var i in e)switch(i){case"className":{e.className&&e.className.trim&&t.setAttribute("class",e.className.trim());break}case"text":{t.innerText=e.text;break}case"html":{e.html instanceof Element?t.appendChild(e.html):e.html!==void 0&&(t.innerHTML=e.html);break}case"parent":{e.parent&&e.parent.appendChild(t);break}case"options":{if(/select/i.test(n))for(var a in e.options)o.create("OPTION",{html:a,value:e.options[a],parent:t});break}case"style":{o.setStyle(t,e.style);break}case"change":case"click":{o.addListener(t,i,e[i]);break}case"on":{for(var s in e.on)o.addListener(t,s,e.on[s]);break}case"checked":{t.checked=!!e.checked;break}default:{t.setAttribute(i,e[i]);break}}}return t};o.createSwitch=function(n){var e=o.create("INPUT",{type:"checkbox",on:n.on,click:n.click,change:n.change,parent:n.parent}),t=Object.assign({input:e},n||{});return new ft(t),e};o.createCheck=function(n){var e=o.create("INPUT",{name:n.name,type:n.type==="radio"?"radio":"checkbox",on:n.on,parent:n.parent}),t=Object.assign({input:e},n||{});return n.type==="radio"?new gt(t):new Le(t),e};o.setHTML=function(n,e){e instanceof Element?n.appendChild(e):e!==void 0&&(n.innerHTML=e)};o.appendText=function(n,e){n.appendChild(document.createTextNode(e||""))};o.addListener=function(n,e,t,i){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(a){n.addEventListener(a,t,i)})};o.removeListener=function(n,e,t){typeof e=="string"&&(e=e.split(" ")),e.forEach(function(i){n.removeEventListener(i,t)})};o.show=function(n){n.style.display=""};o.hide=function(n){n.style.display="none"};o.hidden=function(n){return o.getStyle(n,"display")==="none"};o.toggle=function(n){n.style.display=n.style.display==="none"?"":"none"};o.setStyle=function(n,e){for(var t in e)switch(t){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":{typeof e[t]=="number"?n.style[t]=e[t]+"px":n.style[t]=e[t];break}default:n.style[t]=e[t]}};o.getStyle=function(n,e){var t,i=(n.ownerDocument||document).defaultView;if(i&&i.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),t=i.getComputedStyle(n,null).getPropertyValue(e);else if(n.currentStyle&&(e=e.replace(/-(\w)/g,function(a,s){return s.toUpperCase()}),t=n.currentStyle[e],/^\d+(em|pt|%|ex)?$/i.test(t)))return function(a){var s=n.style.left,r=n.runtimeStyle.left;return n.runtimeStyle.left=n.currentStyle.left,n.style.left=a||0,a=n.style.pixelLeft+"px",n.style.left=s,n.runtimeStyle.left=r,a}(t);return/px$/.test(t)?parseInt(t):t};o.outerHeight=function(n){return n.offsetHeight+o.getStyle(n,"marginBottom")};o.outerWidth=function(n){return n.offsetWidth+o.getStyle(n,"marginLeft")};o.offsetRect=function(n){var e=n.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.width||e.right-e.left}};o.getFixedOffset=function(n){var e={left:0,top:0},t=function(i){if(!i)return e;if(o.getStyle(i,"position")==="absolute"&&o.getStyle(i,"transform")!=="none"){var a=i.getBoundingClientRect();return e.left+=a.left,e.top+=a.top,e}return t(i.offsetParent)};return t(n.offsetParent)};o.positionRect=function(n,e){var t=0,i=0,a=function(s){if(s)return t+=s.offsetLeft,i+=s.offsetTop,a(s.offsetParent);var r={top:n.offsetTop+i,left:n.offsetLeft+t};return e&&(r.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,r.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),r.bottom=r.top+n.offsetHeight,r.right=r.top+n.offsetWidth,r};return a(n.offsetParent)};o.scrollDiv=function(n,e){e=e||{};var t=!1,i=0,a,s=0,r=typeof e.onmove=="function"?e.onmove:function(){},l=e.vertical?"screenY":"screenX",h=e.vertical?"scrollTop":"scrollLeft",c=!1,u,d,f=0,g=function(){k&&(f++,setTimeout(p))},p=function(){if(k){if(f--,f)return;var v=n.clientHeight,E=n.scrollHeight;u=v/E,k.style.height=u*100+"%",k.style.top=n.scrollTop/E*100+"%",T.style.height=v+"px",v>E-.5?T.classList.add("ol-100pc"):T.classList.remove("ol-100pc")}},m=function(v){v.target.classList.contains("ol-noscroll")||(c=!1,t=v[l],s=new Date,n.classList.add("ol-move"),v.preventDefault(),window.addEventListener("pointermove",L),o.addListener(window,["pointerup","pointercancel"],A))},L=function(v){if(t!==!1){var E=(d?-1/u:1)*(t-v[l]);c=c||Math.round(E),n[h]+=E,a=new Date,a-s&&(i=(i+E/(a-s))/2),t=v[l],s=a,E&&r(!0)}else c=!0},w=function(v){var E=v>0?Math.min(100,v/2):Math.max(-100,v/2);v-=E,n[h]+=E,-1<v&&v<1?(c?setTimeout(function(){n.classList.remove("ol-move")}):n.classList.remove("ol-move"),c=!1,r(!1)):setTimeout(function(){w(v)},40)},T,k;if(e.vertical&&e.minibar){var x=function(v){n.removeEventListener("pointermove",x),n.parentNode.classList.add("ol-miniscroll"),k=o.create("DIV"),T=o.create("DIV",{className:"ol-scroll",html:k}),n.parentNode.insertBefore(T,n),k.addEventListener("pointerdown",function(E){d=!0,m(E)}),e.mousewheel&&(o.addListener(T,["mousewheel","DOMMouseScroll","onmousewheel"],function(E){y(E)}),o.addListener(k,["mousewheel","DOMMouseScroll","onmousewheel"],function(E){y(E)})),n.parentNode.addEventListener("pointerenter",g),window.addEventListener("resize",g),v!==!1&&g()};n.parentNode?x(!1):n.addEventListener("pointermove",x),n.addEventListener("scroll",function(){g()})}n.style["touch-action"]="none",n.style.overflow="hidden",n.classList.add("ol-scrolldiv"),o.addListener(n,["pointerdown"],function(v){d=!1,m(v)}),n.addEventListener("click",function(v){n.classList.contains("ol-move")&&(v.preventDefault(),v.stopPropagation())},!0);var A=function(v){s=new Date-s,s>100||d?i=0:s>0&&(i=((i||0)+(t-v[l])/s)/2),w(e.animate===!1?0:i*200),t=!1,i=0,s=0,n.classList.contains("ol-move")?n.classList.remove("ol-hasClick"):(n.classList.add("ol-hasClick"),setTimeout(function(){n.classList.remove("ol-hasClick")},500)),d=!1,window.removeEventListener("pointermove",L),o.removeListener(window,["pointerup","pointercancel"],A)},y=function(v){var E=Math.max(-1,Math.min(1,v.wheelDelta||-v.detail));return n.classList.add("ol-move"),n[h]-=E*30,n.classList.remove("ol-move"),!1};return e.mousewheel&&o.addListener(n,["mousewheel","DOMMouseScroll","onmousewheel"],y),{refresh:g}};o.dispatchEvent=function(n,e){var t;try{t=new CustomEvent(n)}catch{t=document.createEvent("CustomEvent"),t.initCustomEvent(n,!0,!0,{})}e.dispatchEvent(t)};o.setCursor=function(n,e){n instanceof _e&&(n=n.getTargetElement()),!("ontouchstart"in window)&&n instanceof Element&&(n.style.cursor=e)};var pt=class extends j{constructor(e){e=e||{};var t=o.create("DIV",{className:e.switcherClass||"ol-layerswitcher"});super({element:t,target:e.target});var i=this;this.dcount=0,this.show_progress=e.show_progress,this.oninfo=typeof e.oninfo=="function"?e.oninfo:null,this.onextent=typeof e.onextent=="function"?e.onextent:null,this.hasextent=e.extent||e.onextent,this.hastrash=e.trash,this.reordering=e.reordering!==!1,this._layers=[],this._layerGroup=e.layerGroup&&e.layerGroup.getLayers?e.layerGroup:null,this.onchangeCheck=typeof e.onchangeCheck=="function"?e.onchangeCheck:null,typeof e.displayInLayerSwitcher=="function"&&(this.displayInLayerSwitcher=e.displayInLayerSwitcher),e.target||(t.classList.add("ol-unselectable"),t.classList.add("ol-control"),t.classList.add(e.collapsed!==!1?"ol-collapsed":"ol-forceopen"),e.counter&&t.classList.add("ol-counter"),this.counter=o.create("SPAN",{class:"ol-counter",text:0,parent:t}),this.button=o.create("BUTTON",{type:"button",parent:t}),this.button.addEventListener("touchstart",function(a){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:t.classList.contains("ol-collapsed")}),a.preventDefault(),i.overflow()}),this.button.addEventListener("click",function(){t.classList.toggle("ol-forceopen"),t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!t.classList.contains("ol-forceopen")}),i.overflow()}),e.mouseover&&(t.addEventListener("mouseleave",function(){t.classList.add("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!0})}),t.addEventListener("mouseover",function(){t.classList.remove("ol-collapsed"),i.dispatchEvent({type:"toggle",collapsed:!1})})),e.minibar&&(e.noScroll=!0),e.noScroll||(this.topv=o.create("DIV",{className:"ol-switchertopdiv",parent:t,click:function(){i.overflow("+50%")}}),this.botv=o.create("DIV",{className:"ol-switcherbottomdiv",parent:t,click:function(){i.overflow("-50%")}})),this._noScroll=e.noScroll),this.panel_=o.create("UL",{className:"panel"}),this.panelContainer_=o.create("DIV",{className:"panel-container",html:this.panel_,parent:t}),!e.target&&!e.noScroll&&o.addListener(this.panel_,"mousewheel DOMMouseScroll onmousewheel",function(a){i.overflow(Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)))&&(a.stopPropagation(),a.preventDefault())}),this.header_=o.create("LI",{className:"ol-header",parent:this.panel_}),this.set("drawDelay",e.drawDelay||0),this.set("selection",e.selection),e.minibar&&setTimeout((function(){var a=o.scrollDiv(this.panelContainer_,{mousewheel:!0,vertical:!0,minibar:!0});this.on(["drawlist","toggle"],function(){a.refresh()})}).bind(this))}displayInLayerSwitcher(e){return e.get("displayInLayerSwitcher")!==!1}setMap(e){if(super.setMap(e),this.drawPanel(),this._listener)for(var t in this._listener)q(this._listener[t]);this._listener=null,e&&(this._listener={moveend:e.on("moveend",this.viewChange.bind(this)),size:e.on("change:size",this.overflow.bind(this))},this._layerGroup?this._listener.change=this._layerGroup.getLayers().on("change:length",this.drawPanel.bind(this)):this._listener.change=e.getLayerGroup().getLayers().on("change:length",this.drawPanel.bind(this)))}show(){this.element.classList.add("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!1})}hide(){this.element.classList.remove("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!0})}toggle(){this.element.classList.toggle("ol-forceopen"),this.overflow(),this.dispatchEvent({type:"toggle",collapsed:!this.isOpen()})}isOpen(){return this.element.classList.contains("ol-forceopen")}setHeader(e){o.setHTML(this.header_,e)}overflow(e){if(this.button&&!this._noScroll){if(o.hidden(this.panel_)){o.setStyle(this.element,{height:"auto"});return}var t=o.outerHeight(this.element),i=o.outerHeight(this.panel_),a=this.button.offsetTop+o.outerHeight(this.button),s=this.panel_.offsetTop-a;if(i>t-a){o.setStyle(this.element,{height:"100%"});var r=this.panel_.querySelectorAll("li.ol-visible .li-content")[0],l=r?2*o.getStyle(r,"height"):0;switch(e){case 1:s+=l;break;case-1:s-=l;break;case"+50%":s+=Math.round(t/2);break;case"-50%":s-=Math.round(t/2);break}return s+i<=t-3*a/2?(s=t-3*a/2-i,o.hide(this.botv)):o.show(this.botv),s>=0?(s=0,o.hide(this.topv)):o.show(this.topv),o.setStyle(this.panel_,{top:s+"px"}),!0}else return o.setStyle(this.element,{height:"auto"}),o.setStyle(this.panel_,{top:0}),o.hide(this.botv),o.hide(this.topv),!1}else return!1}_setLayerForLI(e,t){var i=[];t.getLayers&&i.push(t.getLayers().on("change:length",this.drawPanel.bind(this))),e&&(i.push(t.on("change:opacity",(function(){this.setLayerOpacity(t,e)}).bind(this))),i.push(t.on("change:visible",(function(){this.setLayerVisibility(t,e)}).bind(this)))),i.push(t.on("propertychange",(function(a){(a.key==="displayInLayerSwitcher"||a.key==="openInLayerSwitcher"||a.key==="title"||a.key==="name")&&this.drawPanel(a)}).bind(this))),this._layers.push({li:e,layer:t,listeners:i})}setLayerOpacity(e,t){var i=t.querySelector(".layerswitcher-opacity-cursor");i&&(i.style.left=e.getOpacity()*100+"%"),this.dispatchEvent({type:"layer:opacity",layer:e})}setLayerVisibility(e,t){var i=t.querySelector(".ol-visibility");i&&(i.checked=e.getVisible()),e.getVisible()?t.classList.add("ol-visible"):t.classList.remove("ol-visible"),this.dispatchEvent({type:"layer:visible",layer:e})}_clearLayerForLI(){this._layers.forEach(function(e){e.listeners.forEach(function(t){q(t)})}),this._layers=[]}_getLayerForLI(e){for(var t=0,i;i=this._layers[t];t++)if(i.li===e)return i.layer;return null}viewChange(){this.panel_.querySelectorAll("li").forEach((function(e){var t=this._getLayerForLI(e);t&&(this.testLayerVisibility(t)?e.classList.remove("ol-layer-hidden"):e.classList.add("ol-layer-hidden"))}).bind(this))}getPanel(){return this.panelContainer_}drawPanel(){if(this.getMap()){var e=this;this.dcount++,setTimeout(function(){e.drawPanel_()},this.get("drawDelay")||0)}}drawPanel_(){if(!(--this.dcount||this.dragging_)){var e=this.panelContainer_.scrollTop;this._clearLayerForLI(),this.panel_.querySelectorAll("li").forEach((function(t){t.classList.contains("ol-header")||t.remove()}).bind(this)),this._layerGroup?this.drawList(this.panel_,this._layerGroup.getLayers()):this.getMap()&&this.drawList(this.panel_,this.getMap().getLayers()),this.panelContainer_.scrollTop=e,this.counter.innerHTML=this.panel_.parentNode.querySelectorAll("ul.panel > li:not(.ol-header)").length}}switchLayerVisibility(e,t){e.get("baseLayer")?(e.getVisible()||e.setVisible(!0),t.forEach(function(i){e!==i&&i.get("baseLayer")&&i.getVisible()&&i.setVisible(!1)})):e.setVisible(!e.getVisible())}testLayerVisibility(e){if(!this.getMap())return!0;var t=this.getMap().getView().getResolution(),i=this.getMap().getView().getZoom();if(e.getMaxResolution()<=t||e.getMinResolution()>=t)return!1;if(e.getMinZoom&&(e.getMinZoom()>=i||e.getMaxZoom()<i))return!1;var a=e.getExtent();if(a){var s=this.getMap().getView().calculateExtent(this.getMap().getSize());return Ze(s,a)}return!0}dragOrdering_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.currentTarget.parentNode.parentNode,a=!0,s=this.panel_,r,l=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,h,c,u,d;i.parentNode.classList.add("drag");function f(){if(h){var p=u,m=t.getSelection()===p;if(p&&h){var L;d?L=d.getLayers():L=t._layerGroup?t._layerGroup.getLayers():t.getMap().getLayers();for(var w=L.getArray(),T=0;T<w.length;T++)if(w[T]==p){L.removeAt(T);break}for(var k=0;k<w.length;k++)if(w[k]===h){T>k?L.insertAt(k,p):L.insertAt(k+1,p);break}}m&&t.selectLayer(p),t.dispatchEvent({type:"reorder-end",layer:p,group:d})}i.parentNode.querySelectorAll("li").forEach(function(x){x.classList.remove("dropover"),x.classList.remove("dropover-after"),x.classList.remove("dropover-before")}),i.classList.remove("drag"),i.parentNode.classList.remove("drag"),t.element.classList.remove("drag"),c&&c.remove(),o.removeListener(document,"mousemove touchmove",g),o.removeListener(document,"mouseup touchend touchcancel",f)}function g(p){if(r=p.pageY||p.touches&&p.touches.length&&p.touches[0].pageY||p.changedTouches&&p.changedTouches.length&&p.changedTouches[0].pageY,a&&Math.abs(l-r)>2&&(a=!1,i.classList.add("drag"),u=t._getLayerForLI(i),h=!1,d=t._getLayerForLI(i.parentNode.parentNode),c=o.create("LI",{className:"ol-dragover",html:i.innerHTML,style:{position:"absolute","z-index":1e4,left:i.offsetLeft,opacity:.5,width:o.outerWidth(i),height:o.getStyle(i,"height")},parent:s}),t.element.classList.add("drag"),t.dispatchEvent({type:"reorder-start",layer:u,group:d})),!a){p.preventDefault(),p.stopPropagation(),o.setStyle(c,{top:r-o.offsetRect(s).top+s.scrollTop+5});var m;if(!p.touches)m=p.target,p.target.shadowRoot&&(m=p.composedPath()[0]);else for(m=document.elementFromPoint(p.touches[0].clientX,p.touches[0].clientY);m.shadowRoot;)m=m.shadowRoot.elementFromPoint(p.touches[0].clientX,p.touches[0].clientY);for(m.classList.contains("ol-switcherbottomdiv")?t.overflow(-1):m.classList.contains("ol-switchertopdiv")&&t.overflow(1);m&&m.tagName!=="LI";)m=m.parentNode;(!m||!m.classList.contains("dropover"))&&i.parentNode.querySelectorAll("li").forEach(function(L){L.classList.remove("dropover"),L.classList.remove("dropover-after"),L.classList.remove("dropover-before")}),m&&m.parentNode.classList.contains("drag")&&m!==i?(h=t._getLayerForLI(m),h&&!h.get("allwaysOnTop")==!u.get("allwaysOnTop")?(m.classList.add("dropover"),m.classList.add(i.offsetTop<m.offsetTop?"dropover-after":"dropover-before")):h=!1,o.show(c)):(h=!1,m===i?o.hide(c):o.show(c)),h?c.classList.remove("forbidden"):c.classList.add("forbidden")}}o.addListener(document,"mousemove touchmove",g),o.addListener(document,"mouseup touchend touchcancel",f)}dragOpacity_(e){e.stopPropagation(),e.preventDefault();var t=this,i=e.target,a=this._getLayerForLI(i.parentNode.parentNode.parentNode);if(!a)return;var s=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,r=o.getStyle(i,"left")-s;t.dragging_=!0;function l(){o.removeListener(document,"mouseup touchend touchcancel",l),o.removeListener(document,"mousemove touchmove",h),t.dragging_=!1}function h(c){var u=c.pageX||c.touches&&c.touches.length&&c.touches[0].pageX||c.changedTouches&&c.changedTouches.length&&c.changedTouches[0].pageX,d=(r+u)/o.getStyle(i.parentNode,"width"),f=Math.max(0,Math.min(1,d));o.setStyle(i,{left:f*100+"%"}),i.parentNode.nextElementSibling.innerHTML=Math.round(f*100),a.setOpacity(f)}o.addListener(document,"mouseup touchend touchcancel",l),o.addListener(document,"mousemove touchmove",h)}drawList(e,t){var i=this,a=t.getArray(),s=function(d){d.stopPropagation(),d.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.switchLayerVisibility(f,t),i.get("selection")&&f.getVisible()&&i.selectLayer(f),i.onchangeCheck&&i.onchangeCheck(f)};function r(d){d.stopPropagation(),d.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.oninfo(f),i.dispatchEvent({type:"info",layer:f})}function l(d){d.stopPropagation(),d.preventDefault();var f=i._getLayerForLI(this.parentNode.parentNode);i.onextent?i.onextent(f):i.getMap().getView().fit(f.getExtent(),i.getMap().getSize()),i.dispatchEvent({type:"extent",layer:f})}function h(d){d.stopPropagation(),d.preventDefault();var f=this.parentNode.parentNode.parentNode.parentNode,g,p=i._getLayerForLI(f);p?(g=i._getLayerForLI(this.parentNode.parentNode),p.getLayers().remove(g),p.getLayers().getLength()==0&&!p.get("noSwitcherDelete")&&h.call(f.querySelectorAll(".layerTrash")[0],d)):(f=this.parentNode.parentNode,i.getMap().removeLayer(i._getLayerForLI(f)))}function c(d){if(!this.displayInLayerSwitcher(d)){this._setLayerForLI(null,d);return}var f=o.create("LI",{className:(d.getVisible()?"ol-visible ":" ")+(d.get("baseLayer")?"baselayer":""),parent:e});this._setLayerForLI(f,d),this._selectedLayer===d&&f.classList.add("ol-layer-select");var g=o.create("DIV",{className:"ol-layerswitcher-buttons",parent:f}),p=o.create("DIV",{className:"li-content",parent:f}),m=o.create("INPUT",{type:d.get("baseLayer")?"radio":"checkbox",className:"ol-visibility",checked:d.getVisible(),click:function(y){s.bind(this)(y),setTimeout(function(){y.target.checked=d.getVisible()})},on:{keydown:(function(y){switch(y.key){case"ArrowLeft":case"ArrowRight":{y.preventDefault(),y.stopPropagation();var v=y.key==="ArrowLeft"?-.1:.1,E=Math.min(1,Math.max(0,d.getOpacity()+v));d.setOpacity(E);break}case"Enter":{i.get("selection")&&(y.preventDefault(),y.stopPropagation(),i.selectLayer(d));break}case"-":case"+":d.getLayers&&(this._focus=d,d.set("openInLayerSwitcher",!d.get("openInLayerSwitcher")));case"ArrowUp":case"ArrowDown":{if(y.ctrlKey&&this.reordering){y.preventDefault(),y.stopPropagation();var M=t.getArray().indexOf(d);M>-1&&(y.key==="ArrowDown"?M>0&&(t.remove(d),t.insertAt(M-1,d),i._focus=d,i.dispatchEvent({type:"reorder-end",layer:d})):M<t.getLength()-1&&(t.remove(d),t.insertAt(M+1,d),i._focus=d,i.dispatchEvent({type:"reorder-end",layer:d})))}break}default:{var S=this._getLayerForLI(e.parentNode);this.dispatchEvent({type:"layer:keydown",key:y.key,group:S,li:f,layer:d,originalEvent:y})}}}).bind(this)},parent:p});d===i._focus&&(m.focus(),i.overflow());var L=o.create("LABEL",{title:d.get("title")||d.get("name"),click:s,style:{userSelect:"none"},parent:p});if(L.addEventListener("selectstart",function(){return!1}),o.create("SPAN",{html:d.get("title")||d.get("name"),click:(function(y){this.get("selection")&&(y.stopPropagation(),this.selectLayer(d))}).bind(this),parent:L}),this.reordering&&(u<a.length-1&&(d.get("allwaysOnTop")||!a[u+1].get("allwaysOnTop"))||u>0&&(!d.get("allwaysOnTop")||a[u-1].get("allwaysOnTop")))&&o.create("DIV",{className:"layerup ol-noscroll",title:this.tip.up,on:{"mousedown touchstart":function(y){i.dragOrdering_(y)}},parent:g}),d.getLayers){var w=0;d.getLayers().forEach(function(y){i.displayInLayerSwitcher(y)&&w++}),w&&o.create("DIV",{className:d.get("openInLayerSwitcher")?"collapse-layers":"expend-layers",title:this.tip.plus,click:function(){var y=i._getLayerForLI(this.parentNode.parentNode);y.set("openInLayerSwitcher",!y.get("openInLayerSwitcher"))},parent:g})}if(this.oninfo&&o.create("DIV",{className:"layerInfo",title:this.tip.info,click:r,parent:g}),this.hastrash&&!d.get("noSwitcherDelete")&&o.create("DIV",{className:"layerTrash",title:this.tip.trash,click:h,parent:g}),this.hasextent&&a[u].getExtent()){var T=a[u].getExtent();T.length==4&&T[0]<T[2]&&T[1]<T[3]&&o.create("DIV",{className:"layerExtent",title:this.tip.extent,click:l,parent:g})}if(this.show_progress&&d instanceof Me){var k=o.create("DIV",{className:"layerswitcher-progress",parent:p});this.setprogress_(d),d.layerswitcher_progress=o.create("DIV",{parent:k})}var x=o.create("DIV",{className:"layerswitcher-opacity",click:function(y){if(y.target===this){y.stopPropagation(),y.preventDefault();var v=Math.max(0,Math.min(1,y.offsetX/o.getStyle(this,"width")));i._getLayerForLI(this.parentNode.parentNode).setOpacity(v),this.parentNode.querySelectorAll(".layerswitcher-opacity-label")[0].innerHTML=Math.round(v*100)}},parent:p});if(o.create("DIV",{className:"layerswitcher-opacity-cursor ol-noscroll",style:{left:d.getOpacity()*100+"%"},on:{"mousedown touchstart":function(y){i.dragOpacity_(y)}},parent:x}),o.create("DIV",{className:"layerswitcher-opacity-label",html:Math.round(d.getOpacity()*100),parent:p}),d.getLayers&&(f.classList.add("ol-layer-group"),d.get("openInLayerSwitcher")===!0)){var A=o.create("UL",{parent:f});this.drawList(A,d.getLayers())}f.classList.add(this.getLayerClass(d)),this.dispatchEvent({type:"drawlist",layer:d,li:f})}for(var u=a.length-1;u>=0;u--)c.call(this,a[u]);this.viewChange(),e===this.panel_&&(this.overflow(""),this._focus=null)}getLayerClass(e){return e?e.getLayers?"ol-layer-group":e instanceof re?"ol-layer-vector":e instanceof Ke?"ol-layer-vectortile":e instanceof Me?"ol-layer-tile":e instanceof Je?"ol-layer-image":e instanceof Qe?"ol-layer-heatmap":e.getFeatures?"ol-layer-vectorimage":"unknown":"none"}selectLayer(e,t){if(!e){if(!this.getMap())return;e=this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)}this._selectedLayer=e,this.element.querySelector("input.ol-visibility:focus")&&(this._focus=e),this.drawPanel(),t||this.dispatchEvent({type:"select",layer:e})}getSelection(){return this._selectedLayer}setprogress_(e){if(!e.layerswitcher_progress){var t=0,i=0,a=function(){i===t?(i=t=0,o.setStyle(e.layerswitcher_progress,{width:0})):o.setStyle(e.layerswitcher_progress,{width:(t/i*100).toFixed(1)+"%"})};e.getSource().on("tileloadstart",function(){i++,a()}),e.getSource().on("tileloadend",function(){t++,a()}),e.getSource().on("tileloaderror",function(){t++,a()})}}};pt.prototype.tip={up:"up/down",down:"down",info:"informations...",extent:"zoom to extent",trash:"remove layer",plus:"expand/shrink"};$e.prototype.getPreview=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAk6QAAJOkBUCTn+AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANeSURBVHic7ZpPiE1RHMc/780MBhkik79JSUlIUbOxI+wkI2yRhYSUlJLNpJF/xcpiJBmZGBZsNM1CkmhKITGkGbH0/BuPmXnP4rxbb/TOn3fvOffeec6nfqvb/b7f93fveeec37ng8Xg8Ho/nf6Uu4d+fDswFssCvhHOJhaXAMeApMAQUyyIPPAdOAiuTStAVy4EHjDWsix5gdRLJ2mY34ulWYz6IEeA4kIk9awtkgTOEM/5vdAKT4k0/Ou3YMR/ELcbRm9AKFLBbgCJwNE4TYZkJfMG++SIwDCyLz0o4bI17WdyJz0r1TAZ+oDcxCBwAFgIzEIuhvcBbg3sLwOK4DFXLFvQGniCGSSUagS4DjUPOHESkA3XiOWCORqMR6Nfo9DjI3QqPUSd+ylBnv0Zn0GrWFvmIOvGNhjqrNDp/EAutyFgRKUM2tgO+Gur81FxvAKYZaimxXYBvmuuLDHWWaK4X0RfJCNsF6NdcbzXU2a65PohYFKWOc+jn8PUajbWIXaBKp9NB7lZYh34OzwFbFfd/NtDYYSth27urLGIm0M31AL3APWAAmIooymaDnPIl/Vz4NN1yHrd7gcvxWQnHAuA3bsyPop8hUsE13BSgK04TUViBeFo2zedJ8S6wElexW4D2eNOPTjNi6WvD/DtEr8E6tk6GGoAmxFY2iFHE9NZiQf8gogiB9gTEH23izAZuE77vHyU+ANucO1QwD3hD/MbLowAcdm20EmkwXx4n3NodS9rMB2HabYpEWs0HcRqHp0fNwAvJD+eBTZr7p6BvmQVxUaEzEbiruNfJekH15L8jtrEm7JJolEcOmKXRqQOuKDQuY7HZY8s8iNfzkSLxIuI43FTrkkLnOlBfRW4VsWk+oAX5weknxFAxJQNckGgVgZuIRVoomoGXEmGTMa+iQ6K7M4SW7k24QYgiuDQPYinbhugiF4H3RGtzZYCzyIvQXfpNI1ybLyeLpf5+iTbkRbiP2EcocTHm4+YI8iI8RFHwWjAfsA95Q+YZFU6wasl8wB7kReijtNbIILa0vcg/PRlGfPQwHmlCviDqAzaA+OREtzqr1ejOIDorxlNEjTGUBV4nnUWCvAJxGDlA8q9j3DEArAn2zvXAfOwfl6eVAmJrPpJ0Ih6Px+PxeJLjLwPul3vj5d0eAAAAAElFTkSuQmCC"};et.prototype.getPreview=function(n,e){n||(n=[21020,6355964]),e||(e=150);var t=this.getTileGrid().getTileCoordForCoordAndResolution(n,e),i=this.getTileUrlFunction();return i.call(this,t,this.getProjection())};tt.prototype.getPreview=function(n,e){n||(n=[21020,6355964]),e||(e=150);var t=this.getTileUrlFunction();if(t){var i=this.getTileGrid()||this.getTileGridForProjection(this.getProjection()),a=i.getTileCoordForCoordAndResolution(n,e);return t.call(this,a,1,this.getProjection())}var s=this.getGetFeatureInfoUrl?this.getGetFeatureInfoUrl(n,e,this.getProjection()||"EPSG:3857",{}):this.getFeatureInfoUrl(n,e,this.getProjection()||"EPSG:3857",{});return s=s.replace(/getfeatureinfo/i,"GetMap"),s};it.prototype.getPreview=function(n,e,t){if(this.get("preview"))return[this.get("preview")];if(e||(e=150),e<this.getMinResolution()||e>this.getMaxResolution()){var i=this.getMinResolution(),a=this.getMaxResolution();for(a>1e5&&(a=156543),i<.15&&(i=.15),e=a;a>i;)i*=2,a/=2,e=i}var s=this.getExtent();if(n||(n=[21020,6355964]),s&&!at(s,n)&&(n=[(s[0]+s[2])/2,(s[1]+s[3])/2]),t&&(n=K(n,t,this.getSource().getProjection())),this.getSource&&this.getSource())try{return[this.getSource().getPreview(n,e)]}catch{}return[]};st.prototype.getPreview=function(n,e){if(this.get("preview"))return[this.get("preview")];var t=[];if(this.getLayers)for(var i=this.getLayers().getArray(),a=0;a<i.length;a++)t=t.concat(i[a].getPreview(n,e));return t};var Fe=class extends j{constructor(e){e=e||{},e.fullscreen&&(e.target=document.body);var t=e.target===document.body,i=o.create(t?"DIALOG":"DIV",{className:((e.className||"")+(e.zoom?" ol-zoom":"")+" ol-ext-dialog").trim()});super({element:i,target:e.target}),t&&(i.addEventListener("close",(function(){this.hide()}).bind(this)),document.addEventListener("keydown",(function(r){r.key==="Escape"&&!this.get("closeBox")&&this.isOpen()&&r.preventDefault()}).bind(this)),i.addEventListener("cancel",(function(){setTimeout((function(){this.dispatchEvent("cancel")}).bind(this))}).bind(this))),i.addEventListener("click",(function(r){this.get("hideOnBack")&&r.target===i&&this.close(),this.get("hideOnClick")&&this.close()}).bind(this));var a=o.create("FORM",{on:{submit:this._onButton("submit")},parent:i});o.create("H2",{parent:a}),o.create("DIV",{className:"ol-closebox",click:this._onButton("cancel"),parent:a}),o.create("DIV",{className:"ol-content",parent:a}),this._progress=o.create("DIV",{style:{display:"none"},parent:a});var s=o.create("DIV",{className:"ol-progress-bar",parent:this._progress});this._progressbar=o.create("DIV",{parent:s}),this._progressMessage=o.create("DIV",{className:"ol-progress-message",parent:this._progress}),o.create("DIV",{className:"ol-buttons",parent:a}),this.set("closeBox",e.closeBox!==!1),this.set("zoom",!!e.zoom),this.set("hideOnClick",!!e.hideOnClick),this.set("hideOnBack",!!e.hideOnBack),this.set("className",i.className),this.set("closeOnSubmit",e.closeOnSubmit),this.set("buttons",e.buttons),this.setContent(e)}show(e){e&&((e instanceof Element||typeof e=="string")&&(e={content:e}),this.setContent(e)),this.element.showModal&&this.element.showModal(),this.element.classList.add("ol-visible"),this.element.setAttribute("aria-hidden",!1);var t=this.element.querySelector('input[type="text"],input[type="search"],input[type="number"]');if(t&&setTimeout(function(){t.focus()}),this.dispatchEvent({type:"show"}),e){if(e.autoclose){var i=setTimeout((function(){this.hide()}).bind(this),e.autoclose);this.once("hide",function(){clearTimeout(i)})}if(e.hideOnBack){var a=this.get("hideOnBack");this.set("hideOnBack",!0),this.once("hide",(function(){this.set("hideOnBack",a)}).bind(this))}}}open(){this.show()}setContentMessage(e){if(e!==void 0){var t=this.getContentElement();e instanceof Element&&o.setHTML(t,""),o.setHTML(t,e||"")}}setTitle(e){var t=this.element.querySelector("form");t.querySelector("h2").innerText=e||"",e?t.classList.add("ol-title"):t.classList.remove("ol-title")}setContent(e){if(e){this.element.className=this.get("className"),typeof e=="string"&&(e={content:e}),e=e||{},this.setProgress(!1),e.max&&this.setProgress(0,e.max),e.progress!==void 0&&this.setProgress(e.progress),this.get("zoom")?this.element.classList.add("ol-zoom"):this.element.classList.remove("ol-zoom"),e.className&&e.className.split(" ").forEach((function(r){this.element.classList.add(r)}).bind(this));var t=this.element.querySelector("form");e.content!==void 0&&(e.content instanceof Element&&o.setHTML(t.querySelector(".ol-content"),""),o.setHTML(t.querySelector(".ol-content"),e.content||"")),this.setTitle(e.title),e.closeBox||this.get("closeBox")&&e.closeBox!==!1?t.classList.add("ol-closebox"):t.classList.remove("ol-closebox");var i=this.element.querySelector(".ol-buttons");i.innerHTML="";var a=e.buttons||this.get("buttons");if(a){t.classList.add("ol-button");for(var s in a)o.create("INPUT",{type:s==="submit"?"submit":"button",value:a[s],click:this._onButton(s,e.onButton),parent:i})}else t.classList.remove("ol-button")}}getContentElement(){return this.element.querySelector("form .ol-content")}setProgress(e,t,i){if(e===!1){o.setStyle(this._progress,{display:"none"});return}if(t>0?this.set("max",Number(t)):t=this.get("max"),!t)o.setStyle(this._progress,{display:"none"});else{var a=Math.round(e/t*100);o.setStyle(this._progress,{display:""}),this._progressbar.className=a?"":"notransition",o.setStyle(this._progressbar,{width:a+"%"})}this._progressMessage.innerHTML="",o.setHTML(this._progressMessage,i||"")}_onButton(e,t){var i=(function(a){a.preventDefault(),(e!=="submit"||this.get("closeOnSubmit")!==!1)&&this.hide();var s=this.getInputs();setTimeout((function(){this.dispatchEvent({type:"button",button:e,inputs:s}),typeof t=="function"&&t(e,s)}).bind(this))}).bind(this);return i}getInputs(){var e={};return["input","textarea","select"].forEach((function(t){this.element.querySelectorAll("form "+t).forEach(function(i){i.className&&i.className.split(" ").forEach(function(a){e[a]=i})})}).bind(this)),e}hide(){document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),this.element.close&&this.element.close(),this.isOpen()&&(this.element.classList.remove("ol-visible"),this.element.setAttribute("aria-hidden",!0),setTimeout((function(){this.dispatchEvent({type:"hide"})}).bind(this)))}close(){this.hide()}isOpen(){return this.element.classList.contains("ol-visible")}},mt=function(n){if(!n)return null;var e=n.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return e||(n.getViewport().querySelector(".ol-layers")?(e=document.createElement("canvas"),e.className="ol-fixedoverlay",n.getViewport().querySelector(".ol-layers").after(e),n.on("precompose",function(t){e.width=n.getSize()[0]*t.frameState.pixelRatio,e.height=n.getSize()[1]*t.frameState.pixelRatio})):e=n.getViewport().querySelector("canvas")),e},we=class extends j{constructor(e){e=e||{},super(e),this.setStyle(e.style)}setMap(e){this.getCanvas(e);var t=this.getMap();if(this._listener&&(q(this._listener),this._listener=null),super.setMap(e),t)try{t.renderSync()}catch{}e&&(this._listener=e.on("postcompose",this._draw.bind(this)))}getCanvas(e){return mt(e)}getContext(e){var t=e.context;if(!t&&this.getMap()){var i=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];t=i?i.getContext("2d"):null}return t}setStyle(e){this._style=e||new H({})}getStyle(){return this._style}getStroke(){var e=this._style.getStroke();return e||this._style.setStroke(new W({color:"#000",width:1.25})),this._style.getStroke()}getFill(){var e=this._style.getFill();return e||this._style.setFill(new ne({color:"#fff"})),this._style.getFill()}getTextStroke(){var e=this._style.getText();return e||(e=new ie({})),e.getStroke()||e.setStroke(new W({color:"#fff",width:3})),e.getStroke()}getTextFill(){var e=this._style.getText();return e||(e=new ie({})),e.getFill()||e.setFill(new ne({color:"#fff"})),e.getFill()}getTextFont(){var e=this._style.getText();return e||(e=new ie({})),e.getFont()||e.setFont("12px sans-serif"),e.getFont()}_draw(){console.warn("[CanvasBase] draw function not implemented.")}},vt=class extends we{constructor(e){e=e||{};var t=document.createElement("div");if(super({element:t,target:e.target}),e.target)t.className=e.className||"ol-legend";else{t.className=(e.className||"ol-legend")+" ol-unselectable ol-control"+(e.collapsible===!1?" ol-uncollapsible":" ol-collapsed");var i=document.createElement("button");i.setAttribute("type","button"),i.addEventListener("click",(function(){this.toggle()}).bind(this)),t.appendChild(i),i=document.createElement("button"),i.setAttribute("type","button"),i.className="ol-closebox",i.addEventListener("click",(function(){this.toggle()}).bind(this)),t.appendChild(i)}this._legend=e.legend,this._legend.getCanvas().className="ol-legendImg",t.appendChild(this._legend.getCanvas()),t.appendChild(this._legend.getListElement()),e.collapsible!==!1&&e.collapsed===!1&&this.show(),this._legend.on("select",(function(a){this.dispatchEvent(a)}).bind(this)),this._legend.on("refresh",(function(){if(this._onCanvas&&this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this)),this._legend.on("items",(function(a){a.nb?(this.element.classList.remove("ol-empty"),this.element.title=e.title||"legend"):(this.element.classList.add("ol-empty"),this.element.title=e.emptyTitle||"no legend"),this.dispatchEvent(a)}).bind(this))}getLegend(){return this._legend}setCanvas(e){if(this._onCanvas=e,this.element.style.visibility=e?"hidden":"visible",this.getMap())try{this.getMap().renderSync()}catch{}}onCanvas(){return!!this._onCanvas}_draw(e){if(this._onCanvas&&!this.element.classList.contains("ol-collapsed")){var t=this._legend.getCanvas(),i=this.getContext(e),a=i.canvas.height-t.height;i.save(),i.rect(0,a,t.width,t.height);var s="#fff";this._legend.getTextStyle().getBackgroundFill()&&(s=U(this._legend.getTextStyle().getBackgroundFill().getColor())),i.fillStyle=i.strokeStyle=s,i.lineWidth=10,i.lineJoin="round",i.stroke(),i.clearRect(0,a,t.width,t.height),i.fill(),i.drawImage(t,0,a),i.restore()}}show(){if(this.element.classList.contains("ol-collapsed")&&(this.element.classList.remove("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!1}),this.getMap()))try{this.getMap().renderSync()}catch{}}hide(){if(!this.element.classList.contains("ol-collapsed")&&(this.element.classList.add("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:!0}),this.getMap()))try{this.getMap().renderSync()}catch{}}collapse(e){e===!1?this.show():this.hide()}isCollapsed(){return this.element.classList.contains("ol-collapsed")}toggle(){if(this.element.classList.toggle("ol-collapsed"),this.dispatchEvent({type:"change:collapse",collapsed:this.element.classList.contains("ol-collapsed")}),this.getMap())try{this.getMap().renderSync()}catch{}}},De=class extends j{constructor(e){e=e||{};var t=o.create("DIV",{className:e.className||"ol-print"});super({element:t,target:e.target}),e.target||(t.classList.add("ol-unselectable","ol-control"),o.create("BUTTON",{type:"button",title:e.title||"Print",click:(function(){this.print()}).bind(this),parent:t})),this.set("immediate",e.immediate),this.set("imageType",e.imageType||"image/jpeg"),this.set("quality",e.quality||.8),this.set("orientation",e.orientation)}toClipboard(e,t){try{e.canvas.toBlob(function(i){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},i.type,{value:i,enumerable:!0}))]),typeof t=="function"&&t(!0)}catch{typeof t=="function"&&t(!1)}})}catch{typeof t=="function"&&t(!1)}}copyMap(e,t){this.once("print",(function(i){this.toClipboard(i,t)}).bind(this)),this.print(e)}_getCanvas(e,t,i){var a;if(e.context)i=e.context.canvas;else{if(i)a=i.getContext("2d");else{i=document.createElement("canvas");var s=this.getMap().getSize();i.width=s[0],i.height=s[1],a=i.getContext("2d"),/jp.*g$/.test(t)&&(a.fillStyle=this.get("bgColor")||"white",a.fillRect(0,0,i.width,i.height))}this.getMap().getViewport().querySelectorAll(".ol-layers canvas, canvas.ol-fixedoverlay").forEach((function(r){if(r.width){if(a.save(),r.parentNode.style.opacity==="0")return;a.globalAlpha=parseFloat(r.parentNode.style.opacity)||1,a.globalCompositeOperation=o.getStyle(r.parentNode,"mix-blend-mode"),a.filter=o.getStyle(r.parentNode,"filter");var l=o.getStyle(r,"transform")||o.getStyle(r,"-webkit-transform");/^matrix/.test(l)?(l=l.replace(/^matrix\(|\)$/g,"").split(","),l.forEach(function(h,c){l[c]=parseFloat(h)}),a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),a.drawImage(r,0,0)):a.drawImage(r,0,0,o.getStyle(r,"width"),o.getStyle(r,"height")),a.restore()}}).bind(this))}return i}fastPrint(e,t){e=e||{},this._ol6?requestAnimationFrame((function(){t(this._getCanvas({},e.imageType,e.canvas))}).bind(this)):(this.getMap().once("postcompose",(function(i){i.context||(this._ol6=!0),t(this._getCanvas(i,e.imageType,e.canvas))}).bind(this)),this.getMap().render())}print(e){e=e||{};var t=e.imageType||this.get("imageType"),i=e.quality||this.get("quality");if(this.getMap()){if(e.immediate!=="silent"&&this.dispatchEvent(Object.assign({type:"printing"},e)),!e.immediate){setTimeout((function(){e=Object.assign({},e),e.immediate="silent",this.print(e)}).bind(this),200);return}this.getMap().once(this.get("immediate")?"postcompose":"rendercomplete",(function(a){var s=this._getCanvas(a,t),r=e.size||[210,297],l=e.format||"a4",h,c,u,d=e.orient||this.get("orientation"),f=typeof e.margin=="number"?e.margin:10;if(s){d!=="landscape"&&d!=="portrait"&&(d=s.width>s.height?"landscape":"portrait"),d==="landscape"&&(r=[r[1],r[0]]);var g=Math.min((r[0]-2*f)/s.width,(r[1]-2*f)/s.height);h=g*s.width,c=g*s.height,u=[(r[0]-h)/2,(r[1]-c)/2]}var p;try{p=s?s.toDataURL(t,i):null}catch{this.dispatchEvent({type:"error",canvas:s});return}var m=Object.assign({type:"print",print:{format:l,orientation:d,unit:"mm",size:r,position:u,imageWidth:h,imageHeight:c},image:p,imageType:t,quality:i,canvas:s},e);this.dispatchEvent(m)}).bind(this)),this.getMap().render()}}},_t=class extends we{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"")+" ol-control-title ol-unselectable",style:{display:"block",visibility:"hidden"}});super({element:t,style:e.style}),this.setTitle(e.title||""),this.setVisible(e.visible!==!1),this.element.style.font=this.getTextFont()}setStyle(e){super.setStyle(e),this.element&&(this.element.style.font=this.getTextFont()),this.getMap()&&this.getMap().render()}setTitle(e){if(this.element.textContent=e,this.set("title",e),this.getMap())try{this.getMap().renderSync()}catch{}}getTitle(){return this.get("title")}setVisible(e){if(this.element.style.display=e?"block":"none",this.getMap())try{this.getMap().renderSync()}catch{}}getVisible(){return this.element.style.display!=="none"}_draw(e){if(this.getVisible()){var t=this.getContext(e);if(t){var i=e.frameState.pixelRatio;t.save(),t.scale(i,i);var a=this.element.getBoundingClientRect(),s=this.getMap().getViewport().getBoundingClientRect(),r=this.getMap().getSize()[0]/s.width;t.translate(Math.round((a.left-s.left)*r),Math.round((a.top-s.top)*r));var l=this.element.clientHeight,h=this.element.clientWidth,c=h/2;t.beginPath(),t.fillStyle=U(this.getFill().getColor()),t.rect(0,0,h,l),t.fill(),t.closePath(),t.beginPath(),t.fillStyle=U(this.getTextFill().getColor()),t.strokeStyle=U(this.getTextStroke().getColor()),t.lineWidth=this.getTextStroke().getWidth(),t.textAlign="center",t.textBaseline="middle",t.font=this.getTextFont(),t.lineJoin="round",t.lineWidth&&t.strokeText(this.getTitle(),c,l/2),t.fillText(this.getTitle(),c,l/2),t.closePath(),t.restore()}}}},ge=function(n,e){var t=n.getView(),i=t.getProjection(),a=t.getCenter(),s=n.getPixelFromCoordinate(a);s[1]+=1;var r=n.getCoordinateFromPixel(s),l=ye(K(a,i,"EPSG:4326"),K(r,i,"EPSG:4326"));return l*=96/.0254,l},yt=function(n,e,t){if(n&&e){var i=e;if(typeof e=="string"&&(e=e.replace(":","/").split("/"),i=e[1],i||(i=e[0]||""),i=i.replace(/[^\d]/g,""),i=parseInt(i),e[1])){var a=parseInt(e[0]);a&&(i/=a)}if(!i)return;var s=n.getView(),r=s.getProjection(),l=s.getCenter(),h=n.getPixelFromCoordinate(l);h[1]+=1;var c=n.getCoordinateFromPixel(h),u=ye(K(l,r,"EPSG:4326"),K(c,r,"EPSG:4326"));return u*=96/.0254,s.setResolution(s.getResolution()*i/u),i}},Ie=class extends we{constructor(e){e=e||{};var t=document.createElement("div");t.className="ol-control ol-compassctrl ol-unselectable ol-hidden"+(e.className?" "+e.className:""),t.style.position="absolute",t.style.visibility="hidden";var i=e.style instanceof W?new H({stroke:e.style}):e.style;e.style||(i=new H({stroke:new W({width:0})})),super({element:t,style:i}),this.set("rotateVithView",e.rotateWithView!==!1),this.setVisible(e.visible!==!1),this.setImage(e.image||e.src)}setImage(e){if(e instanceof Image)this.img_=e,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this);else if(typeof e=="string")switch(e){case"compact":{this.img_=this.compactCompass_(this.element.clientWidth,this.getStroke().getColor());break}case"default":{this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor());break}default:{this.img_=new Image,this.img_.onload=(function(){if(this.getMap())try{this.getMap().renderSync()}catch{}}).bind(this),this.img_.src=e;break}}else this.img_=this.defaultCompass_(this.element.clientWidth,this.getStroke().getColor())}compactCompass_(e,t){var i=document.createElement("canvas"),a=i.getContext("2d");e=i.width=i.height=e||150;var s=e/2;return a.translate(s,s),a.fillStyle=t||"#963",a.lineWidth=5,a.lineJoin=a.lineCap="round",a.font="bold "+s*.4+"px sans-serif",a.textBaseline="bottom",a.textAlign="center",a.strokeStyle="#fff",a.globalAlpha=.75,a.strokeText("N",0,-s/2),a.globalAlpha=1,a.fillText("N",0,-s/2),a.beginPath(),a.moveTo(0,s/4),a.lineTo(s/3,s/2),a.lineTo(0,-s/2),a.lineTo(-s/3,s/2),a.lineTo(0,s/4),a.lineWidth=12,a.fillStyle="#fff",a.globalAlpha=.75,a.fill(),a.stroke(),a.globalAlpha=1,a.fillStyle=a.strokeStyle=t||"#963",a.lineWidth=5,a.beginPath(),a.moveTo(0,s/4),a.lineTo(0,-s/2),a.lineTo(s/3,s/2),a.lineTo(0,s/4),a.fill(),a.stroke(),a.beginPath(),a.moveTo(0,s/4),a.lineTo(0,-s/2),a.lineTo(-s/3,s/2),a.lineTo(0,s/4),a.stroke(),i}defaultCompass_(e,t){var i=document.createElement("canvas"),a=i.getContext("2d");e=i.width=i.height=e||150;var s=e/2,r=.22*s;function l(c,u){a.fillStyle=t||"#963",a.beginPath(),a.moveTo(0,0),a.lineTo(c,0),a.lineTo(u,u),a.moveTo(0,0),a.lineTo(-c,0),a.lineTo(-u,-u),a.moveTo(0,0),a.lineTo(0,c),a.lineTo(-u,u),a.moveTo(0,0),a.lineTo(0,-c),a.lineTo(u,-u),a.moveTo(0,0),a.fill(),a.stroke()}function h(c,u){a.globalCompositeOperation="destination-out",a.fillStyle="#fff",a.beginPath(),a.moveTo(0,0),a.lineTo(c,0),a.lineTo(u,-u),a.moveTo(0,0),a.lineTo(-c,0),a.lineTo(-u,u),a.moveTo(0,0),a.lineTo(0,c),a.lineTo(u,u),a.moveTo(0,0),a.lineTo(0,-c),a.lineTo(-u,-u),a.moveTo(0,0),a.fill(),a.globalCompositeOperation="source-over",a.beginPath(),a.moveTo(0,0),a.lineTo(c,0),a.lineTo(u,-u),a.moveTo(0,0),a.lineTo(-c,0),a.lineTo(-u,u),a.moveTo(0,0),a.lineTo(0,c),a.lineTo(u,u),a.moveTo(0,0),a.lineTo(0,-c),a.lineTo(-u,-u),a.moveTo(0,0),a.stroke()}return a.translate(s,s),a.strokeStyle=t||"#963",a.lineWidth=1.5,a.beginPath(),a.arc(0,0,e*.41,0,2*Math.PI),a.arc(0,0,e*.44,0,2*Math.PI),a.stroke(),a.rotate(Math.PI/4),l(s*.9,r*.8),h(s*.9,r*.8),a.rotate(-Math.PI/4),l(s,r),h(s,r),i}getVisible(){return o.getStyle(this.element,"display")==="block"}setVisible(e){e?this.element.classList.add("ol-visible"):this.element.classList.remove("ol-visible"),this.getMap()&&this.getMap().render()}_draw(e){var t=this.getContext(e);if(!(!t||!this.getVisible())){var i=t.canvas,a,s=[];for(a=0;a<8;a++)s[a]=[Math.cos(Math.PI*a/8),Math.sin(Math.PI*a/8)];var r=e.frameState.pixelRatio;t.save(),t.scale(r,r);var l=this.element.clientWidth,h=this.element.clientHeight,c={left:this.element.offsetLeft,top:this.element.offsetTop},u=this.img_,d=e.frameState.viewState.rotation;if(t.beginPath(),t.translate(c.left+l/2,c.top+h/2),this.get("rotateVithView")&&t.rotate(d),this.getStroke().getWidth()){t.beginPath(),t.strokeStyle=this.getStroke().getColor(),t.lineWidth=this.getStroke().getWidth();var f=Math.max(i.width,i.height);for(a=0;a<8;a++)t.moveTo(-s[a][0]*f,-s[a][1]*f),t.lineTo(s[a][0]*f,s[a][1]*f);t.stroke()}u.width&&t.drawImage(u,-l/2,-h/2,l,h),t.closePath(),t.restore()}}},Q=class extends j{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"ol-print")+" ol-unselectable ol-control"});super({element:t}),this._lang=e.lang||"en",e.target||o.create("BUTTON",{type:"button",title:e.title||"Print",click:(function(){this.print()}).bind(this),parent:t}),e.openWindow&&this.on("print",function(b){b.canvas&&window.open().document.write('<img src="'+b.canvas.toDataURL()+'"/>')}),e.target=o.create("DIV");var i=this._printCtrl=new De(e);i.on(["print","error","printing"],(function(b){this._printing(b)}).bind(this)),this._compass=new Ie({src:e.northImage||"compact",visible:!1,className:"olext-print-compass",style:new W({color:"#333",width:0})});var a=this._printDialog=new Fe({target:e.targetDialog||document.body,closeBox:!0,className:"ol-ext-print-dialog"}),s=a.getContentElement();this._input={};var r=o.create("DIV",{className:"ol-print-param",parent:s});this._pages=[o.create("DIV",{className:"ol-page"})];var l=o.create("DIV",{className:"ol-map",parent:this._pages[0]});o.create("DIV",{html:this._pages[0],className:"ol-print-map",parent:s}),o.create("H2",{html:this.i18n("title"),parent:r});var h=o.create("UL",{parent:r}),c=o.create("LI",{className:"ol-orientation",parent:h});this._input.orientation={list:c};var u=o.create("LABEL",{className:"portrait",parent:c});this._input.orientation.portrait=o.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"portrait",checked:!0,on:{change:(function(b){this.setOrientation(b.target.value)}).bind(this)},parent:u}),o.create("SPAN",{html:this.i18n("portrait"),parent:u}),u=o.create("LABEL",{className:"landscape",parent:c}),this._input.orientation.landscape=o.create("INPUT",{type:"radio",name:"ol-print-orientation",value:"landscape",on:{change:(function(b){this.setOrientation(b.target.value)}).bind(this)},parent:u}),o.create("SPAN",{html:this.i18n("landscape"),parent:u});var d;c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("size")}),className:"ol-size",parent:h});var f=this._input.size=o.create("SELECT",{on:{change:(function(){this.setSize(f.value||M)}).bind(this)},parent:c});for(d in this.paperSize)o.create("OPTION",{html:d+(this.paperSize[d]?" - "+this.paperSize[d][0]+"x"+this.paperSize[d][1]+" mm":this.i18n("custom")),value:d,parent:f});c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("margin")}),className:"ol-margin",parent:h});var g=this._input.margin=o.create("SELECT",{on:{change:(function(){this.setMargin(g.value)}).bind(this)},parent:c});for(d in this.marginSize)o.create("OPTION",{html:this.i18n(d)+" - "+this.marginSize[d]+" mm",value:this.marginSize[d],parent:g});c=o.create("LI",{html:o.create("LABEL",{html:this.i18n("scale")}),className:"ol-scale",parent:h});var p=this._input.scale=o.create("SELECT",{on:{change:(function(){this.setScale(parseInt(p.value))}).bind(this)},parent:c});Object.keys(this.scales).forEach((function(b){o.create("OPTION",{html:this.scales[b],value:b,parent:p})}).bind(this)),c=o.create("LI",{className:"ol-legend",parent:h});var m=o.createSwitch({html:this.i18n("legend"),checked:!1,on:{change:(function(){C.legend.control.setCanvas(m.checked)}).bind(this)},parent:c});c=o.create("LI",{className:"ol-print-north",parent:h});var L=this._input.north=o.createSwitch({html:this.i18n("north"),checked:"checked",on:{change:(function(){L.checked?this._compass.element.classList.add("ol-print-compass"):this._compass.element.classList.remove("ol-print-compass"),this.getMap().render()}).bind(this)},parent:c});c=o.create("LI",{className:"ol-print-title",parent:h});var w=o.createSwitch({html:this.i18n("mapTitle"),checked:!1,on:{change:(function(b){C.title.control.setVisible(b.target.checked)}).bind(this)},parent:c}),T=o.create("INPUT",{type:"text",placeholder:this.i18n("mapTitle"),on:{keydown:function(b){b.keyCode===13&&b.preventDefault()},keyup:function(){C.title.control.setTitle(T.value)},change:(function(){C.title.control.setTitle(T.value)}).bind(this)},parent:c}),k=o.create("DIV",{className:"ol-user-param",parent:r});c=o.create("LI",{className:"ol-saveas",parent:h}),o.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:c});var x=o.create("SELECT",{on:{change:(function(){var b=x.value;if(x.value="",!(this.formats[b].clipboard&&this._copyMap(b))){var _=typeof this.getSize()=="string"?this.getSize():null,I=Object.assign({format:_,size:_?this.paperSize[_]:null,orient:this.getOrientation(),margin:this.getMargin()},this.formats[b]);i.print(I)}}).bind(this)},parent:c});o.create("OPTION",{html:this.i18n("saveas"),style:{display:"none"},value:"",parent:x}),this.formats.forEach((function(b,_){if(b.pdf){if(e.pdf===!1)return}else if(b.clipboard){if(e.copy===!1)return}else if(e.save===!1)return;o.create("OPTION",{html:this.i18n(b.title),value:_,parent:x})}).bind(this)),x.querySelectorAll("option").length===1&&(x.style.display="none"),c=o.create("LI",{className:"ol-savelegend",parent:h});var A=o.create("DIV",{html:this.i18n("copied"),className:"ol-clipboard-copy",parent:c}),y=o.create("SELECT",{on:{change:(function(){var b=C.legend.control.getLegend().getCanvas(),_=document.createElement("canvas");_.width=b.width,_.height=b.height;var I=_.getContext("2d");if(I.fillStyle="#fff",I.fillRect(0,0,_.width,_.height),I.drawImage(b,0,0),this.formats[y.value].clipboard)_.toBlob(function(D){try{navigator.clipboard.write([new window.ClipboardItem(Object.defineProperty({},D.type,{value:D,enumerable:!0}))]),A.classList.add("visible"),setTimeout(function(){A.classList.remove("visible")},1e3)}catch{}},"image/png");else{var P;try{P=_.toDataURL(this.formats[y.value].imageType,this.formats[y.value].quality);var F=typeof this.getSize()=="string"?this.getSize():"A4",Y=_.width/96*25.4,Z=_.height/96*25.4,z=this.paperSize[F];this.getOrientation()==="landscape"&&(z=[z[1],z[0]]);var $=[(z[0]-Y)/2,(z[1]-Z)/2];this.dispatchEvent({type:"print",print:{legend:!0,format:F,orientation:this.getOrientation(),unit:"mm",size:this.paperSize[F],position:$,imageWidth:Y,imageHeight:Z},image:P,imageType:this.formats[y.value].imageType,pdf:this.formats[y.value].pdf,quality:this.formats[y.value].quality,canvas:_})}catch{}}y.value=""}).bind(this)},parent:c});o.create("OPTION",{html:this.i18n("saveLegend"),style:{display:"none"},value:"",parent:y}),this.formats.forEach((function(b,_){o.create("OPTION",{html:this.i18n(b.title),value:_,parent:y})}).bind(this));var v=o.create("DIV",{className:"ol-ext-buttons",parent:r});o.create("BUTTON",{html:this.i18n("printBt"),type:"submit",click:function(b){b.preventDefault(),window.print()},parent:v}),o.create("BUTTON",{html:this.i18n("cancel"),type:"button",click:function(){a.hide()},parent:v}),o.create("DIV",{html:this.i18n("errorMsg"),className:"ol-error",parent:r});var E,M,S,C={};a.on("show",(function(){this.dispatchEvent({type:"show",userElement:k,dialog:this._printDialog,page:this.getPage()});var b=this.getMap();b&&(document.body.classList.add("ol-print-document"),E=b.getTargetElement(),M=b.getSize(),typeof this.getSize()=="string"?this.setSize(this.getSize()):this.setSize(M),b.setTarget(l),S&&q(S),S=b.on("moveend",(function(){this.setScale(ge(b))}).bind(this)),this.setScale(ge(b)),C={},this.getMap().getControls().forEach((function(_){_ instanceof vt&&(C.legend={control:_}),_ instanceof _t&&(C.title={control:_}),_ instanceof Ie&&(C.compass?_.element.classList.remove("ol-print-compass"):(this._input.north.checked?_.element.classList.add("ol-print-compass"):_.element.classList.remove("ol-print-compass"),this._compass=_,C.compass={control:_}))}).bind(this)),C.title?(w.checked=C.title.isVisible=C.title.control.getVisible(),T.value=C.title.control.getTitle(),w.parentNode.parentNode.classList.remove("hidden")):w.parentNode.parentNode.classList.add("hidden"),C.legend?(C.legend.ison=C.legend.control.onCanvas(),C.legend.collapsed=C.legend.control.isCollapsed(),C.legend.control.collapse(!1),y.parentNode.classList.remove("hidden"),m.parentNode.parentNode.classList.remove("hidden"),m.checked=!C.legend.collapsed,C.legend.control.setCanvas(!C.legend.collapsed)):(y.parentNode.classList.add("hidden"),m.parentNode.parentNode.classList.add("hidden")))}).bind(this)),a.on("hide",(function(){document.body.classList.remove("ol-print-document"),E&&(this.getMap().setTarget(E),E=null,S&&q(S),C.title&&C.title.control.setVisible(C.title.isVisible),C.legend&&(C.legend.control.setCanvas(C.legend.ison),C.legend.control.collapse(C.legend.collapsed)),this.dispatchEvent({type:"hide"}))}).bind(this)),window.addEventListener("resize",(function(){this.setSize()}).bind(this)),e.saveAs&&this.on("print",function(b){b.pdf||b.canvas.toBlob(function(_){var I=(b.print.legend?"legend.":"map.")+b.imageType.replace("image/","");e.saveAs(_,I)},b.imageType,b.quality)}),e.jsPDF&&this.on("print",function(b){if(b.pdf){var _=new e.jsPDF({orientation:b.print.orientation,unit:b.print.unit,format:b.print.size});_.addImage(b.image,"JPEG",b.print.position[0],b.print.position[0],b.print.imageWidth,b.print.imageHeight),_.save(b.print.legend?"legend.pdf":"map.pdf")}})}static addLang(e,t){Q.prototype._labels[e]=t}isOpen(){return this._printDialog.isOpen()}i18n(e){var t=this._labels.en[e]||e;return this._labels[this._lang]&&this._labels[this._lang][e]&&(t=this._labels[this._lang][e]),t}getOrientation(){return this._orientation||"portrait"}setOrientation(e){this._orientation=e==="landscape"?"landscape":"portrait",this._printDialog.element.dataset.orientation=this._orientation,this._input.orientation[this._orientation].checked=!0,this.setSize()}getMargin(){return this._margin||0}setMargin(e){this._margin=e,this._input.margin.value=e,this.setSize()}getSize(){return this._size}setSize(e){if(this._printDialog.getContentElement().dataset.status="",e?this._size=e:e=this._size,!!e){if(typeof e=="string"){for(var t in this.paperSize)t&&new RegExp(t,"i").test(e)&&(e=t);this.paperSize[e]||(e=this._size="A4"),this._input.size.value=e,e=[Math.trunc(this.paperSize[e][0]*96/25.4),Math.trunc(this.paperSize[e][1]*96/25.4)],this.getOrientation()==="landscape"&&(e=[e[1],e[0]]),this.getPage().classList.remove("margin")}else this._input.size.value="",this.getPage().classList.add("margin");var i=this.getPage(),a=i.parentNode.getBoundingClientRect(),s=(a.width-40)/e[0],r=(a.height-40)/e[1],l=Math.min(s,r,1);i.style.width=e[0]+"px",i.style.height=e[1]+"px",i.style["-webkit-transform"]=i.style.transform="translate(-50%,-50%) scale("+l+")";var h=Math.round(5/l);i.style["-webkit-box-shadow"]=i.style["box-shadow"]=h+"px "+h+"px "+h+"px rgba(0,0,0,.6)",i.style.padding=this.getMargin()*96/25.4+"px",this.getMap()&&this.getMap().updateSize(),this.dispatchEvent({type:"dialog:refresh"})}}_printing(e){this._printDialog.getContentElement().dataset.status=e.type,e.clipboard||this.dispatchEvent(e)}_copyMap(e){var t=this._printDialog.element.querySelector(".ol-clipboard-copy");return this._printCtrl.copyMap(this.formats[e],function(i){i&&(t.classList.add("visible"),setTimeout(function(){t.classList.remove("visible")},1e3))}),!0}getContentElement(){return this._printDialog.getContentElement()}getUserElement(){return this._printDialog.getContentElement().querySelector(".ol-user-param")}getPage(){return this._pages[0]}setMap(e){this.getMap()&&(this.getMap().removeControl(this._compass),this.getMap().removeControl(this._printCtrl),this.getMap().removeControl(this._printDialog)),super.setMap(e),this.getMap()&&(this.getMap().addControl(this._compass),this.getMap().addControl(this._printCtrl),this.getMap().addControl(this._printDialog))}setScale(e){yt(this.getMap(),e),this._input.scale.value=" "+Math.round(e/100)*100}getScale(){return ge(this.getMap())}print(e){e=e||{},e.size&&this.setSize(e.size),e.scale&&this.setScale(e.scale),e.orientation&&this.setOrientation(e.orientation),e.margin&&this.setMargin(e.margin),this._printDialog.show()}getPrintControl(){return this._printCtrl}};Q.prototype._labels={en:{title:"Print",orientation:"Orientation",portrait:"Portrait",landscape:"Landscape",size:"Page size",custom:"screen size",margin:"Margin",scale:"Scale",legend:"Legend",north:"North arrow",mapTitle:"Map title",saveas:"Save as...",saveLegend:"Save legend...",copied:"✔ Copied to clipboard",errorMsg:"Can't save map canvas...",printBt:"Print...",clipboardFormat:"copy to clipboard...",jpegFormat:"save as jpeg",pngFormat:"save as png",pdfFormat:"save as pdf",none:"none",small:"small",large:"large",cancel:"cancel"},fr:{title:"Imprimer",orientation:"Orientation",portrait:"Portrait",landscape:"Paysage",size:"Taille du papier",custom:"taille écran",margin:"Marges",scale:"Echelle",legend:"Légende",north:"Flèche du nord",mapTitle:"Titre de la carte",saveas:"Enregistrer sous...",saveLegend:"Enregistrer la légende...",copied:"✔ Carte copiée",errorMsg:"Impossible d'enregistrer la carte",printBt:"Imprimer",clipboardFormat:"copier dans le presse-papier...",jpegFormat:"enregistrer un jpeg",pngFormat:"enregistrer un png",pdfFormat:"enregistrer un pdf",none:"aucune",small:"petites",large:"larges",cancel:"annuler"},de:{title:"Drucken",orientation:"Ausrichtung",portrait:"Hochformat",landscape:"Querformat",size:"Papierformat",custom:"Bildschirmgröße",margin:"Rand",scale:"Maßstab",legend:"Legende",north:"Nordpfeil",mapTitle:"Kartentitel",saveas:"Speichern als...",saveLegend:"Legende speichern...",copied:"✔ In die Zwischenablage kopiert",errorMsg:"Kann Karte nicht speichern...",printBt:"Drucken...",clipboardFormat:"in die Zwischenablage kopieren...",jpegFormat:"speichern als jpeg",pngFormat:"speichern als png",pdfFormat:"speichern als pdf",none:"kein",small:"klein",large:"groß",cancel:"abbrechen"},zh:{title:"打印",orientation:"方向",portrait:"纵向",landscape:"横向",size:"页面大小",custom:"屏幕大小",margin:"外边距",scale:"尺度",legend:"图例",north:"指北针",mapTitle:"地图名字",saveas:"保存为...",saveLegend:"保存图例为...",copied:"✔ 已复制到剪贴板",errorMsg:"无法保存地图...",printBt:"打印...",cancel:"取消"},it:{title:"Stampa",orientation:"Orientamento",portrait:"Verticale",landscape:"Orizzontale",size:"Formato pagina",custom:"Dimensione schermo",margin:"Margini",scale:"Scala",legend:"Legenda",north:"Freccia nord",mapTitle:"Titolo della mappa",saveas:"Salva con nome...",saveLegend:"Salva legenda...",copied:"✔ Copiato negli appunti",errorMsg:"Impossibile salvare la mappa",printBt:"Stampa",clipboardFormat:"Copia negli appunti...",jpegFormat:"salva come jpeg",pngFormat:"salva come png",pdfFormat:"salva come pdf",none:"nessuno",small:"piccolo",large:"grande",cancel:"annulla"},"pt-br":{title:"Imprimir",orientation:"Orientação",portrait:"Retrato",landscape:"Paisagem",size:"Tamanho da página",custom:"Tamanho da tela",margin:"Margem",scale:"Escala",legend:"Legenda",north:"Seta do norte",mapTitle:"Título do mapa",saveas:"Salvar como...",saveLegend:"Salvar legenda...",copied:"✔ Copiado para a área de transferência",errorMsg:"Não foi possível salvar o mapa...",printBt:"Imprimir...",clipboardFormat:"Copiar para a área de transferência...",jpegFormat:"Salvar como JPEG",pngFormat:"Salvar como PNG",pdfFormat:"Salvar como PDF",none:"Nenhum",small:"Pequeno",large:"Grande",cancel:"Cancelar"}};Q.prototype.paperSize={"":null,A0:[841,1189],A1:[594,841],A2:[420,594],A3:[297,420],A4:[210,297],"US Letter":[215.9,279.4],A5:[148,210],B4:[257,364],B5:[182,257]};Q.prototype.marginSize={none:0,small:5,large:10};Q.prototype.formats=[{title:"clipboardFormat",imageType:"image/png",clipboard:!0},{title:"jpegFormat",imageType:"image/jpeg",quality:.8},{title:"pngFormat",imageType:"image/png",quality:.8},{title:"pdfFormat",imageType:"image/jpeg",pdf:!0}];Q.prototype.scales={" 5000":"1/5.000"," 10000":"1/10.000"," 25000":"1/25.000"," 50000":"1/50.000"," 100000":"1/100.000"," 250000":"1/250.000"," 1000000":"1/1.000.000"};var Se=function(n,e){var t=n[0]-e[0],i=n[1]-e[1];return Math.sqrt(t*t+i*i)},Oe;(function(){function n(t,i){var a;for(let s=t.length-1;s>0;s--)(t[s][0]>i&&t[s-1][0]<i||t[s][0]<i&&t[s-1][0]>i)&&(a=[i,(i-t[s][0])/(t[s-1][0]-t[s][0])*(t[s-1][1]-t[s][1])+t[s][1]],t.splice(s,0,a))}function e(t,i){var a;for(let s=t.length-1;s>0;s--)(t[s][1]>i&&t[s-1][1]<i||t[s][1]<i&&t[s-1][1]>i)&&(a=[(i-t[s][1])/(t[s-1][1]-t[s][1])*(t[s-1][0]-t[s][0])+t[s][0],i],t.splice(s,0,a))}Oe=function(t,i){var a=i.getType()==="Polygon";if(!a&&i.getType()!=="MultiPolygon")return null;var s=i.getCoordinates();return a&&(s=[s]),s.forEach(function(r){r.forEach(function(l){n(l,t[0]),n(l,t[2]),e(l,t[1]),e(l,t[3])})}),s.forEach(function(r){r.forEach(function(l){l.forEach(function(h){h[0]<t[0]?h[0]=t[0]:h[0]>t[2]&&(h[0]=t[2]),h[1]<t[1]?h[1]=t[1]:h[1]>t[3]&&(h[1]=t[3])})})}),a?new oe(s[0]):new ce(s)}})();var de=function(n,e,t,i){var a=[];i!==!1&&a.push(n);var s=Se(n,e);if(s){var r=Math.round(s/t);if(r>1)for(var l=(e[0]-n[0])/r,h=(e[1]-n[1])/r,c=1;c<r;c++)a.push([n[0]+l*c,n[1]+h*c])}return a.push(e),a};pe.prototype.sampleAt=function(n){for(var e=this.getCoordinates(),t=[],i=1;i<e.length;i++)t=t.concat(de(e[i-1],e[i],n,i===1));return new pe(t)};Ce.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var a=[],s=1;s<i.length;s++)a=a.concat(de(i[s-1],i[s],n,s===1));t.push(a)}),new Ce(t)};oe.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){for(var a=[],s=1;s<i.length;s++)a=a.concat(de(i[s-1],i[s],n,s===1));t.push(a)}),new oe(t)};ce.prototype.sampleAt=function(n){var e=this.getCoordinates(),t=[];return e.forEach(function(i){var a=[];t.push(a),i.forEach(function(s){for(var r=[],l=1;l<s.length;l++)r=r.concat(de(s[l-1],s[l],n,l===1));a.push(r)})}),new ce(t)};rt.prototype.intersection=function(n,e){if(n.sampleAt){var t=he(this.getCenter().concat(this.getCenter()),this.getRadius());n=Oe(t,n),n=n.simplify(e);var i=this.getCenter(),a=this.getRadius(),s=n.sampleAt(e).getCoordinates();switch(n.getType()){case"Polygon":s=[s];case"MultiPolygon":{var r=!1,l=[];return s.forEach(function(h){var c=[];l.push(c),h.forEach(function(u){var d=[];c.push(d),u.forEach(function(f){var g=Se(i,f);g>a?(r=!0,d.push([i[0]+a/g*(f[0]-i[0]),i[1]+a/g*(f[1]-i[1])])):d.push(f)})})}),r?n.getType()==="Polygon"?new oe(l[0]):new ce(l):n}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+n.getType());return n};var N=class extends j{constructor(e){e=e||{};var t=document.createElement("div");super({element:t,target:e.target});var i=this;if(this.info=e.info||N.prototype.info,e.target)t.classList.add(e.className||"ol-profile");else{t.className=((e.className||"ol-profile")+" ol-unselectable ol-control ol-collapsed").trim(),this.button=document.createElement("button"),this.button.title=e.title||"Profile",this.button.setAttribute("type","button");var a=function(x){i.toggle(),x.preventDefault()};this.button.addEventListener("click",a),this.button.addEventListener("touchstart",a),t.appendChild(this.button),o.create("I",{parent:this.button})}e.style instanceof H?this._style=e.style:this._style=new H({text:new ie,stroke:new W({width:1.5,color:"#369"})}),this._style.getText()||this._style.setText(new ie),e.selectStyle instanceof H?this._selectStyle=e.selectStyle:this._selectStyle=new H({fill:new ne({color:"#369"})});var s=document.createElement("div");s.classList.add("ol-inner"),t.appendChild(s);var r=document.createElement("div");r.style.position="relative",s.appendChild(r);var l=this.ratio=2;this.canvas_=document.createElement("canvas"),this.canvas_.width=(e.width||300)*l,this.canvas_.height=(e.height||150)*l;var h={msTransform:"scale(0.5,0.5)",msTransformOrigin:"0 0",webkitTransform:"scale(0.5,0.5)",webkitTransformOrigin:"0 0",mozTransform:"scale(0.5,0.5)",mozTransformOrigin:"0 0",transform:"scale(0.5,0.5)",transformOrigin:"0 0"};Object.keys(h).forEach(function(x){x in i.canvas_.style&&(i.canvas_.style[x]=h[x])}),this.div_to_canvas_=document.createElement("div"),r.appendChild(this.div_to_canvas_),this.div_to_canvas_.style.width=this.canvas_.width/l+"px",this.div_to_canvas_.style.height=this.canvas_.height/l+"px",this.div_to_canvas_.appendChild(this.canvas_),this.setProperties({units:e.units||"metric",numberFormat:e.numberFormat,selectable:e.selectable,skipFirst:parseInt(e.skipFirst)||0}),this._isMetric=this.get("units")==="metric",this.margin_={top:10*l,left:45*l,bottom:30*l,right:10*l},this.info.ytitle||(this.margin_.left-=20*l),this.info.xtitle||(this.margin_.bottom-=20*l),this.bar_=document.createElement("div"),this.bar_.classList.add("ol-profilebar"),this.bar_.style.top=this.margin_.top/l+"px",this.bar_.style.height=(this.canvas_.height-this.margin_.top-this.margin_.bottom)/l+"px",r.appendChild(this.bar_),this.cursor_=document.createElement("div"),this.cursor_.classList.add("ol-profilecursor"),r.appendChild(this.cursor_),this.popup_=document.createElement("div"),this.popup_.classList.add("ol-profilepopup"),this.cursor_.appendChild(this.popup_);var c=document.createElement("table");c.cellPadding="0",c.cellSpacing="0",c.style.clientWidth=this.canvas_.width/l+"px",r.appendChild(c);var u=o.create("tr",{className:"track-info",parent:c});o.create("td",{html:(this.info.zmin||"Zmin")+': <span class="zmin zinfo"></span>',parent:u}),o.create("td",{html:(this.info.zmax||"Zmax")+': <span class="zmax"></span>',parent:u});var d=o.create("td",{parent:u});d.innerHTML=(this.info.distance||"Distance")+': <span class="dist"></span>';var f=o.create("td",{parent:u});f.innerHTML=(this.info.time||"Time")+': <span class="time"></span>';var g=o.create("tr",{className:"track-info track-options",parent:c});o.create("td",{html:(this.info.elevation||"Elevation gain")+': <br/><span class="elevationGain"></span> / <span class="elevationLoss"></span>',colspan:2,parent:g}),o.create("td",{html:(this.info.maxslope||"Max. slope")+': <span class="maxSlope"></span>',parent:g}),o.create("td",{html:(this.info.avgslope||"Average slope")+': <span class="avgSlope"></span>',parent:g});var p=document.createElement("tr");p.classList.add("point-info"),c.appendChild(p);var m=document.createElement("td");m.innerHTML=(this.info.altitude||"Altitude")+': <span class="z"></span>',p.appendChild(m);var L=document.createElement("td");L.innerHTML=(this.info.distance||"Distance")+': <span class="dist"></span>',p.appendChild(L);var w=document.createElement("td");if(w.innerHTML=(this.info.time||"Time")+': <span class="time"></span>',p.appendChild(w),this.tab_=[],e.feature&&this.setGeometry(e.feature),e.zoomable){this.set("selectable",!0);var T,k;this.on("change:geometry",function(){k=null}),this.on("dragstart",function(x){T=x.index}),this.on("dragend",(function(x){if(Math.abs(T-x.index)>10){if(!k)var A=o.create("BUTTON",{parent:t,className:"ol-zoom-out",click:(function(E){E.stopPropagation(),E.preventDefault(),k&&(this.dispatchEvent({type:"zoom"}),this.setGeometry(k,this._geometry[1])),t.removeChild(A)}).bind(this)});var y=k||this._geometry[0],v=new pe(this.getSelection(T,x.index));this.setGeometry(v,this._geometry[1]),k=y,this.dispatchEvent({type:"zoom",geometry:v,start:T,end:x.index})}}).bind(this))}e.target&&this._addListeners()}_addListeners(){this.onMoveBinded||(this.onMoveBinded=this.onMove.bind(this),this.div_to_canvas_.addEventListener("pointerdown",this.onMoveBinded),this.div_to_canvas_.addEventListener("mousemove",this.onMoveBinded),this.div_to_canvas_.addEventListener("touchmove",this.onMoveBinded),document.addEventListener("pointerup",this.onMoveBinded))}_removeListeners(){this.onMoveBinded&&(this.div_to_canvas_.removeEventListener("pointerdown",this.onMoveBinded),this.div_to_canvas_.removeEventListener("mousemove",this.onMoveBinded),this.div_to_canvas_.removeEventListener("touchmove",this.onMoveBinded),document.removeEventListener("pointerup",this.onMoveBinded),this.onMoveBinded=null)}popup(e){this.popup_.innerHTML=e}_drawAt(e,t){if(e){this.cursor_.style.left=t+"px",this.cursor_.style.top=(this.canvas_.height-this.margin_.bottom+e[1]*this.scale_[1]+this.dy_)/this.ratio+"px",this.cursor_.style.display="block",this.bar_.parentElement.classList.add("over"),this.bar_.style.left=t+"px",this.bar_.style.display="block";var i=this._isMetric?N.prototype.Unit.Meter:N.prototype.Unit.Foot,a=this._unitsConversion(e[1],i);this.element.querySelector(".point-info .z").textContent=typeof a=="number"?this._numberFormat(a,this.get("zDigitsHover"))+i:"-";var s;this._isMetric?s=r>N.prototype.KILOMETER_VALUE?N.prototype.Unit.Kilometer:N.prototype.Unit.Meter:s=r>N.prototype.MILE_VALUE?N.prototype.Unit.Mile:N.prototype.Unit.Foot;var r=this._unitsConversion(e[0],s);this.element.querySelector(".point-info .dist").textContent=typeof r=="number"?this._numberFormat(r,this.get("xDigitsHover"))+s:"-",this.element.querySelector(".point-info .time").textContent=e[2],t>this.canvas_.width/this.ratio/2?this.popup_.classList.add("ol-left"):this.popup_.classList.remove("ol-left")}else this.cursor_.style.display="none",this.bar_.style.display="none",this.cursor_.style.display="none",this.bar_.parentElement.classList.remove("over")}showAt(e){var t,i,a,s=1/0;if(typeof e>"u")this.bar_.parentElement.classList.contains("over")&&this._drawAt();else if(e.length)for(t=1;i=this.tab_[t];t++){var r=Se(i[3],e);r<s&&(a=i,s=r)}else for(t=0;(i=this.tab_[t])&&(a=i,!(i[0]>=e));t++);if(a){var l=(a[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(a,l),a[3]}return null}showAtTime(e,t){var i,a,s;if(e instanceof Date?e=e.getTime()/1e3:t&&(e+=this.tab_[0][3][3]),typeof e>"u")this.bar_.parentElement.classList.contains("over")&&this._drawAt();else for(i=0;(a=this.tab_[i])&&(s=a,!(a[3][3]>=e));i++);if(s){var r=(s[0]*this.scale_[0]+this.margin_.left)/this.ratio;return this._drawAt(s,r),s[3]}return null}pointAtTime(e){var t,i;for(t=1;i=this.tab_[t];t++){var a=i[3][3];if(a>=e){var s=this.tab_[t-1][3];return(s[3]+a)/2<e?s:i}}return this.tab_[this.tab_.length-1][3]}onMove(e){if(this.tab_.length){var t=this.canvas_.getBoundingClientRect(),i={top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft},a=e.pageX||e.touches&&e.touches.length&&e.touches[0].pageX||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageX,s=e.pageY||e.touches&&e.touches.length&&e.touches[0].pageY||e.changedTouches&&e.changedTouches.length&&e.changedTouches[0].pageY,r=a-i.left,l=s-i.top,h=this.ratio;if(r>this.margin_.left/h-20&&r<(this.canvas_.width-this.margin_.right)/h+8&&l>this.margin_.top/h&&l<(this.canvas_.height-this.margin_.bottom)/h){var c=(r*h-this.margin_.left)/this.scale_[0],u=this.tab_[0],d,f;for(d=1;f=this.tab_[d];d++)if(f[0]>=c){c<(f[0]+u[0])/2&&(d=0,f=u);break}if(f||(f=this.tab_[this.tab_.length-1]),r=Math.max(this.margin_.left/h,Math.min(r,(this.canvas_.width-this.margin_.right)/h)),typeof f[1]>"u")return;switch(this._drawAt(f,r),this.dispatchEvent({type:"over",click:e.type==="click",index:d,coord:f[3],time:f[2],distance:f[0]}),e.type){case"pointerdown":{this._dragging={event:{type:"dragstart",index:d,coord:f[3],time:f[2],distance:f[0]},pageX:a,pageY:s};break}case"pointerup":{this._dragging&&this._dragging.pageX?Math.abs(this._dragging.pageX-a)<3&&Math.abs(this._dragging.pageY-s)<3&&(this.dispatchEvent({type:"click",index:d,coord:f[3],time:f[2],distance:f[0]}),this.refresh()):this.dispatchEvent({type:"dragend",index:d,coord:f[3],time:f[2],distance:f[0]}),this._dragging=!1;break}default:{if(this._dragging)if(this._dragging.pageX)(Math.abs(this._dragging.pageX-a)>3||Math.abs(this._dragging.pageY-s)>3)&&(this._dragging.pageX=this._dragging.pageY=!1,this.dispatchEvent(this._dragging.event));else{this.dispatchEvent({type:"dragging",index:d,coord:f[3],time:f[2],distance:f[0]});var g=Math.min(this._dragging.event.index,d),p=Math.max(this._dragging.event.index,d);this.refresh(),this.get("selectable")&&this._drawGraph(this.tab_.slice(g,p),this._selectStyle)}break}}}else this.bar_.parentElement.classList.contains("over")&&(this._drawAt(),this.dispatchEvent({type:"out"})),e.type==="pointerup"&&this._dragging&&(this.dispatchEvent({type:"dragcancel"}),this._dragging=!1)}}show(){this.element.classList.remove("ol-collapsed"),this._addListeners(),this.dispatchEvent({type:"show",show:!0})}hide(){this.element.classList.add("ol-collapsed"),this._removeListeners(),this.dispatchEvent({type:"show",show:!1})}toggle(){this.isShown()?this.hide():this.show()}isShown(){return!this.element.classList.contains("ol-collapsed")}getSelection(e,t){for(var i=[],a=Math.max(Math.min(e,t),0),s=Math.min(Math.max(e,t),this.tab_.length-1),r=a;r<=s;r++)i.push(this.tab_[r][3]);return i}_drawGraph(e,t){if(!e.length)return;function i(p,m){if(t.getStroke()){var L=t.getStroke().getColor();a.strokeStyle=L?U(L):"#000",a.lineWidth=t.getStroke().getWidth()*h,a.setLineDash([]),a.stroke()}if(t.getFill()){var w=t.getFill().getColor();a.fillStyle=w?U(w):"#000",a.Style=w?U(w):"#000",a.lineTo(m*s,0),a.lineTo(p*s,0),a.fill()}}var a=this.canvas_.getContext("2d"),s=this.scale_[0],r=this.scale_[1],l=this.dy_,h=this.ratio,c,u,d,f,g=!1;for(a.beginPath(),c=0;u=e[c];c++)c==0?a.moveTo(u[0]*s,u[1]*r+l):u[1]?(g=!0,d||(d=u[0]),f=u[0],a.lineTo(u[0]*s,u[1]*r+l)):(g&&(i(d,f),g=!1,d=null,f=null),e[c+1]&&(a.beginPath(),a.moveTo(e[c+1][0]*s,e[c+1][1]*r+l)));g&&i(d,f)}setGeometry(e,t){if(t||(t={}),e instanceof G&&(e=e.getGeometry()),this._geometry=[e,t],!/Z/.test(e.getLayout()))return;/M/.test(e.getLayout())?this.element.querySelector(".time").parentElement.style.display="table-cell":this.element.querySelector(".time").parentElement.style.display="none";var i=e.getCoordinates();switch(e.getType()){case"LineString":break;case"MultiLineString":i=i[0];break;default:return}var a=t.projection||this.getMap().getView().getProjection();function s(y,v){return ye(K(y,a,"EPSG:4326"),K(v,a,"EPSG:4326"))}function r(y,v){if(!y||!v)return"-";var E=(v-y)/60,M=Math.trunc(E/60),S=Math.trunc(E-M*60);return M+"h"+(S<10?"0":"")+S+"mn"}var l=1/0,h=-1/0,c=0,u=0,d=0,f=0,g,p,m,L,w,T=this.tab_=[];for(g=0,p;p=i[g];g++){if(L=p[2],L<l&&(l=L),L>h&&(h=L),g==0)m=0;else{var k=s(i[g-1],p),x=L-i[g-1][2],A=k?Math.abs(x/k):0;(g<this.get("skipFirst")||g>i.length-this.get("skipFirst"))&&(A=0),d=Math.max(d,A),f+=A,m+=k,c+=Math.max(0,L-i[g-1][2]),u+=Math.max(0,i[g-1][2]-L)}w=r(i[0][3],p[3]),T.push([m,L,w,p])}this._z=[l,h],this._elevation=[c,u],this._maxSlope=100*d,this._avgSlope=100*f/T.length,this.setProperties({graduation:t.graduation||100,zmin:t.zmin,zmax:t.zmax,amplitude:t.amplitude,unit:t.unit,zunit:t.zunit,zDigits:typeof t.zDigits=="number"?t.zDigits:0,xDigits:typeof t.xDigits=="number"?t.xDigits:1,zDigitsHover:typeof t.zDigitsHover=="number"?t.zDigitsHover:2,xDigitsHover:typeof t.xDigitsHover=="number"?t.xDigitsHover:1,zMaxChars:t.zMaxChars,xSteps:t.xSteps,zSteps:t.zSteps}),this.dispatchEvent({type:"change:geometry",geometry:e}),this.refresh()}refresh(){var e=this.canvas_,t=e.getContext("2d"),i=e.width,a=e.height;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i,a);var s=this._z[0],r=this._z[1],l=this.tab_,h=l[l.length-1][0],c=l[l.length-1][2],u;if(!h){console.error("[ol/control/Profile] no data...",l);return}t.setTransform(1,0,0,1,this.margin_.left,a-this.margin_.bottom);var d=this.ratio;i-=this.margin_.right+this.margin_.left,a-=this.margin_.top+this.margin_.bottom;var f=this._style.getText().getFill().getColor();t.strokeStyle=f?U(f):"#000",t.lineWidth=.5*d,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-a),t.moveTo(0,0),t.lineTo(i,0),t.stroke();var _=this._isMetric?N.prototype.Unit.Meter:N.prototype.Unit.Foot,g=this._unitsConversion(s,_);this.element.querySelector(".track-info .zmin").textContent=this._numberFormat(g,this.get("zDigitsHover"))+_;var p=this._unitsConversion(r,_);this.element.querySelector(".track-info .zmax").textContent=this._numberFormat(p,this.get("zDigitsHover"))+_;var m=this._unitsConversion(this._elevation[0],_);this.element.querySelector(".track-options .elevationGain").textContent=this._numberFormat(m,this.get("zDigitsHover"))+_;var L=this._unitsConversion(this._elevation[1],_);this.element.querySelector(".track-options .elevationLoss").textContent=this._numberFormat(-L,this.get("zDigitsHover"))+_,this.element.querySelector(".track-options .maxSlope").textContent=this._numberFormat(this._maxSlope,0)+"%",this.element.querySelector(".track-options .avgSlope").textContent=this._numberFormat(this._avgSlope,0)+"%";var w;this._isMetric?w=h>1e3?N.prototype.Unit.Kilometer:N.prototype.Unit.Meter:w=h>N.prototype.MILE_VALUE?N.prototype.Unit.Mile:N.prototype.Unit.Foot;var T=this._unitsConversion(h,w);this.element.querySelector(".track-info .dist").textContent=this._numberFormat(T,this.get("xDigitsHover"))+w,this.element.querySelector(".track-info .time").textContent=c;var k=this.get("zSteps"),x;if(k){r=Math.ceil(r),s=Math.floor(s*10)/10;var A=this.get("amplitude")||r-s;x=A/(k-1)}else for(x=this.get("graduation");;){r=Math.ceil(r/x)*x,s=Math.floor(s/x)*x;var y=(r-s)/x;if(a/y<15*d)x*=2;else break}typeof this.get("zmin")=="number"&&s>this.get("zmin")&&(s=this.get("zmin")),typeof this.get("zmax")=="number"&&r<this.get("zmax")&&(r=this.get("zmax"));var v=this.get("amplitude");v&&(r=Math.max(s+v,r));var E=i/h,M=-a/(r-s),S=this.dy_=-s*M;this.scale_=[E,M],this._drawGraph(l,this._style),t.textAlign="right",t.textBaseline="top";var C=this._style.getText().getFill().getColor();t.fillStyle=C?U(C):"#000",t.beginPath();var b=this.get("zDigits"),_=this.get("zunit")||this._isMetric?N.prototype.Unit.Meter:N.prototype.Unit.Foot,I=null;if(typeof this.get("zMaxChars")=="number"){var P,F=this._unitsConversion(s,_),Y=this._unitsConversion(r,_);if(P=Math.max(F.toFixed(1).length,Y.toFixed(1).length),this.get("zMaxChars")<P){I=Math.floor(Math.log10(Math.max(Math.abs(s),Math.abs(r),Number.MIN_VALUE))),t.font="bold "+9*d+"px arial",t.fillText(I.toString(),-8*d,8*d);var Z=t.measureText(I.toString()),z=Z.width,$=Z.actualBoundingBoxAscent+Z.actualBoundingBoxDescent;t.font="bold "+12*d+"px arial",t.fillText("10",-8*d-z,8*d+.5*$)}}for(t.font=10*d+"px arial",t.textBaseline="middle",u=s;u<=r;u+=x){var D=this._unitsConversion(u,_);if(I!==null){var O=D/Math.pow(10,I),V=this.get("zMaxChars")-Math.floor(Math.log10(Math.max(Math.abs(O),1))+1)-1;O<0&&(V-=1),t.fillText(O.toFixed(Math.max(V,0)),-4*d,u*M+S)}else{if(typeof b=="number")D=this._numberFormat(D,b);else{var Ve=10;D=this._unitsConversion(r,_)-this._unitsConversion(s,_)>Ve?this._numberFormat(D,0):this._numberFormat(D,2)}t.fillText(D,-4*d,u*M+S)}t.moveTo(-2*d,u*M+S),u!=0?t.lineTo(h*E,u*M+S):t.lineTo(0,u*M+S)}t.textAlign="center",t.textBaseline="top",t.setLineDash([d,3*d]);var ee=this.get("unit")||(this._isMetric?N.prototype.Unit.Kilometer:N.prototype.Unit.Mile),Te=this.get("xSteps"),xe=this.get("xDigits"),Ee=ee===N.prototype.Unit.Mile?N.prototype.MILE_VALUE:1e3,R;for(h<Ee&&(ee=this._isMetric?N.prototype.Unit.Meter:N.prototype.Unit.Foot),typeof Te=="number"?R=h/(Te-1):h>Ee?(R=Math.round(h/1e3)*100,R>1e3&&(R=Math.ceil(R/1e3)*1e3)):h>100?R=Math.round(h/100)*10:h>10?R=Math.round(h/10):h>1?R=Math.round(h)/10:R=h,u=0;u<=h;u+=R){var ze=Number(this._unitsConversion(u,ee).toFixed(xe)),Re=this._numberFormat(ze,xe);t.fillText(Re,u*E,4*d),t.moveTo(u*E,3*d),t.lineTo(u*E,0)}t.font=12*d+"px arial";var Be=this.info.xtitle.search("(km)"),Ge=Be!==-1?this.info.xtitle.replace("(km)","("+ee+")"):this.info.xtitle+" ("+ee+")";t.fillText(Ge,i/2,18*d),t.save(),t.rotate(-Math.PI/2);var Ue=this.info.xtitle.search("(m)"),He=Ue!==-1?this.info.ytitle.replace("(m)","("+_+")"):this.info.ytitle+" ("+_+")";t.fillText(He,a/2,-this.margin_.left),t.restore(),t.stroke()}getImage(e,t){return e==="canvas"?this.canvas_:this.canvas_.toDataURL(e,t)}_unitsConversion(e,t){switch(t=t||N.prototype.Unit.Meter,t){case N.prototype.Unit.Kilometer:return e/N.prototype.KILOMETER_VALUE;case N.prototype.Unit.Foot:return e/N.prototype.FOOT_VALUE;case N.prototype.Unit.Mile:return e/N.prototype.MILE_VALUE;case N.prototype.Unit.Meter:default:return e}}_numberFormat(e,t=2){var i=this.get("numberFormat");return i?Number(e).toLocaleString(i,{minimumFractionDigits:0,maximumFractionDigits:t}):Number(e).toFixed(t)}};N.prototype.info={zmin:"Zmin",zmax:"Zmax",ytitle:"Altitude",xtitle:"Distance",time:"Time",altitude:"Altitude",elevation:"Elevation gain / loss",elevgain:"Elevation gain",elevloss:"Elevation loss",maxslope:"Max. slope",avgslope:"Avg. slope"};N.prototype.Unit={Meter:"m",Kilometer:"km",Foot:"ft",Mile:"mi"};N.prototype.FOOT_VALUE=.3048;N.prototype.MILE_VALUE=1609.344;N.prototype.KILOMETER_VALUE=1e3;var bt=class extends j{constructor(e){e=e||{};var t=(e.className||"")+" ol-search"+(e.target?"":" ol-unselectable ol-control"),i=o.create("DIV",{className:t});super({element:i,target:e.target});var a=this;if(e.typing==null&&(e.typing=300),this._classname=e.className||"search",e.collapsed!==!1&&i.classList.add("ol-collapsed"),e.target||(this.button=document.createElement("button"),this.button.setAttribute("type","button"),this.button.setAttribute("title",e.title||e.label||"Search"),this.button.addEventListener("click",function(){if(i.classList.toggle("ol-collapsed"),!i.classList.contains("ol-collapsed")){i.querySelector("input.search").focus();for(var f=i.querySelectorAll("li"),g=0;g<f.length;g++)f[g].classList.remove("select");h.value||a.drawList_()}}),i.appendChild(this.button)),e.inputLabel){var s=document.createElement("LABEL");s.innerText=e.inputLabel,i.appendChild(s)}var r,l="",h=this._input=document.createElement("INPUT");h.setAttribute("type","search"),h.setAttribute("class","search"),h.setAttribute("autocomplete","off"),h.setAttribute("placeholder",e.placeholder||"Search..."),h.addEventListener("change",function(f){a.dispatchEvent({type:"change:input",input:f,value:h.value})});var c=function(f){var g=i.querySelector("ul.autocomplete li.select"),p=h.value;if(f.key=="ArrowDown"||f.key=="ArrowUp"||f.key=="Down"||f.key=="Up")if(g){var m=/Down/.test(f.key)?g.nextElementSibling:g.previousElementSibling;m&&!m.classList.contains("copy")&&(g.classList.remove("select"),m.classList.add("select"),h.value=m.innerText)}else g=i.querySelector("ul.autocomplete li"),g&&(g.classList.add("select"),h.value=g.innerText);else if(f.type=="input")p||setTimeout(function(){a.drawList_()},200),g&&(h.value=p="",g.classList.remove("select"));else if(g&&(f.type==="search"||f.key==="Enter"))i.classList.contains("ol-control")&&h.blur(),g.classList.remove("select"),l=p,a._handleSelect(a._list[g.getAttribute("data-search")]);else if(f.type==="search"||f.key==="Enter"||l!=p&&e.typing>=0)if(l=p,l){r&&clearTimeout(r);var L=a.get("minLength");r=setTimeout(function(){if(l.length>=L){var w=a.autocomplete(l,function(T){a.drawList_(T)});w&&a.drawList_(w)}else a.drawList_()},e.typing)}else a.drawList_();else g=i.querySelector("ul.autocomplete li"),g&&g.classList.remove("select")};if(h.addEventListener("keyup",c),h.addEventListener("search",c),h.addEventListener("cut",c),h.addEventListener("paste",c),h.addEventListener("input",c),e.noCollapse||(h.addEventListener("blur",(function(){setTimeout((function(){h!==document.activeElement&&(i.classList.add("ol-collapsed"),this.set("reverse",!1),i.classList.remove("ol-revers"))}).bind(this),200)}).bind(this)),h.addEventListener("focus",(function(){this.get("reverse")||(i.classList.remove("ol-collapsed"),i.classList.remove("ol-revers"))}).bind(this)),h.addEventListener("keydown",(function(){this.set("reverse",!1),i.classList.remove("ol-collapsed"),i.classList.remove("ol-revers")}).bind(this))),i.appendChild(h),e.reverse){var u=o.create("BUTTON",{type:"button",class:"ol-revers",title:e.reverseTitle||"click on the map",on:{focus:(function(){this.get("reverse")?this.set("reverse",!1):(this.set("reverse",!this.get("reverse")),h.focus(),i.classList.add("ol-revers"))}).bind(this)}});i.appendChild(u)}var d=document.createElement("ul");d.classList.add("autocomplete"),i.appendChild(d),typeof e.getTitle=="function"&&(this.getTitle=e.getTitle),typeof e.autocomplete=="function"&&(this.autocomplete=e.autocomplete),this.set("copy",e.copy),this.set("minLength",e.minLength||1),this.set("maxItems",e.maxItems||10),this.set("maxHistory",e.maxHistory||e.maxItems||10),e.onselect&&this.on("select",e.onselect),e.centerOnSelect&&this.on("select",(function(f){var g=this.getMap();g&&g.getView().setCenter(f.coordinate)}).bind(this)),e.zoomOnSelect&&this.on("select",(function(f){var g=this.getMap();g&&(g.getView().setCenter(f.coordinate),g.getView().getZoom()<e.zoomOnSelect&&g.getView().setZoom(e.zoomOnSelect))}).bind(this)),this.restoreHistory(),this.drawList_()}setMap(e){this._listener&&q(this._listener),this._listener=null,super.setMap(e),e&&(this._listener=e.on("click",this._handleClick.bind(this)))}collapse(e){e===!1?this.element.classList.remove("ol-collapsed"):this.element.classList.add("ol-collapsed")}getInputField(){return this._input}getTitle(e){return e.name||"No title"}_getTitleTxt(e){return o.create("DIV",{html:this.getTitle(e)}).innerText}search(){var e=this.element.querySelector("input.search");this._triggerCustomEvent("search",e)}_handleClick(e){this.get("reverse")&&(document.activeElement.blur(),this.reverseGeocode(e.coordinate))}reverseGeocode(){}_triggerCustomEvent(e,t){o.dispatchEvent(e,t)}setInput(e,t){var i=this.element.querySelector("input.search");i.value=e,t&&this._triggerCustomEvent("keyup",i)}select(e,t,i,a){var s={type:"select",search:e,reverse:!!t,coordinate:i};if(a)for(var r in a)s[r]=a[r];this.dispatchEvent(s)}_handleSelect(e,t,i){if(e){var a=this.get("history"),s;try{var r=JSON.stringify(e);for(s=a.length-1;s>=0;s--)(!a[s]||JSON.stringify(a[s])===r)&&a.splice(s,1)}catch{for(s=a.length-1;s>=0;s--)a[s]===e&&a.splice(s,1)}a.unshift(e);for(var l=Math.max(0,this.get("maxHistory")||10)||0;a.length>l;)a.pop();this.saveHistory(),this.select(e,t,null,i),t&&(this.setInput(this._getTitleTxt(e)),this.drawList_(),setTimeout((function(){this.collapse(!1)}).bind(this),300))}}saveHistory(){try{this.get("maxHistory")>=0?localStorage["ol@search-"+this._classname]=JSON.stringify(this.get("history")):localStorage.removeItem("ol@search-"+this._classname)}catch{console.warn("Failed to access localStorage...")}}restoreHistory(){if(this._history[this._classname])this.set("history",this._history[this._classname]);else try{this._history[this._classname]=JSON.parse(localStorage["ol@search-"+this._classname]),this.set("history",this._history[this._classname])}catch{this.set("history",[])}}clearHistory(){this.set("history",[]),this.saveHistory(),this.drawList_()}getHistory(){return this.get("history")}autocomplete(e,t){return t([]),!1}drawList_(e){var t=this,i=this.element.querySelector("ul.autocomplete");if(i.innerHTML="",this._list=[],e)i.setAttribute("class","autocomplete");else{var a=this.element.querySelector("input.search"),s=a.value;if(!s)e=this.get("history");else return;i.setAttribute("class","autocomplete history")}for(var r,l=Math.min(t.get("maxItems"),e.length),h=0;h<l;h++)if(e[h]&&(!h||!t.equalFeatures(e[h],e[h-1]))){r=document.createElement("LI"),r.setAttribute("data-search",this._list.length),this._list.push(e[h]),r.addEventListener("click",function(u){t._handleSelect(t._list[u.currentTarget.getAttribute("data-search")])});var c=t.getTitle(e[h]);c instanceof Element?r.appendChild(c):r.innerHTML=c,i.appendChild(r)}l&&this.get("copy")&&(r=document.createElement("LI"),r.classList.add("copy"),r.innerHTML=this.get("copy"),i.appendChild(r))}equalFeatures(){return!1}};bt.prototype._history={};var te=class extends j{constructor(e){e=e||{};var t=o.create("DIV",{className:(e.className||"ol-videorec")+" ol-unselectable ol-control"});super({element:t,target:e.target}),o.create("BUTTON",{type:"button",className:"ol-start",title:te.prototype.tips.start,click:(function(){this.start()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-stop",title:te.prototype.tips.stop,click:(function(){this.stop()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-pause",title:te.prototype.tips.pause,click:(function(){this.pause()}).bind(this),parent:t}),o.create("BUTTON",{type:"button",className:"ol-resume",title:te.prototype.tips.resume,click:(function(){this.resume()}).bind(this),parent:t}),this.set("framerate",30),this.set("videoBitsPerSecond",5e6),e.videoTarget==="DIALOG"?(this._dialog=new Fe({className:"ol-fullscreen-dialog",target:document.body,closeBox:!0}),this._videoTarget=this._dialog.getContentElement()):this._videoTarget=e.videoTarget,this._printCtrl=new De({target:o.create("DIV")})}setTooltip(e,t){var i=this.element.querySelector("button.ol-"+e);i&&(i.title=t)}setMap(e){this.getMap()&&(this.getMap().removeControl(this._printCtrl),this._dialog&&this.getMap().removeControl(this._dialog)),super.setMap(e),this.getMap()&&(this.getMap().addControl(this._printCtrl),this._dialog&&this.getMap().addControl(this._dialog))}start(){var e=this._printCtrl,t=!1;function i(a){t||e.fastPrint({canvas:a},i)}e.fastPrint({},(function(a){var s;try{s=a.captureStream(this.get("framerate")||30)}catch(l){this.dispatchEvent({type:"error",error:l});return}this._mediaRecorder=new MediaRecorder(s,{videoBitsPerSecond:this.get("videoBitsPerSecond")||5e6});var r=[];this._mediaRecorder.ondataavailable=function(l){r.push(l.data)},this._mediaRecorder.onstop=(function(){t=!0;var l=new Blob(r,{type:"video/mp4"});if(r=[],this._videoTarget instanceof Element){var h;this._videoTarget.tagName==="VIDEO"?h=this._videoTarget:(h=this._videoTarget.querySelector("video"),h||(h=o.create("VIDEO",{controls:"",parent:this._videoTarget}))),this._dialog&&this._dialog.show(),h.src=URL.createObjectURL(l),this.dispatchEvent({type:"stop",videoURL:h.src})}else this.dispatchEvent({type:"stop",videoURL:URL.createObjectURL(l)})}).bind(this),this._mediaRecorder.onpause=(function(){t=!0,this.dispatchEvent({type:"pause"})}).bind(this),this._mediaRecorder.onresume=(function(){t=!1,i(a),this.dispatchEvent({type:"resume"})}).bind(this),this._mediaRecorder.onerror=(function(l){this.dispatchEvent({type:"error",error:l})}).bind(this),t=!1,i(a),this._mediaRecorder.start(),this.dispatchEvent({type:"start",canvas:a}),this.element.setAttribute("data-state","rec")}).bind(this))}stop(){this._mediaRecorder&&(this._mediaRecorder.stop(),this._mediaRecorder=null,this.element.setAttribute("data-state","inactive"))}pause(){this._mediaRecorder&&(this._mediaRecorder.pause(),this.element.setAttribute("data-state","pause"))}resume(){this._mediaRecorder&&(this._mediaRecorder.resume(),this.element.setAttribute("data-state","rec"))}};te.prototype.tips={start:"start video",stop:"stop",pause:"pause",resume:"resume"};var J=class extends j{constructor(e){e=e||{};var t=t=o.create("DIV",{className:e.className||"ol-mapzone"});if(super({element:t,target:e.target}),!e.target){["ol-unselectable","ol-control","ol-collapsed"].forEach(function(s){t.classList.add(s)});var i=o.create("BUTTON",{type:"button",on:{click:(function(){this.setVisible(this.getCollapsed())}).bind(this)},parent:t});o.create("I",{parent:i})}this.set("centerOnClick",e.centerOnClick);var a=this._maps=[];this._projection=e.projection,this._layer=e.layer,e.zones.forEach(this.addZone.bind(this)),setTimeout(function(){a.forEach(function(s){s.updateSize()})})}setCollapsed(e){e?this.element.classList.add("ol-collapsed"):(this.element.classList.remove("ol-collapsed"),this.getMaps().forEach(function(t){setTimeout(()=>t.getView().fit(t.get("extent")))})),this.dispatchEvent({type:"change:collapse",collapsed:!!e})}setVisible(e){this.setCollapsed(!e)}getCollapsed(){return this.element.classList.contains("ol-collapsed")}getMaps(){return this._maps}getLength(){return this._maps.length}addZone(e){var t=new nt({zoom:6,center:[0,0],projection:this._projection}),i;e.map?i=ke(e.map.getView().calculateExtent(),e.map.getView().getProjection(),t.getProjection()):i=ke(e.extent,"EPSG:4326",t.getProjection());var a=o.create("DIV",{className:"ol-mapzonezone",tabindex:"0",parent:this.element,on:{keydown:function(l){l.key===" "&&l.target.click()}},click:(function(){var l=-1;this._maps.forEach(function(h,c){h.get("zone")===e&&(l=c)}),this.dispatchEvent({type:"select",zone:e,index:l,coordinate:ae(i),extent:i}),this.get("centerOnClick")!==!1&&this.getMap().getView().fit(i)}).bind(this)}),s;e.layer?s=e.layer:typeof this._layer=="function"?s=this._layer(e):s=new this._layer.constructor({source:this._layer.getSource()});var r=new _e({target:a,view:t,controls:[],interactions:[],layers:[s]});r.set("zone",e),r.set("extent",i),this._maps.push(r),t.fit(i),o.create("P",{html:e.title,parent:a})}removeZone(e){var t=this.element.querySelectorAll(".ol-mapzonezone")[e];t&&(t.remove(),this._maps.splice(e,1))}};J.zones={};J.zones.DOM=[{title:"Guadeloupe",extent:[-61.898594315312444,15.75623038647845,-60.957887532935324,16.575317670979473]},{title:"Guyane",extent:[-54.72525931072715,2.1603763430019,-51.528236062921344,5.7984307809552575]},{title:"Martinique",extent:[-61.257556528564756,14.387506317407514,-60.76934912110432,14.895067461729951]},{title:"Mayotte",extent:[44.959844536967815,-13.01674138212816,45.35328866510648,-12.65521942207829]},{title:"La réunion",extent:[55.17059012967656,-21.407680069231688,55.88195702001797,-20.85560221637526]}];J.zones.TOM=[{title:"Polynésie Française",extent:[206.23664226630862,-22.189040615809787,221.85920743981987,-10.835039595040698]},{title:"Nouvelle Calédonie",extent:[163.76420580160925,-22.581641092751838,167.66984709498706,-19.816411635668445]},{title:"St-Pierre et Miquelon",extent:[-56.453698765748676,46.74449858188555,-56.0980198121544,47.14669874229787]},{title:"Wallis et Futuna",extent:[181.7588623143665,-14.7341169873267,183.95612353301715,-13.134720799175085]},{title:"St-Martin St-Barthélemy",extent:[-63.1726389501678,17.806097291313506,-62.7606535945649,18.13267688837938]}];J.zones.DOMTOM=[{title:"Métropole",extent:[-5.318421740712579,41.16082274292913,9.73284186155716,51.21957336557702]}].concat(J.zones.DOM,J.zones.TOM);var Lt=class extends ot{constructor(e){e=e||{},super({handleDownEvent:function(i){return t.handleDownEvent_(i)},handleDragEvent:function(i){return this.handleDragEvent_(i)},handleMoveEvent:function(i){return this.handleMoveEvent_(i)},handleUpEvent:function(i){return this.handleUpEvent_(i)}});var t=this;this.selection_=new Ae,this.handles_=new Ae,this.overlayLayer_=new re({source:new ve({features:this.handles_,useSpatialIndex:!1,wrapX:!1}),name:"Transform overlay",displayInLayerSwitcher:!1,style:function(i){return t.style[(i.get("handle")||"default")+(i.get("constraint")||"")+(i.get("option")||"")]},updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,typeof e.filter=="function"&&(this._filter=e.filter),this.layers_=e.layers?e.layers instanceof Array?e.layers:[e.layers]:null,this._handleEvent=e.condition||function(){return!0},this.addFn_=e.addCondition||function(){return!1},this.setPointRadius(e.pointRadius),this.set("translateFeature",e.translateFeature!==!1),this.set("translate",e.translate!==!1),this.set("translateBBox",e.translateBBox===!0),this.set("stretch",e.stretch!==!1),this.set("scale",e.scale!==!1),this.set("rotate",e.rotate!==!1),this.set("keepAspectRatio",e.keepAspectRatio||function(i){return i.originalEvent.shiftKey}),this.set("modifyCenter",e.modifyCenter||function(i){return i.originalEvent.metaKey||i.originalEvent.ctrlKey}),this.set("noFlip",e.noFlip||!1),this.set("selection",e.selection!==!1),this.set("hitTolerance",e.hitTolerance||0),this.set("enableRotatedTransform",e.enableRotatedTransform||!1),this.set("keepRectangle",e.keepRectangle||!1),this.set("buffer",e.buffer||0),this.on("propertychange",function(){this.drawSketch_()}),this.setDefaultStyle(),e.select?this.on("change:active",(function(i){this.getActive()?this.setSelection(e.select.getFeatures().getArray()):(e.select.getFeatures().extend(this.selection_),this.selection_.forEach(function(a){e.select.getFeatures().push(a)}),this.select(null))}).bind(this)):this.on("change:active",(function(i){this.select(null)}).bind(this))}setMap(e){var t=this.getMap();t&&(t.removeLayer(this.overlayLayer_),this.previousCursor_&&o.setCursor(t,this.previousCursor_),this.previousCursor_=void 0),super.setMap(e),this.overlayLayer_.setMap(e),e===null&&this.select(null),e!==null&&(this.isTouch=/touch/.test(e.getViewport().className),this.setDefaultStyle())}setActive(e){this.overlayLayer_&&this.overlayLayer_.setVisible(e),super.setActive(e)}setDefaultStyle(e){e=e||{};var t=e.pointStroke||new W({color:[255,0,0,1],width:1}),i=e.stroke||new W({color:[255,0,0,1],width:1,lineDash:[4,4]}),a=e.fill||new ne({color:[255,0,0,.01]}),s=e.pointFill||new ne({color:[255,255,255,.8]}),r=new ue({fill:s,stroke:t,radius:this.isTouch?12:6,displacement:this.isTouch?[24,-24]:[12,-12],points:15});r.setDisplacement||(r.getAnchor()[0]=this.isTouch?-10:-5);var l=new ue({fill:s,stroke:t,radius:this.isTouch?16:8,points:4,angle:Math.PI/4}),h=new ue({fill:s,stroke:t,radius:this.isTouch?12:6,points:4,angle:Math.PI/4});function c(u,d,f){return[new H({image:u,stroke:d,fill:f})]}this.style={default:c(l,i,a),translate:c(l,t,s),rotate:c(r,t,s),rotate0:c(l,t,s),scale:c(l,t,s),scale1:c(l,t,s),scale2:c(l,t,s),scale3:c(l,t,s),scalev:c(h,t,s),scaleh1:c(h,t,s),scalev2:c(h,t,s),scaleh3:c(h,t,s)},this.drawSketch_()}setStyle(e,t){if(t){t instanceof Array?this.style[e]=t:this.style[e]=[t];for(var i=0;i<this.style[e].length;i++){var a=this.style[e][i].getImage();a&&(e=="rotate"&&(a.getAnchor()[0]=-5),this.isTouch&&a.setScale(1.8));var s=this.style[e][i].getText();s&&(e=="rotate"&&s.setOffsetX(this.isTouch?14:7),this.isTouch&&s.setScale(1.8))}this.drawSketch_()}}getFeatureAtPixel_(e){var t=this;return this.getMap().forEachFeatureAtPixel(e,function(i,a){var s=!1;if(!a){if(i===t.bbox_)return t.get("translateBBox")?{feature:i,handle:"translate",constraint:"",option:""}:!1;if(t.handles_.forEach(function(l){l===i&&(s=!0)}),s)return{feature:i,handle:i.get("handle"),constraint:i.get("constraint"),option:i.get("option")}}if(!t.get("selection"))return t.selection_.getArray().some(function(l){return i===l})?{feature:i}:null;if(t._filter)return t._filter(i,a)?{feature:i}:null;if(t.layers_){for(var r=0;r<t.layers_.length;r++)if(t.layers_[r]===a)return{feature:i};return null}else return t.features_?(t.features_.forEach(function(l){l===i&&(s=!0)}),s?{feature:i}:null):{feature:i}},{hitTolerance:this.get("hitTolerance")})||{}}getGeometryRotateToZero_(e,t){var i=e.getGeometry(),a=this.getMap().getView().getRotation();if(a===0||!this.get("enableRotatedTransform"))return t?i.clone():i;var s=i.clone();return s.rotate(a*-1,this.getMap().getView().getCenter()),s}_isRectangle(e){if(this.get("keepRectangle")&&e.getType()==="Polygon"){var t=e.getCoordinates()[0];return t.length===5}return!1}drawSketch_(e){var t,i,a,s=this.selection_.item(0)&&this._isRectangle(this.selection_.item(0).getGeometry());if(this.overlayLayer_.getSource().clear(),!!this.selection_.getLength()){var r=this.getMap().getView().getRotation(),l=this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent(),h;s&&(h=this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0,4),h.unshift(h[3])),l=he(l,this.get("buffer")),this.selection_.forEach((function(m){var L=this.getGeometryRotateToZero_(m).getExtent();fe(l,L)}).bind(this));var c=this.selection_.getLength()===1?this._pointRadius(this.selection_.item(0)):0;if(c&&!(c instanceof Array)&&(c=[c,c]),e===!0)this.ispt_||(this.overlayLayer_.getSource().addFeature(new G({geometry:new B(this.center_),handle:"rotate0"})),a=le(l),this.get("enableRotatedTransform")&&r!==0&&a.rotate(r,this.getMap().getView().getCenter()),i=this.bbox_=new G(a),this.overlayLayer_.getSource().addFeature(i));else{if(this.ispt_){var u=this.getMap().getPixelFromCoordinate(ae(l));if(u){var d=c&&c[0]||10,f=c&&c[1]||10;l=lt([this.getMap().getCoordinateFromPixel([u[0]-d,u[1]-f]),this.getMap().getCoordinateFromPixel([u[0]+d,u[1]+f])])}}a=s?new oe([h]):le(l),this.get("enableRotatedTransform")&&r!==0&&a.rotate(r,this.getMap().getView().getCenter()),i=this.bbox_=new G(a);var g=[],p=a.getCoordinates()[0];if(!this.ispt_||c){if(g.push(i),!this.iscircle_&&!this.ispt_&&this.get("stretch")&&this.get("scale"))for(t=0;t<p.length-1;t++)i=new G({geometry:new B([(p[t][0]+p[t+1][0])/2,(p[t][1]+p[t+1][1])/2]),handle:"scale",constraint:t%2?"h":"v",option:t}),g.push(i);if(this.get("scale"))for(t=0;t<p.length-1;t++)i=new G({geometry:new B(p[t]),handle:"scale",option:t}),g.push(i);this.get("translate")&&!this.get("translateFeature")&&(i=new G({geometry:new B([(p[0][0]+p[2][0])/2,(p[0][1]+p[2][1])/2]),handle:"translate"}),g.push(i))}!this.iscircle_&&this.get("rotate")&&(i=new G({geometry:new B(p[3]),handle:"rotate"}),g.push(i)),this.overlayLayer_.getSource().addFeatures(g)}}}select(e,t){if(!e){this.selection_&&(this.selection_.clear(),this.drawSketch_());return}if(!(!e.getGeometry||!e.getGeometry())){if(t)this.selection_.push(e);else{var i=this.selection_.getArray().indexOf(e);this.selection_.removeAt(i)}this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:e,features:this.selection_})}}setSelection(e){this.selection_.clear(),e.forEach((function(t){this.selection_.push(t)}).bind(this)),this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",features:this.selection_})}watchFeatures_(){this._featureListeners&&this._featureListeners.forEach(function(e){q(e)}),this._featureListeners=[],this.selection_.forEach((function(e){this._featureListeners.push(e.on("change",(function(){this.isUpdating_||this.drawSketch_()}).bind(this)))}).bind(this))}handleDownEvent_(e){if(this._handleEvent(e,this.selection_)){var t=this.getFeatureAtPixel_(e.pixel),i=t.feature;if(this.selection_.getLength()&&this.selection_.getArray().indexOf(i)>=0&&(this.ispt_&&this.get("translate")||this.get("translateFeature"))&&(t.handle="translate"),t.handle){this.mode_=t.handle,this.opt_=t.option,this.constraint_=t.constraint;var a=this.getMap().getView().getRotation();this.coordinate_=i.get("handle")?i.getGeometry().getCoordinates():e.coordinate,this.pixel_=this.getMap().getCoordinateFromPixel(this.coordinate_),this.geoms_=[],this.rotatedGeoms_=[];var s=Ne(),r=Ne();this.hasChanged_=!1;for(var l=0,h;h=this.selection_.item(l);l++)if(this.geoms_.push(h.getGeometry().clone()),s=fe(s,h.getGeometry().getExtent()),this.get("enableRotatedTransform")&&a!==0){var c=this.getGeometryRotateToZero_(h,!0);this.rotatedGeoms_.push(c),r=fe(r,c.getExtent())}if(this.extent_=le(s).getCoordinates()[0],this.get("enableRotatedTransform")&&a!==0&&(this.rotatedExtent_=le(r).getCoordinates()[0]),this.mode_==="rotate"){this.center_=this.getCenter()||ae(s);var u=e.map.getTargetElement();o.setCursor(u,this.Cursors.rotate0),this.previousCursor_=u.style.cursor}else this.center_=ae(s);return this.angle_=Math.atan2(this.center_[1]-e.coordinate[1],this.center_[0]-e.coordinate[0]),this.dispatchEvent({type:this.mode_+"start",feature:this.selection_.item(0),features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!0}else if(this.get("selection")){if(i){this.addFn_(e)||this.selection_.clear();var d=this.selection_.getArray().indexOf(i);d<0?this.selection_.push(i):this.selection_.removeAt(d)}else this.selection_.clear();return this.ispt_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Point":!1,this.iscircle_=this.selection_.getLength()===1?this.selection_.item(0).getGeometry().getType()=="Circle":!1,this.drawSketch_(),this.watchFeatures_(),this.dispatchEvent({type:"select",feature:i,features:this.selection_,pixel:e.pixel,coordinate:e.coordinate}),!1}}}getCenter(){return this.get("center")}setCenter(e){return this.set("center",e)}handleDragEvent_(e){if(this._handleEvent(e,this.features_)){var t=this.getMap().getView().getRotation(),i,a,s,r,l=[this.coordinate_[0],this.coordinate_[1]],h=[e.coordinate[0],e.coordinate[1]];switch(this.isUpdating_=!0,this.hasChanged_=!0,this.mode_){case"rotate":{var c=Math.atan2(this.center_[1]-h[1],this.center_[0]-h[0]);if(!this.ispt)for(i=0,s;s=this.selection_.item(i);i++)r=this.geoms_[i].clone(),r.rotate(c-this.angle_,this.center_),r.getType()=="Circle"&&r.setCenterAndRadius(r.getCenter(),r.getRadius()),s.setGeometry(r);this.drawSketch_(!0),this.dispatchEvent({type:"rotating",feature:this.selection_.item(0),features:this.selection_,angle:c-this.angle_,pixel:e.pixel,coordinate:e.coordinate});break}case"translate":{var u=h[0]-l[0],d=h[1]-l[1];for(i=0,s;s=this.selection_.item(i);i++)s.getGeometry().translate(u,d);this.handles_.forEach(function(M){M.getGeometry().translate(u,d)}),this.coordinate_=e.coordinate,this.dispatchEvent({type:"translating",feature:this.selection_.item(0),features:this.selection_,delta:[u,d],pixel:e.pixel,coordinate:e.coordinate});break}case"scale":{var f=this.center_;if(this.get("modifyCenter")(e)){var g=this.extent_;this.get("enableRotatedTransform")&&t!==0&&(g=this.rotatedExtent_),f=g[(Number(this.opt_)+2)%4]}var p=this.geoms_.length==1&&this._isRectangle(this.geoms_[0]),m=this.constraint_,L=this.opt_,w=this.coordinate_,T=e.coordinate;if(this.get("enableRotatedTransform")&&t!==0){var k=new B(this.coordinate_);k.rotate(t*-1,f),w=k.getCoordinates();var x=new B(e.coordinate);x.rotate(t*-1,f),T=x.getCoordinates()}var A=(T[0]-f[0])/(w[0]-f[0]),y=(T[1]-f[1])/(w[1]-f[1]),v=[T[0]-w[0],T[1]-w[1]];if(this.get("enableRotatedTransform")&&t!==0){var E=new B(f);E.rotate(t*-1,this.getMap().getView().getCenter()),f=E.getCoordinates()}for(this.get("noFlip")&&(A<0&&(A=-A),y<0&&(y=-y)),this.constraint_?this.constraint_=="h"?A=1:y=1:this.get("keepAspectRatio")(e)&&(A=y=Math.min(A,y)),i=0,s;s=this.selection_.item(i);i++)r=t===0||!this.get("enableRotatedTransform")?this.geoms_[i].clone():this.rotatedGeoms_[i].clone(),r.applyTransform((function(M,S,C){if(C<2)return S;if(p){var b=[[6],[0,8],[2],[4]],_=[M[0],M[1]],I=[M[2],M[3]],P=[M[4],M[5]],F=[M[6],M[7]],Y=[M[8],M[9]];if(m){var Z=L%2===0?this._countVector(_,I):this._countVector(F,_),z=this._projectVectorOnVector(v,Z),$=L+1<b.length?L+1:0,D=[...b[L],...b[$]];for(a=0;a<M.length;a+=C)S[a]=D.includes(a)?M[a]+z[0]:M[a],S[a+1]=D.includes(a)?M[a+1]+z[1]:M[a+1]}else{var O,V;switch(L){case 0:v=this._countVector(F,T),O=this._projectVectorOnVector(v,this._countVector(P,F)),V=this._projectVectorOnVector(v,this._countVector(_,F)),[S[0],S[1]]=this._movePoint(_,O),[S[4],S[5]]=this._movePoint(P,V),[S[6],S[7]]=this._movePoint(F,v),[S[8],S[9]]=this._movePoint(Y,O);break;case 1:v=this._countVector(_,T),O=this._projectVectorOnVector(v,this._countVector(F,_)),V=this._projectVectorOnVector(v,this._countVector(I,_)),[S[0],S[1]]=this._movePoint(_,v),[S[2],S[3]]=this._movePoint(I,O),[S[6],S[7]]=this._movePoint(F,V),[S[8],S[9]]=this._movePoint(Y,v);break;case 2:v=this._countVector(I,T),O=this._projectVectorOnVector(v,this._countVector(_,I)),V=this._projectVectorOnVector(v,this._countVector(P,I)),[S[0],S[1]]=this._movePoint(_,V),[S[2],S[3]]=this._movePoint(I,v),[S[4],S[5]]=this._movePoint(P,O),[S[8],S[9]]=this._movePoint(Y,V);break;case 3:v=this._countVector(P,T),O=this._projectVectorOnVector(v,this._countVector(I,P)),V=this._projectVectorOnVector(v,this._countVector(F,P)),[S[2],S[3]]=this._movePoint(I,V),[S[4],S[5]]=this._movePoint(P,v),[S[6],S[7]]=this._movePoint(F,O);break}}}else for(a=0;a<M.length;a+=C)A!=1&&(S[a]=f[0]+(M[a]-f[0])*A),y!=1&&(S[a+1]=f[1]+(M[a+1]-f[1])*y);return r.getType()=="Circle"&&r.setCenterAndRadius(r.getCenter(),r.getRadius()),S}).bind(this)),this.get("enableRotatedTransform")&&t!==0&&r.rotate(t,this.getMap().getView().getCenter()),s.setGeometry(r);this.drawSketch_(),this.dispatchEvent({type:"scaling",feature:this.selection_.item(0),features:this.selection_,scale:[A,y],pixel:e.pixel,coordinate:e.coordinate});break}}this.isUpdating_=!1}}handleMoveEvent_(e){if(this._handleEvent(e,this.features_)&&!this.mode_){var t=this.getFeatureAtPixel_(e.pixel),i=e.map.getTargetElement();if(t.feature){var a=t.handle?this.Cursors[(t.handle||"default")+(t.constraint||"")+(t.option||"")]:this.Cursors.select;this.previousCursor_===void 0&&(this.previousCursor_=i.style.cursor),o.setCursor(i,a)}else this.previousCursor_!==void 0&&o.setCursor(i,this.previousCursor_),this.previousCursor_=void 0}}handleUpEvent_(e){if(this.mode_==="rotate"){var t=e.map.getTargetElement();o.setCursor(t,this.Cursors.default),this.previousCursor_=void 0}return this.dispatchEvent({type:this.mode_+"end",feature:this.selection_.item(0),features:this.selection_,oldgeom:this.geoms_[0],oldgeoms:this.geoms_,transformed:this.hasChanged_}),this.drawSketch_(),this.hasChanged_=!1,this.mode_=null,!1}setPointRadius(e){typeof e=="function"?this._pointRadius=e:this._pointRadius=function(){return e}}getFeatures(){return this.selection_}_projectVectorOnVector(e,t){var i=(e[0]*t[0]+e[1]*t[1])/(t[0]*t[0]+t[1]*t[1]);return[t[0]*i,t[1]*i]}_countVector(e,t){return[t[0]-e[0],t[1]-e[1]]}_movePoint(e,t){return[e[0]+t[0],e[1]+t[1]]}};Lt.prototype.Cursors={default:"auto",select:"pointer",translate:"move",rotate:"move",rotate0:"move",scale:"nesw-resize",scale1:"nwse-resize",scale2:"nesw-resize",scale3:"nwse-resize",scalev:"ew-resize",scaleh1:"ns-resize",scalev2:"ew-resize",scaleh3:"ns-resize"};var X=class extends Pe{constructor(e){e=e||{},super(),this.duration_=typeof e.duration=="number"?e.duration>=0?e.duration:0:1e3,this.fade_=typeof e.fade=="function"?e.fade:null,this.repeat_=Number(e.repeat);var t=typeof e.easing=="function"?e.easing:dt;e.revers?this.easing_=function(i){return 1-t(i)}:this.easing_=t,this.hiddenStyle=e.hiddenStyle}drawGeom_(e,t,i){var a={type:"drawing",time:e.time,feature:e.feature,start:e.start,stop:e.stop,rotation:e.rotation,style:e.style,extra:e.extra};this.dispatchEvent(a);var s=a.style instanceof Array?a.style:[a.style];this.fade_&&(e.context.globalAlpha=this.fade_(1-e.elapsed));for(var r=0;r<s.length;r++)try{var l=e.vectorContext||be(e),h=me(e,s[r]);l.setStyle(h),h.getZIndex()<0?l.drawGeometry(i||t):l.drawGeometry(t)}catch{}}animate(){return!1}};X.hiddenStyle=new H({image:new ht({}),stroke:new W({color:"transparent"})});_e.prototype.animateFeature=function(n,e){var t=this._featureAnimationLayer;t||(t=this._featureAnimationLayer=new re({source:new ve}),t.setMap(this)),t.getSource().addFeature(n);var i=e.on("animationend",function(a){a.feature===n&&(t.getSource().removeFeature(n),q(i))});return t.animateFeature(n,e)};ct.prototype.animateFeature=function(n,e,t){var i=this,a,s=n.getStyle(),r=s||(this.getStyleFunction?this.getStyleFunction()(n):null);r||(r=[]),r instanceof Array||(r=[r]);var l={vectorContext:null,frameState:null,start:0,time:0,elapsed:0,extent:!1,feature:n,geom:n.getGeometry(),typeGeom:n.getGeometry().getType(),bbox:n.getGeometry().getExtent(),coord:ae(n.getGeometry().getExtent()),style:r};e instanceof Array||(e=[e]);for(var h=e.length-1;h>=0;h--)e[h].duration_===0&&e.splice(h,1);var c=0,u=0,d=t&&this.getFilters?this.getFilters():[];function f(m){l.type=m.type;try{l.vectorContext=m.vectorContext||be(m)}catch{}if(l.frameState=m.frameState,l.inversePixelTransform=m.inversePixelTransform,l.extent||(l.extent=m.frameState.extent,l.start=m.frameState.time,l.context=m.context),l.time=m.frameState.time-l.start,l.elapsed=l.time/e[u].duration_,l.elapsed>1&&(l.elapsed=1),m.context.save(),d.forEach(function(w){w.get("active")&&w.precompose(m)}),this.getOpacity&&(m.context.globalAlpha=this.getOpacity()),!e[u].animate(l))c++,c<e[u].repeat_?(l.extent=!1,e[u].dispatchEvent({type:"animationrepeat",feature:n})):u<e.length-1?(e[u].dispatchEvent({type:"animationend",feature:n}),u++,c=0,l.extent=!1):g();else{var L={type:"animating",step:u,start:l.start,time:l.time,elapsed:l.elapsed,rotation:l.rotation||0,geom:l.geom,coordinate:l.coord,feature:n,extra:l.extra||{},style:r};e[u].dispatchEvent(L),i.dispatchEvent(L)}d.forEach(function(w){w.get("active")&&w.postcompose(m)}),m.context.restore(),m.frameState.animate=!0}function g(m){q(a),a=null,n.setStyle(s),l.stop=new Date().getTime();var L={type:"animationend",feature:n};if(m)for(var w in m)m.hasOwnProperty(w)&&(L[w]=m[w]);e[u].dispatchEvent(L),i.dispatchEvent(L)}function p(m){if(e.length&&!a){if(l.stop&&(l.start=new Date().getTime()-l.stop+l.start,l.stop=0),a=i.on(["postcompose","postrender"],f.bind(i)),i.renderSync)try{i.renderSync()}catch{}else i.changed();n.setStyle(e[u].hiddenStyle||X.hiddenStyle);var L={type:"animationstart",feature:n};if(m)for(var w in m)m.hasOwnProperty(w)&&(L[w]=m[w]);e[u].dispatchEvent(L),i.dispatchEvent(L)}}return p(),{start:p,stop:g,isPlaying:function(){return!!a}}};var Ht=class extends X{constructor(e){e=e||{},super(e),this.speed_=e.speed||0,this.side_=e.side||"top"}animate(e){if(!e.time){var t=e.frameState.viewState.rotation,i=e.frameState.size[1]*e.frameState.viewState.resolution;this.side_!="top"&&(i*=-1),this.dx=-Math.sin(t)*i,this.dy=Math.cos(t)*i,this.speed_&&(this.duration_=i/this.speed_/e.frameState.viewState.resolution)}var a=e.geom.clone();return a.translate(this.dx*(1-this.easing_(e.elapsed)),this.dy*(1-this.easing_(e.elapsed))),this.drawGeom_(e,a,e.geom),e.time<=this.duration_}},Wt=class extends X{constructor(e){e=e||{},super(e),this.speed_=e.speed||0}animate(e){return e.context.globalAlpha=this.easing_(e.elapsed),this.drawGeom_(e,e.geom),e.time<=this.duration_}},Xt=class extends X{constructor(e){switch(e=e||{},super(e),this.speed_=e.speed||0,this.path_=e.path,e.rotate){case!0:case 0:this.rotate_=0;break;default:this.rotate_=e.rotate||!1;break}this.path_&&this.path_.getGeometry&&(this.path_=this.path_.getGeometry()),this.path_&&this.path_.getLineString&&(this.path_=this.path_.getLineString()),this.path_.getLength?(this.dist_=this.path_.getLength(),this.path_&&this.path_.getCoordinates&&(this.path_=this.path_.getCoordinates())):this.dist_=0,this.speed_>0&&(this.duration_=this.dist_/this.speed_)}animate(e){if(!e.time&&!this.dist_)return!1;var t=this.dist_*this.easing_(e.elapsed),i,a,s,r,l,h,c=0;a=this.path_[0];for(var u=1;u<this.path_.length;u++){if(i=a,a=this.path_[u],r=a[0]-i[0],l=a[1]-i[1],h=Math.sqrt(r*r+l*l),h&&c+h>=t){e.extra={index:u,coordinates:a},s=(t-c)/h,a=[i[0]+(a[0]-i[0])*s,i[1]+(a[1]-i[1])*s];break}c+=h}var d=e.style;if(e.rotation=Math.PI/2+Math.atan2(i[1]-a[1],i[0]-a[0]),this.rotate_!==!1){var f=[],g=this.rotate_-e.rotation+e.frameState.viewState.rotation;e.rotation=Math.PI/2+Math.atan2(i[1]-a[1],i[0]-a[0]);for(var p=0;s=e.style[p];p++)s.getImage()&&s.getImage().setRotation(g),f.push(s);e.style=f}return e.geom.setCoordinates(a),this.drawGeom_(e,e.geom),e.style=d,e.time<=this.duration_}},Zt=class extends X{constructor(e){e=e||{},super(e),this.amplitude_=e.amplitude||40,this.bounce_=-Math.PI*(e.bounce||6),this.horizontal_=e.horizontal}animate(e){var t=e.geom.clone(),i=e.geom.clone(),a=this.easing_(e.elapsed);return a=Math.sin(this.bounce_*a)*this.amplitude_*(1-a)*e.frameState.viewState.resolution,this.horizontal_?(t.translate(a,0),i.translate(a,0)):t.translate(0,a),this.drawGeom_(e,t,i),e.time<=this.duration_}},Jt=class extends X{constructor(e){e=e||{},super(e),this.speed_=e.speed||0,this.side_=e.side||"left"}animate(e){e.time||(this.side_=="left"?this.dx=e.extent[0]-e.bbox[2]:this.dx=e.extent[2]-e.bbox[0],this.speed_&&(this.duration_=Math.abs(this.dx)/this.speed_/e.frameState.viewState.resolution));var t=e.geom.clone();return t.translate(this.dx*(1-this.easing_(e.elapsed)),0),this.drawGeom_(e,t),e.time<=this.duration_}},$t=class extends X{constructor(e){super(e)}animate(e){var t=this.easing_(e.elapsed);if(t){e.context.save();var i=e.frameState.pixelRatio;e.context.globalAlpha=t,e.context.scale(t,1/t);var a=e.frameState.coordinateToPixelTransform,s=(1/t-1)*i*(a[0]*e.coord[0]+a[1]*e.coord[1]+a[4]),r=(t-1)*i*(a[2]*e.coord[0]+a[3]*e.coord[1]+a[5]);e.context.translate(s,r),this.drawGeom_(e,e.geom),e.context.restore()}return e.time<=this.duration_}},ti=class extends X{constructor(e){e=e||{},super(e),this.set("zoomout",e.zoomOut)}animate(e){var t=this.easing_(e.elapsed);if(t){this.get("zoomout")&&(t=1/t);var i=e.style,a,s,r=[];for(a=0;a<i.length;a++)s=i[a].getImage(),s&&(r[a]=s.getScale(),e.type==="postrender"?s.setScale(r[a]*t/e.frameState.pixelRatio):s.setScale(r[a]*t));for(this.drawGeom_(e,e.geom),a=0;a<i.length;a++)s=i[a].getImage(),s&&s.setScale(r[a])}return e.time<=this.duration_}};export{Ht as a,Wt as b,Xt as c,Zt as d,Jt as e,$t as f,ti as g,St as o};
