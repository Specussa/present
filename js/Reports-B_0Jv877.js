import{H as ne}from"./Header-BL8MieZH.js";import{F as ie}from"./Footer-k6EUNbS_.js";import{E as b,a as pe}from"./vendor-element-plus-DLLATbAB.js";import{d as ce,b as h,k as H,e as R,X as de,j as ue,c as m,Q as s,a,I as n,P as w,al as c,ar as _e,o as d,M as S,a4 as x,O as D,L as P,J as me,H as k,C as ve}from"./vendor-@vue-Cg4sS8W0.js";import{_ as ge}from"./index-C-Ed7sKV.js";import"./LogoSVG-2ta-NKj5.js";import"./vendor-vue-router-BMJZZRG0.js";import"./vendor-vue-i18n-D0pj9gOW.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-@element-plus-Bv-RgaI4.js";import"./vendor-lodash-es-C-zDejYo.js";import"./vendor-@vueuse-D3zzmj5p.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-dayjs-D6RD0Zoz.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";import"./vendor-geotiff-BjC_-_Sy.js";import"./vendor-xml-utils-BmThcpyG.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-B0C9zqkp.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-vue-tel-input-BZrepA_w.js";const be={class:"reports"},fe={class:"reports__container container"},ye={class:"reports__block"},he={class:"reports__flex"},we={class:"reports__control-panel-header"},De={class:"reports__control-panel-content"},ke={class:"reports__standard-sets"},Ce={class:"reports__date-range"},Ve={class:"reports__date-range-item"},Se={class:"reports__date-range-item"},xe={class:"reports__date-range-item"},Te={class:"reports__date-range-item"},Ye={class:"reports__action-buttons"},$e={class:"reports__available-columns-header"},Me={class:"reports__columns-count"},Ie={class:"reports__available-columns-content"},He={class:"reports__columns-group-title"},Ee={class:"reports__columns-group-list"},Oe={class:"reports__active-columns-header"},Pe={class:"reports__columns-count"},Ae={class:"reports__active-columns-list"},Be=["onDragstart","onDrop"],Re={key:0,class:"reports__empty-columns"},Ue={class:"reports__table-header"},je={key:0,class:"reports__table-info"},ze={key:0,class:"reports__table-footer"},Fe=ce({__name:"Reports",setup(Le){const E=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],T=h([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),C=h(""),U=H(()=>{if(!C.value)return"Конструктор";const t=r.value.map(l=>l.prop),e=T.value.find(l=>l.columns.length===t.length&&l.columns.every(i=>t.includes(i)));return e?e.name:"Конструктор"});R(C,t=>{if(!t)return;const e=T.value.find(i=>i.name===t);if(!e)return;const l=[];e.columns.forEach(i=>{const p=E.find(u=>u.prop===i);p&&l.push({...p})}),l.length>0&&(r.value=l,b.success(`Применен набор "${t}"`))});const r=h([]),v=h([]),Y=h(!1),_=de({startDate:"",startTime:"00:00",endDate:"",endTime:"23:59"}),V=h(null),j=H(()=>{const t={};return E.forEach(e=>{t[e.category]||(t[e.category]=[]),t[e.category].push(e)}),t}),z=H(()=>{const t=r.value.map(e=>e.prop);return E.filter(e=>!t.includes(e.prop))}),A=H(()=>_.startDate&&_.endDate),F={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},O=t=>{const e=r.value.findIndex(l=>l.prop===t.prop);if(e>=0){if(r.value.length<=0){b.warning("Должен остаться хотя бы один столбец");return}r.value.splice(e,1),b.success(`Столбец "${t.label}" удален`)}else r.value.push({...t}),b.success(`Столбец "${t.label}" добавлен`)},L=t=>{V.value=t},N=t=>{t.preventDefault()},J=t=>{if(V.value===null||V.value===t)return;const e=r.value.splice(V.value,1)[0];r.value.splice(t,0,e),V.value=null},Q=async()=>{if(!A.value){b.warning("Пожалуйста, выберите диапазон дат");return}Y.value=!0;try{const t=await X();v.value=t.data,b.success(`Загружено ${t.data.length} записей`)}catch(t){b.error("Ошибка при загрузке данных"),console.error("API Error:",t)}finally{Y.value=!1}},X=()=>new Promise(t=>{setTimeout(()=>{const e=Array.from({length:15},(l,i)=>{const p={id:i+1};return r.value.forEach(u=>{if(u.prop!=="id")switch(u.type){case"number":p[u.prop]=Math.floor(Math.random()*1e3);break;case"date":p[u.prop]=new Date().toISOString().split("T")[0];break;case"datetime":p[u.prop]=new Date().toISOString();break;default:p[u.prop]=`Значение ${i+1} для ${u.label}`}}),p});t({data:e})},1e3)}),q=()=>{if(v.value.length===0){b.warning("Нет данных для экспорта");return}const t=r.value.map(u=>`"${u.label}"`).join(","),e=v.value.map(u=>r.value.map($=>`"${u[$.prop]||""}"`).join(",")).join(`
`),l=`data:text/csv;charset=utf-8,${t}
${e}`,i=encodeURI(l),p=document.createElement("a");p.setAttribute("href",i),p.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(p),p.click(),document.body.removeChild(p)},G=async()=>{try{await pe.confirm("Это действие очистит все данные и настройки таблицы. Продолжить?","Сброс таблицы",{confirmButtonText:"Сбросить",cancelButtonText:"Отмена",type:"warning"}),v.value=[],Object.assign(_,{startDate:"",startTime:"00:00",endDate:"",endTime:"23:59"}),b.success("Таблица сброшена")}catch{}};return ue(()=>{const t=new Date,e=new Date(t.getTime()-7*24*60*60*1e3);_.startDate=e.toISOString().split("T")[0],_.endDate=t.toISOString().split("T")[0]}),R(r,t=>{const e=t.map(i=>i.prop),l=T.value.find(i=>i.columns.length===e.length&&i.columns.every(p=>e.includes(p)));C.value=l?l.name:""},{deep:!0}),(t,e)=>{const l=c("el-button"),i=c("el-option"),p=c("el-select"),u=c("el-date-picker"),$=c("el-time-picker"),K=c("Search"),M=c("el-icon"),W=c("Download"),I=c("el-card"),Z=c("Plus"),ee=c("Close"),B=c("el-tag"),te=c("Rank"),ae=c("el-empty"),oe=c("el-table-column"),se=c("el-table"),re=c("el-pagination"),le=_e("loading");return d(),m(w,null,[s(ne),a("section",be,[a("div",fe,[a("div",ye,[a("div",he,[s(I,{class:"reports__control-panel"},{header:n(()=>[a("div",we,[e[6]||(e[6]=a("span",{class:"reports__control-panel-title"},"Управление отчетом",-1)),s(l,{type:"danger",text:"",onClick:G,class:"reports__reset-btn"},{default:n(()=>e[5]||(e[5]=[S("Сбросить")])),_:1})])]),default:n(()=>[a("div",De,[a("div",ke,[e[7]||(e[7]=a("label",{class:"reports__standard-sets-label"},"Набор столбцов:",-1)),s(p,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=o=>C.value=o),placeholder:U.value,class:"reports__standard-sets-select"},{default:n(()=>[(d(!0),m(w,null,x(T.value,o=>(d(),k(i,{key:o.name,label:o.name,value:o.name},null,8,["label","value"]))),128)),s(i,{label:"Конструктор",value:""})]),_:1},8,["modelValue","placeholder"])]),a("div",Ce,[a("div",Ve,[e[8]||(e[8]=a("label",{class:"reports__date-range-label"},"Начальная дата:",-1)),s(u,{modelValue:_.startDate,"onUpdate:modelValue":e[1]||(e[1]=o=>_.startDate=o),type:"date",placeholder:"Выберите дату",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date-picker"},null,8,["modelValue"])]),a("div",Se,[e[9]||(e[9]=a("label",{class:"reports__date-range-label"},"Время начала:",-1)),s($,{modelValue:_.startTime,"onUpdate:modelValue":e[2]||(e[2]=o=>_.startTime=o),placeholder:"Время начала",format:"HH:mm","value-format":"HH:mm",class:"reports__time-picker"},null,8,["modelValue"])]),a("div",xe,[e[10]||(e[10]=a("label",{class:"reports__date-range-label"},"Конечная дата:",-1)),s(u,{modelValue:_.endDate,"onUpdate:modelValue":e[3]||(e[3]=o=>_.endDate=o),type:"date",placeholder:"Выберите дату",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date-picker"},null,8,["modelValue"])]),a("div",Te,[e[11]||(e[11]=a("label",{class:"reports__date-range-label"},"Время окончания:",-1)),s($,{modelValue:_.endTime,"onUpdate:modelValue":e[4]||(e[4]=o=>_.endTime=o),placeholder:"Время окончания",format:"HH:mm","value-format":"HH:mm",class:"reports__time-picker"},null,8,["modelValue"])])]),a("div",Ye,[s(l,{type:"primary",onClick:Q,loading:Y.value,disabled:!A.value,class:"reports__action-btn reports__action-btn--primary"},{default:n(()=>[s(M,null,{default:n(()=>[s(K)]),_:1}),e[12]||(e[12]=S(" Запросить данные "))]),_:1},8,["loading","disabled"]),s(l,{type:"warning",onClick:q,disabled:v.value.length===0,class:"reports__action-btn reports__action-btn--warning"},{default:n(()=>[s(M,null,{default:n(()=>[s(W)]),_:1}),e[13]||(e[13]=S(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),_:1}),s(I,{class:"reports__available-columns"},{header:n(()=>[a("div",$e,[e[14]||(e[14]=a("span",{class:"reports__available-columns-title"},"Доступные столбцы",-1)),a("span",Me,"("+D(z.value.length)+")",1)])]),default:n(()=>[a("div",Ie,[(d(!0),m(w,null,x(j.value,(o,f)=>(d(),m("div",{key:f,class:"reports__columns-group"},[a("h4",He,D(F[f]||f),1),a("div",Ee,[(d(!0),m(w,null,x(o,g=>(d(),k(B,{key:g.prop,type:r.value.some(y=>y.prop===g.prop)?"success":"info",closable:!1,class:ve(["reports__column-tag reports__column-tag--available",{"reports__column-tag--active":r.value.some(y=>y.prop===g.prop)}]),onClick:y=>O(g)},{default:n(()=>[S(D(g.label)+" ",1),s(M,{class:"reports__column-tag-icon"},{default:n(()=>[r.value.some(y=>y.prop===g.prop)?(d(),k(ee,{key:1})):(d(),k(Z,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])]),_:1}),s(I,{class:"reports__active-columns"},{header:n(()=>[a("div",Oe,[e[15]||(e[15]=a("span",{class:"reports__active-columns-title"},"Активные столбцы",-1)),a("span",Pe,"("+D(r.value.length)+")",1)])]),default:n(()=>[a("div",Ae,[(d(!0),m(w,null,x(r.value,(o,f)=>(d(),m("div",{key:o.prop,class:"reports__active-column-item",draggable:"true",onDragstart:g=>L(f),onDragover:N,onDrop:g=>J(f)},[s(B,{closable:"","disable-transitions":!1,onClose:g=>O(o),onClick:g=>O(o),class:"reports__column-tag reports__column-tag--active-item"},{default:n(()=>[s(M,{class:"reports__drag-icon"},{default:n(()=>[s(te)]),_:1}),S(" "+D(o.label),1)]),_:2},1032,["onClose","onClick"])],40,Be))),128)),r.value.length===0?(d(),m("div",Re,[s(ae,{description:"Добавьте столбцы из списка выше","image-size":60})])):P("",!0)])]),_:1}),s(I,{class:"reports__table"},{header:n(()=>[a("div",Ue,[e[16]||(e[16]=a("span",{class:"reports__table-title"},"Данные отчета",-1)),v.value.length>0?(d(),m("span",je," Записей: "+D(v.value.length),1)):P("",!0)])]),default:n(()=>[me((d(),k(se,{data:v.value,border:"",stripe:"",style:{width:"100%"},"empty-text":"Нет данных для отображения",class:"reports__table-element"},{default:n(()=>[(d(!0),m(w,null,x(r.value,o=>(d(),k(oe,{key:o.prop,prop:o.prop,label:o.label,width:o.width,sortable:o.sortable,"show-overflow-tooltip":""},null,8,["prop","label","width","sortable"]))),128))]),_:1},8,["data"])),[[le,Y.value]]),v.value.length>0?(d(),m("div",ze,[s(re,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:v.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):P("",!0)]),_:1})])])])]),s(ie)],64)}}}),ht=ge(Fe,[["__scopeId","data-v-e7778312"]]);export{ht as default};
