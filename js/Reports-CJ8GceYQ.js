import{H as _e}from"./Header-BecD31pj.js";import{F as ue}from"./Footer-D9Epa5fJ.js";import{E as g,a as ve}from"./vendor-element-plus-CZs5FMWl.js";import{d as me,b as h,k as P,e as A,X as be,j as ge,S as he,c as u,Q as s,a,I as d,O as f,P as y,a4 as C,L as x,J as fe,H as S,al as _,ar as ye,o as p,M as V,C as we}from"./vendor-@vue-Cg4sS8W0.js";import{_ as De}from"./index-CPta0tcF.js";import"./LogoSVG-C3qW82K5.js";import"./vendor-vue-router-BMJZZRG0.js";import"./vendor-vue-i18n-D0pj9gOW.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-@element-plus-zuhFJ_6P.js";import"./vendor-lodash-es-C-zDejYo.js";import"./vendor-@vueuse-D3zzmj5p.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-dayjs-D6RD0Zoz.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";import"./vendor-geotiff-BjC_-_Sy.js";import"./vendor-xml-utils-BmThcpyG.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-B0C9zqkp.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-vue-tel-input-BZrepA_w.js";const ke={class:"reports"},Ce={class:"reports__container container"},xe={class:"reports__block"},Se={class:"reports__flex list_flex"},Ve={key:0,class:"reports__left list_left"},Me={class:"reports__scroll list_scroll"},Ye={class:"reports__top"},$e={class:"reports__head"},Ie={class:"reports__form"},Ee={class:"reports__standart"},Te={class:"reports__date-range"},Be={class:"reports__date_item full-width"},Re={class:"reports__buttons"},Oe={class:"reports__available"},Pe={class:"reports__available_head"},Ue={class:"reports__net_count el-table_count text_four"},Ae={class:"reports__available_content"},ze={class:"reports__available_desc text_two"},Fe={class:"reports__available_list"},Le={class:"reports__right list_right"},je={key:0,class:"reports__mobile-controls"},We={class:"reports__mobile-management"},He={class:"reports__head"},Ne={class:"reports__form"},Je={class:"reports__date-range"},Qe={class:"reports__date_item full-width"},Xe={class:"reports__buttons"},qe={class:"reports__mobile-columns"},Ge={class:"reports__available_head"},Ke={class:"reports__net_count el-table_count text_four"},Ze={key:1,class:"reports__net"},et={class:"reports__net_head"},tt={class:"reports__net_count el-table_count text_four"},at={class:"reports__net_list"},st=["onDragstart","onDrop"],ot={key:0,class:"reports__empty"},lt={class:"reports__table"},rt={class:"reports__table_head"},nt={key:0,class:"el-table_count text_four"},it={key:0,class:"reports__table_footer"},pt=me({__name:"Reports",setup(dt){const M=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],T=h([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),w=h(""),Q=P(()=>{if(!w.value)return"Конструктор";const t=o.value.map(n=>n.prop),e=T.value.find(n=>n.columns.length===t.length&&n.columns.every(r=>t.includes(r)));return e?e.name:"Конструктор"});A(w,t=>{if(!t)return;const e=T.value.find(r=>r.name===t);if(!e)return;const n=[];e.columns.forEach(r=>{const i=M.find(c=>c.prop===r);i&&n.push({...i})}),n.length>0&&(o.value=n,g.success(`Применен набор "${t}"`))});const o=h([]),m=h([]),Y=h(!1),v=be({startDate:"",endDate:""}),$=h(null),I=h(null),X=P(()=>{const t={};return M.forEach(e=>{t[e.category]||(t[e.category]=[]),t[e.category].push(e)}),t}),q=P(()=>{const t=o.value.map(e=>e.prop);return M.filter(e=>!t.includes(e.prop))}),G=P(()=>!!v.startDate&&!!v.endDate),K={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},U=t=>{const e=o.value.findIndex(n=>n.prop===t.prop);if(e>=0){if(o.value.length<=0){g.warning("Должен остаться хотя бы один столбец");return}o.value.splice(e,1),g.success(`Столбец "${t.label}" удален`)}else o.value.push({...t}),g.success(`Столбец "${t.label}" добавлен`)},Z=t=>{I.value=t},ee=t=>{t.preventDefault()},te=t=>{if(I.value===null||I.value===t)return;const e=o.value.splice(I.value,1)[0];o.value.splice(t,0,e),I.value=null},z=async()=>{if(!G.value){g.warning("Пожалуйста, выберите диапазон дат");return}Y.value=!0;try{const t=await ae();m.value=t.data,g.success(`Загружено ${t.data.length} записей`)}catch(t){g.error("Ошибка при загрузке данных"),console.error("API Error:",t)}finally{Y.value=!1}},ae=()=>new Promise(t=>{setTimeout(()=>{const e=Array.from({length:15},(n,r)=>{const i={id:r+1};return o.value.forEach(c=>{if(c.prop!=="id")switch(c.type){case"number":i[c.prop]=Math.floor(Math.random()*1e3);break;case"date":i[c.prop]=new Date().toISOString().split("T")[0];break;case"datetime":i[c.prop]=new Date().toISOString();break;default:i[c.prop]=`Значение ${r+1} для ${c.label}`}}),i});t({data:e})},1e3)}),F=()=>{if(m.value.length===0){g.warning("Нет данных для экспорта");return}const t=o.value.map(c=>`"${c.label}"`).join(","),e=m.value.map(c=>o.value.map(R=>`"${c[R.prop]||""}"`).join(",")).join(`
`),n=`data:text/csv;charset=utf-8,${t}
${e}`,r=encodeURI(n),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},L=async()=>{try{await ve.confirm("Это действие очистит все данные и настройки таблицы. Продолжить?","Сброс таблицы",{confirmButtonText:"Сбросить",cancelButtonText:"Отмена",type:"warning"}),o.value=[],E.value=[],v.startDate="",v.endDate="",$.value=null,m.value=[],w.value="",g.success("Таблица сброшена")}catch{}},j=t=>{if(t&&t[0]&&t[1]){const e=typeof t[0]=="string"?new Date(t[0]):t[0],n=typeof t[1]=="string"?new Date(t[1]):t[1];v.startDate=e.toISOString().split("T")[0],v.endDate=n.toISOString().split("T")[0]}else v.startDate="",v.endDate=""},E=h([]);A(o,t=>{E.value=t.map(e=>e.prop)},{deep:!0});const se=t=>{const e=[];t.forEach(n=>{const r=M.find(i=>i.prop===n);r&&e.push({...r})}),e.length>0?o.value=e:t.length===0&&o.value.length>0&&(E.value=o.value.map(n=>n.prop),g.warning("Должен остаться хотя бы один столбец"))};A(o,t=>{const e=t.map(r=>r.prop),n=T.value.find(r=>r.columns.length===e.length&&r.columns.every(i=>e.includes(i)));w.value=n?n.name:""},{deep:!0});const B=h(window.innerWidth),W=()=>{B.value=window.innerWidth};return ge(()=>{window.addEventListener("resize",W)}),he(()=>{window.removeEventListener("resize",W)}),(t,e)=>{const n=_("BrushFilled"),r=_("el-icon"),i=_("el-option"),c=_("el-select"),R=_("el-date-picker"),H=_("Search"),O=_("el-button"),N=_("Download"),oe=_("Plus"),le=_("Close"),J=_("el-tag"),re=_("Rank"),ne=_("el-empty"),ie=_("el-table-column"),pe=_("el-table"),de=_("el-pagination"),ce=ye("loading");return p(),u(y,null,[s(_e),a("section",ke,[a("div",Ce,[a("div",xe,[a("div",Se,[B.value>=1280?(p(),u("div",Ve,[a("div",Me,[a("div",Ye,[a("div",$e,[e[4]||(e[4]=a("span",{class:"reports__title"},"Управление отчетом",-1)),a("button",{onClick:L,class:"reports__reset"},[s(r,null,{default:d(()=>[s(n)]),_:1})])]),a("div",Ie,[a("div",Ee,[e[5]||(e[5]=a("label",{class:"reports__standart_label"},"Набор столбцов:",-1)),s(c,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),placeholder:Q.value,class:"reports__standart_select"},{default:d(()=>[(p(!0),u(y,null,C(T.value,l=>(p(),S(i,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))),128)),s(i,{label:"Конструктор",value:""})]),_:1},8,["modelValue","placeholder"])]),a("div",Te,[a("div",Be,[e[6]||(e[6]=a("label",{class:"reports__date_label"},"Диапазон дат:",-1)),s(R,{modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=l=>$.value=l),type:"daterange","range-separator":"до","start-placeholder":"Начальная дата","end-placeholder":"Конечная дата",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:j,"unlink-panels":!1},null,8,["modelValue"])])]),a("div",Re,[s(O,{type:"primary",onClick:z,loading:Y.value,disabled:!v.startDate||!v.endDate||o.value.length===0,class:"reports__button"},{default:d(()=>[s(r,null,{default:d(()=>[s(H)]),_:1}),e[7]||(e[7]=V(" Запросить данные "))]),_:1},8,["loading","disabled"]),s(O,{type:"warning",onClick:F,disabled:m.value.length===0,class:"reports__button"},{default:d(()=>[s(r,null,{default:d(()=>[s(N)]),_:1}),e[8]||(e[8]=V(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),a("div",Oe,[a("div",Pe,[e[9]||(e[9]=a("span",{class:"reports__available_title"},"Доступные столбцы",-1)),a("span",Ue,f(q.value.length),1)]),a("div",Ae,[(p(!0),u(y,null,C(X.value,(l,D)=>(p(),u("div",{key:D,class:"reports__available_group"},[a("p",ze,f(K[D]||D),1),a("div",Fe,[(p(!0),u(y,null,C(l,b=>(p(),S(J,{key:b.prop,type:o.value.some(k=>k.prop===b.prop)?"success":"primary",closable:!1,class:we(["reports__available_tag",{active:o.value.some(k=>k.prop===b.prop)}]),onClick:k=>U(b)},{default:d(()=>[V(f(b.label)+" ",1),s(r,{class:"reports__available_icon"},{default:d(()=>[o.value.some(k=>k.prop===b.prop)?(p(),S(le,{key:1})):(p(),S(oe,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])])])])):x("",!0),a("div",Le,[B.value<1280?(p(),u("div",je,[a("div",We,[a("div",He,[e[10]||(e[10]=a("span",{class:"reports__title"},"Управление отчетом",-1)),a("button",{onClick:L,class:"reports__reset"},[s(r,null,{default:d(()=>[s(n)]),_:1})])]),a("div",Ne,[a("div",Je,[a("div",Qe,[e[11]||(e[11]=a("label",{class:"reports__date_label"},"Диапазон дат:",-1)),s(R,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=l=>$.value=l),type:"daterange","range-separator":"до","start-placeholder":"Начальная дата","end-placeholder":"Конечная дата",format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:j},null,8,["modelValue"])])]),a("div",Xe,[s(O,{type:"primary",onClick:z,loading:Y.value,disabled:!v.startDate||!v.endDate||o.value.length===0,class:"reports__button"},{default:d(()=>[s(r,null,{default:d(()=>[s(H)]),_:1}),e[12]||(e[12]=V(" Запросить данные "))]),_:1},8,["loading","disabled"]),s(O,{type:"warning",onClick:F,disabled:m.value.length===0,class:"reports__button"},{default:d(()=>[s(r,null,{default:d(()=>[s(N)]),_:1}),e[13]||(e[13]=V(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),a("div",qe,[a("div",Ge,[e[14]||(e[14]=a("span",{class:"reports__available_title"},"Выбор столбцов",-1)),a("span",Ke,f(o.value.length),1)]),s(c,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=l=>E.value=l),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Выберите столбцы",class:"reports__mobile-select",onChange:se},{default:d(()=>[(p(),u(y,null,C(M,l=>s(i,{key:l.prop,label:l.label,value:l.prop},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):x("",!0),B.value>=1280?(p(),u("div",Ze,[a("div",et,[e[15]||(e[15]=a("span",{class:"reports__net_title"},"Активные столбцы",-1)),a("span",tt,f(o.value.length),1)]),a("div",at,[(p(!0),u(y,null,C(o.value,(l,D)=>(p(),u("div",{key:l.prop,class:"reports__net_item",draggable:"true",onDragstart:b=>Z(D),onDragover:ee,onDrop:b=>te(D)},[s(J,{closable:"","disable-transitions":!1,onClose:b=>U(l),onClick:b=>U(l),class:"reports__available_tag reports__available_grab"},{default:d(()=>[s(r,{class:"reports__drag"},{default:d(()=>[s(re)]),_:1}),V(" "+f(l.label),1)]),_:2},1032,["onClose","onClick"])],40,st))),128)),o.value.length===0?(p(),u("div",ot,[s(ne,{description:"Добавьте столбцы из списка выше","image-size":60})])):x("",!0)])])):x("",!0),a("div",lt,[a("div",rt,[e[16]||(e[16]=a("span",{class:"reports__table_title"},"Данные отчета",-1)),m.value.length>0?(p(),u("span",nt,f(m.value.length),1)):x("",!0)]),fe((p(),S(pe,{data:m.value,border:"",stripe:"",style:{width:"100%"},"empty-text":"Нет данных для отображения",class:"reports__table_element"},{default:d(()=>[(p(!0),u(y,null,C(o.value,l=>(p(),S(ie,{key:l.prop,prop:l.prop,label:l.label,"min-width":l.width,sortable:l.sortable},null,8,["prop","label","min-width","sortable"]))),128))]),_:1},8,["data"])),[[ce,Y.value]]),m.value.length>0?(p(),u("div",it,[s(de,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:m.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):x("",!0)])])])])])]),s(ue)],64)}}}),zt=De(pt,[["__scopeId","data-v-4bfccc42"]]);export{zt as default};
