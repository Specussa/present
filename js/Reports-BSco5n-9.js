import{H as xe}from"./Header-DGemiyHQ.js";import{F as Se}from"./Footer-84y3oTH-.js";import{G as Ve}from"./GoBack-D16Dd95R.js";import{R as Re}from"./ReportsFaq-Dnr73FLr.js";import{T as ae,_ as $e}from"./index-D1Rhb41C.js";import{E as k}from"./vendor-element-plus-Bt6C2HhV.js";import{d as Me,e as g,b as F,f as Q,k as Ye,m as Ie,U as Ee,c as b,R as o,a as e,P as u,u as i,J as c,Q as C,a4 as R,M as $,K as Te,I as M,D as L,al as v,ar as Be,o as d,O as w}from"./vendor-@vue-Bz_wJ882.js";import{u as Fe}from"./vendor-vue-i18n-DztdJ-Qd.js";import"./LogoSVG-M23y9Nw6.js";import"./vendor-vue-router-0eOeNsIj.js";import"./vendor-@element-plus-Cf--I8Lq.js";import"./VideoPlayer-BDSbfPA_.js";import"./vendor-geotiff-CNG5SH6k.js";import"./vendor-xml-utils-DQPdAQjV.js";import"./vendor-dayjs-B_aAqRSu.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-BuCIBY1L.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-vue-tel-input-BG99aFNs.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-lodash-es-Cq1PUQc0.js";import"./vendor-@vueuse-DRxsj0DG.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";const Le={class:"reports"},Oe={class:"reports__container container"},Pe={class:"reports__block"},Ue={class:"reports__flex list_flex"},Ae={key:0,class:"reports__left list_left"},ze={class:"reports__scroll list_scroll"},We={class:"reports__top"},je={class:"reports__head"},qe={class:"reports__title"},Qe={class:"reports__form"},Ge={class:"reports__standart"},He={class:"reports__date-range"},Ne={class:"reports__date_item full-width"},Je={class:"reports__standart_label text_three"},Ke={class:"reports__buttons"},Xe={class:"reports__available"},Ze={class:"reports__available_head"},et={class:"reports__available_title"},tt={class:"reports__net_count el-table_count text_four"},st={class:"reports__available_content"},ot={class:"reports__available_desc text_two"},at={class:"reports__available_list"},lt={class:"reports__right list_right"},rt={class:"breadcrumbs"},nt={class:"breadcrumbs__list"},it={class:"breadcrumbs__item"},pt={class:"breadcrumbs__item"},_t={class:"breadcrumbs__item"},ct=["title"],dt={class:"faq__icon"},ut={key:0,class:"reports__mobile_controls"},vt={class:"reports__mobile_management"},mt={class:"reports__head"},bt={class:"reports__title"},ht={class:"reports__form"},gt={class:"reports__date-range"},ft={class:"reports__date_item full-width"},yt={class:"reports__standart_label text_three"},kt={class:"reports__buttons"},wt={class:"reports__mobile_columns"},Dt={class:"reports__available_head"},Ct={class:"reports__net_count el-table_count text_four"},xt={key:1,class:"reports__net"},St={class:"reports__net_head"},Vt={class:"reports__net_title"},Rt={class:"reports__net_count el-table_count text_four"},$t={class:"reports__net_list"},Mt=["onDragstart","onDrop"],Yt={key:0,class:"reports__empty"},It={class:"reports__table"},Et={class:"reports__table_head"},Tt={class:"reports__table_title"},Bt={key:0,class:"el-table_count text_four"},Ft={key:0,class:"reports__table_footer"},Lt={class:"reset_popup__scroll popup__scroll_buttons"},Ot={class:"reset_popup__block popup__block"},Pt={class:"reset_popup__head popup__head"},Ut={class:"reset_popup__message popup__message text_two"},At={class:"popup__buttons"},zt={class:"ipopup__scroll popup__scroll"},Wt={class:"ipopup__block popup__block"},jt=Me({__name:"Reports",setup(qt){const{t:p}=Fe(),W=g(!1),O=g(!1),j=()=>{O.value=!O.value,W.value=!W.value,O.value?document.documentElement.classList.add("noscroll"):document.documentElement.classList.remove("noscroll")},Y=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],P=g([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),x=g(""),G=F(()=>p("reports.constructor")),le=F(()=>{if(!x.value)return G.value;const s=r.value.map(n=>n.prop),t=P.value.find(n=>n.columns.length===s.length&&n.columns.every(l=>s.includes(l)));return t?t.name:G.value});Q(x,s=>{if(!s)return;const t=P.value.find(l=>l.name===s);if(!t)return;const n=[];t.columns.forEach(l=>{const _=Y.find(m=>m.prop===l);_&&n.push({..._})}),n.length>0&&(r.value=n,k.success(`Применен набор "${s}"`))});const r=g([]),f=g([]),I=g(!1),h=Ye({startDate:"",endDate:""}),E=g(null),T=g(null),re=F(()=>{const s={};return Y.forEach(t=>{s[t.category]||(s[t.category]=[]),s[t.category].push(t)}),s}),ne=F(()=>{const s=r.value.map(t=>t.prop);return Y.filter(t=>!s.includes(t.prop))}),ie=F(()=>!!h.startDate&&!!h.endDate),pe={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},q=s=>{const t=r.value.findIndex(n=>n.prop===s.prop);if(t>=0){if(r.value.length<=0){k.warning("Должен остаться хотя бы один столбец");return}r.value.splice(t,1),k.success(`Столбец "${s.label}" удален`)}else r.value.push({...s}),k.success(`Столбец "${s.label}" добавлен`)},_e=s=>{T.value=s},ce=s=>{s.preventDefault()},de=s=>{if(T.value===null||T.value===s)return;const t=r.value.splice(T.value,1)[0];r.value.splice(s,0,t),T.value=null},H=async()=>{if(!ie.value){k.warning("Пожалуйста, выберите диапазон дат");return}I.value=!0;try{const s=await ue();f.value=s.data,k.success(`Загружено ${s.data.length} записей`)}catch(s){k.error("Ошибка при загрузке данных"),console.error("API Error:",s)}finally{I.value=!1}},ue=()=>new Promise(s=>{setTimeout(()=>{const t=Array.from({length:15},(n,l)=>{const _={id:l+1};return r.value.forEach(m=>{if(m.prop!=="id")switch(m.type){case"number":_[m.prop]=Math.floor(Math.random()*1e3);break;case"date":_[m.prop]=new Date().toISOString().split("T")[0];break;case"datetime":_[m.prop]=new Date().toISOString();break;default:_[m.prop]=`Значение ${l+1} для ${m.label}`}}),_});s({data:t})},1e3)}),N=()=>{if(f.value.length===0){k.warning("Нет данных для экспорта");return}const s=r.value.map(m=>`"${m.label}"`).join(","),t=f.value.map(m=>r.value.map(A=>`"${m[A.prop]||""}"`).join(",")).join(`
`),n=`data:text/csv;charset=utf-8,${s}
${t}`,l=encodeURI(n),_=document.createElement("a");_.setAttribute("href",l),_.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(_),_.click(),document.body.removeChild(_)},D=g(!1),J=()=>{D.value=!0},ve=()=>{r.value=[],B.value=[],h.startDate="",h.endDate="",E.value=null,f.value=[],x.value="",D.value=!1,k.success("Таблица сброшена")},K=s=>{if(s&&s[0]&&s[1]){const t=typeof s[0]=="string"?new Date(s[0]):s[0],n=typeof s[1]=="string"?new Date(s[1]):s[1];h.startDate=t.toISOString().split("T")[0],h.endDate=n.toISOString().split("T")[0]}else h.startDate="",h.endDate=""},B=g([]);Q(r,s=>{B.value=s.map(t=>t.prop)},{deep:!0});const me=s=>{const t=[];s.forEach(n=>{const l=Y.find(_=>_.prop===n);l&&t.push({...l})}),t.length>0?r.value=t:s.length===0&&r.value.length>0&&(B.value=r.value.map(n=>n.prop),k.warning("Должен остаться хотя бы один столбец"))};Q(r,s=>{const t=s.map(l=>l.prop),n=P.value.find(l=>l.columns.length===t.length&&l.columns.every(_=>t.includes(_)));x.value=n?n.name:""},{deep:!0});const U=g(window.innerWidth),X=()=>{U.value=window.innerWidth};return Ie(()=>{window.addEventListener("resize",X)}),Ee(()=>{window.removeEventListener("resize",X)}),(s,t)=>{const n=v("BrushFilled"),l=v("el-icon"),_=v("el-option"),m=v("el-select"),A=v("el-date-picker"),Z=v("Search"),z=v("el-button"),ee=v("Download"),be=v("Plus"),he=v("Close"),te=v("el-tag"),se=v("RouterLink"),ge=v("QuestionFilled"),fe=v("Rank"),ye=v("el-empty"),ke=v("el-table-column"),we=v("el-table"),De=v("el-pagination"),oe=v("CloseBold"),Ce=Be("loading");return d(),b(C,null,[o(xe),e("section",Le,[e("div",Oe,[e("div",Pe,[e("div",Ue,[U.value>=1280?(d(),b("div",Ae,[e("div",ze,[e("div",We,[e("div",je,[e("span",qe,u(i(p)("reports.reportManagement")),1),e("button",{onClick:J,class:"reports__reset"},[o(l,null,{default:c(()=>[o(n)]),_:1})])]),e("div",Qe,[e("div",Ge,[t[8]||(t[8]=e("label",{class:"reports__standart_label text_three"},"Набор столбцов:",-1)),o(m,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),placeholder:le.value,class:"reports__standart_select"},{default:c(()=>[(d(!0),b(C,null,R(P.value,a=>(d(),M(_,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128)),o(_,{label:i(p)("reports.constructor"),value:""},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),e("div",He,[e("div",Ne,[e("label",Je,u(i(p)("table.dateRange"))+":",1),o(A,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=a=>E.value=a),type:"daterange","range-separator":"—","start-placeholder":i(p)("table.startDate"),"end-placeholder":i(p)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:K,"unlink-panels":!1},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",Ke,[o(z,{type:"primary",onClick:H,loading:I.value,disabled:!h.startDate||!h.endDate||r.value.length===0,class:"reports__button"},{default:c(()=>[o(l,null,{default:c(()=>[o(Z)]),_:1}),t[9]||(t[9]=w(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:N,disabled:f.value.length===0,class:"reports__button"},{default:c(()=>[o(l,null,{default:c(()=>[o(ee)]),_:1}),t[10]||(t[10]=w(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",Xe,[e("div",Ze,[e("span",et,u(i(p)("reports.availableColumns")),1),e("span",tt,u(ne.value.length),1)]),e("div",st,[(d(!0),b(C,null,R(re.value,(a,S)=>(d(),b("div",{key:S,class:"reports__available_group"},[e("p",ot,u(pe[S]||S),1),e("div",at,[(d(!0),b(C,null,R(a,y=>(d(),M(te,{key:y.prop,type:r.value.some(V=>V.prop===y.prop)?"success":"primary",closable:!1,class:L(["reports__available_tag",{active:r.value.some(V=>V.prop===y.prop)}]),onClick:V=>q(y)},{default:c(()=>[w(u(y.label)+" ",1),o(l,{class:"reports__available_icon"},{default:c(()=>[r.value.some(V=>V.prop===y.prop)?(d(),M(he,{key:1})):(d(),M(be,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])])])])):$("",!0),e("div",lt,[e("div",rt,[e("ul",nt,[e("li",it,[o(Ve)]),e("li",pt,[o(se,{class:"breadcrumbs__link text_four",to:i(ae).i18nRoute({name:"map"})},{default:c(()=>[w(u(i(p)("header.home")),1)]),_:1},8,["to"])]),e("li",_t,[o(se,{class:"breadcrumbs__link text_four",to:i(ae).i18nRoute({name:"reports"})},{default:c(()=>[w(u(i(p)("header.reports")),1)]),_:1},8,["to"])])]),e("button",{class:"breadcrumbs__instructions title_three",title:i(p)("header.instructions"),onClick:j},[e("span",dt,[o(l,null,{default:c(()=>[o(ge)]),_:1})])],8,ct)]),U.value<1280?(d(),b("div",ut,[e("div",vt,[e("div",mt,[e("span",bt,u(i(p)("reports.reportManagement")),1),e("button",{onClick:t[2]||(t[2]=a=>J()),class:"reports__reset"},[o(l,null,{default:c(()=>[o(n)]),_:1})])]),e("div",ht,[e("div",gt,[e("div",ft,[e("label",yt,u(i(p)("table.dateRange"))+":",1),o(A,{modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=a=>E.value=a),type:"daterange","range-separator":"—","start-placeholder":i(p)("table.startDate"),"end-placeholder":i(p)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:K},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",kt,[o(z,{type:"primary",onClick:H,loading:I.value,disabled:!h.startDate||!h.endDate||r.value.length===0,class:"reports__button"},{default:c(()=>[o(l,null,{default:c(()=>[o(Z)]),_:1}),t[11]||(t[11]=w(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:N,disabled:f.value.length===0,class:"reports__button"},{default:c(()=>[o(l,null,{default:c(()=>[o(ee)]),_:1}),t[12]||(t[12]=w(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",wt,[e("div",Dt,[t[13]||(t[13]=e("span",{class:"reports__available_title"},"Выбор столбцов",-1)),e("span",Ct,u(r.value.length),1)]),o(m,{modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=a=>B.value=a),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Выберите столбцы",class:"reports__mobile_select",onChange:me},{default:c(()=>[(d(),b(C,null,R(Y,a=>o(_,{key:a.prop,label:a.label,value:a.prop},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):$("",!0),U.value>=1280?(d(),b("div",xt,[e("div",St,[e("span",Vt,u(i(p)("reports.activeColumns")),1),e("span",Rt,u(r.value.length),1)]),e("div",$t,[(d(!0),b(C,null,R(r.value,(a,S)=>(d(),b("div",{key:a.prop,class:"reports__net_item",draggable:"true",onDragstart:y=>_e(S),onDragover:ce,onDrop:y=>de(S)},[o(te,{closable:"","disable-transitions":!1,onClose:y=>q(a),onClick:y=>q(a),class:"reports__available_tag reports__available_grab"},{default:c(()=>[o(l,{class:"reports__drag"},{default:c(()=>[o(fe)]),_:1}),w(" "+u(a.label),1)]),_:2},1032,["onClose","onClick"])],40,Mt))),128)),r.value.length===0?(d(),b("div",Yt,[o(ye,{description:i(p)("reports.addColumns"),"image-size":60},null,8,["description"])])):$("",!0)])])):$("",!0),e("div",It,[e("div",Et,[e("span",Tt,u(i(p)("reports.reportData")),1),f.value.length>0?(d(),b("span",Bt,u(f.value.length),1)):$("",!0)]),Te((d(),M(we,{data:f.value,border:"",stripe:"",style:{width:"100%"},"empty-text":i(p)("table.noData"),class:"reports__table_element"},{default:c(()=>[(d(!0),b(C,null,R(r.value,a=>(d(),M(ke,{key:a.prop,prop:a.prop,label:a.label,"min-width":a.width,sortable:a.sortable},null,8,["prop","label","min-width","sortable"]))),128))]),_:1},8,["data","empty-text"])),[[Ce,I.value]]),f.value.length>0?(d(),b("div",Ft,[o(De,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:f.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):$("",!0)])])])])])]),e("div",{class:L(["overlay_full",{active:D.value}]),onClick:t[5]||(t[5]=a=>D.value=!1)},null,2),e("div",{class:L(["reset_popup popup popup__small",{active:D.value}])},[e("div",Lt,[e("div",Ot,[e("button",{class:"reset_popup__close popup__close",onClick:t[6]||(t[6]=a=>D.value=!1)},[o(l,null,{default:c(()=>[o(oe)]),_:1})]),e("h4",Pt,u(i(p)("reports.resetTable")),1),e("p",Ut,u(i(p)("reports.resetMessage")),1)])]),e("div",At,[e("button",{class:"popup__button button__second button",onClick:t[7]||(t[7]=a=>D.value=!1)},[e("span",null,u(i(p)("button.cancel")),1)]),e("button",{class:"popup__button button__primary button",onClick:ve},[e("span",null,u(i(p)("button.clear")),1)])])],2),e("div",{class:L(["overlay_full",{active:W.value}]),onClick:j},null,2),e("div",{class:L(["ipopup popup",{active:O.value}])},[e("div",zt,[e("div",Wt,[e("button",{class:"ipopup__close popup__close",onClick:j},[o(l,null,{default:c(()=>[o(oe)]),_:1})]),o(Re)])])],2),o(Se)],64)}}}),Cs=$e(jt,[["__scopeId","data-v-378a4c38"]]);export{Cs as default};
