import{H as xe}from"./Header-DifcjWJ1.js";import{F as Se}from"./Footer-D4qMeZd5.js";import{G as Ve}from"./GoBack-fGQkXZsr.js";import{R as Re}from"./ReportsFaq-y2L9tQJN.js";import{B as $e}from"./Back-BcQOdGe-.js";import{P as Me}from"./Preloader-CTjq2Blf.js";import{T as ae,_ as Ye}from"./index-CXQX6UJ3.js";import{E as k}from"./vendor-element-plus-CoIo5P0c.js";import{d as Ie,e as g,b as P,f as Q,k as Ee,m as Te,U as Be,c as b,R as o,I as C,a as e,P as u,u as i,J as d,Q as x,a4 as M,M as Y,K as Pe,D as F,al as m,ar as Fe,o as p,O as w}from"./vendor-@vue-Bz_wJ882.js";import{u as Le}from"./vendor-vue-i18n-DztdJ-Qd.js";import"./LogoSVG-FdJAhbjC.js";import"./vendor-vue-router-0eOeNsIj.js";import"./vendor-@element-plus-DJ55j-yS.js";import"./VideoPlayer-CZzDQXTJ.js";import"./vendor-geotiff-CNG5SH6k.js";import"./vendor-xml-utils-DQPdAQjV.js";import"./vendor-dayjs-B_aAqRSu.js";import"./vendor-@petamoriken-D_Z9L4hp.js";import"./vendor-quick-lru-D3vInPgE.js";import"./vendor-pako-CPws4d4z.js";import"./vendor-lerc-BuCIBY1L.js";import"./vendor-zstddec-zw5PE4Vj.js";import"./vendor-web-worker-2oq5GE5I.js";import"./vendor-axios-BimPEqV4.js";import"./vendor-vue-tel-input-BG99aFNs.js";import"./vendor-@intlify-CQT3u4ju.js";import"./vendor-lodash-es-Cq1PUQc0.js";import"./vendor-@vueuse-DRxsj0DG.js";import"./vendor-@popperjs-D9SI2xQl.js";import"./vendor-@ctrl-r5W6hzzQ.js";import"./vendor-async-validator-DKvM95Vc.js";import"./vendor-memoize-one-BdPwpGay.js";import"./vendor-normalize-wheel-es-B6fDCfyv.js";import"./vendor-@floating-ui-DF51-gJp.js";const Oe={key:1,class:"reports"},Ue={class:"reports__container container"},Ae={class:"reports__block"},ze={class:"reports__flex list_flex"},We={key:0,class:"reports__left list_left"},je={class:"reports__scroll list_scroll"},qe={class:"reports__top"},Qe={class:"reports__head"},Ge={class:"reports__title"},He={class:"reports__form"},Ne={class:"reports__standart"},Je={class:"reports__date-range"},Ke={class:"reports__date_item full-width"},Xe={class:"reports__standart_label text_three"},Ze={class:"reports__buttons"},et={class:"reports__available"},tt={class:"reports__available_head"},st={class:"reports__available_title"},ot={class:"reports__net_count el-table_count text_four"},at={class:"reports__available_content"},lt={class:"reports__available_desc text_two"},rt={class:"reports__available_list"},nt={class:"reports__right list_right"},it={class:"breadcrumbs"},pt={class:"breadcrumbs__list"},_t={class:"breadcrumbs__item"},ct={class:"breadcrumbs__item"},dt={class:"breadcrumbs__item"},ut=["title"],mt={class:"faq__icon"},vt={key:0,class:"reports__mobile_controls"},bt={class:"reports__mobile_management"},ht={class:"reports__head"},gt={class:"reports__title"},ft={class:"reports__form"},yt={class:"reports__date-range"},kt={class:"reports__date_item full-width"},wt={class:"reports__standart_label text_three"},Dt={class:"reports__buttons"},Ct={class:"reports__mobile_columns"},xt={class:"reports__available_head"},St={class:"reports__net_count el-table_count text_four"},Vt={key:1,class:"reports__net"},Rt={class:"reports__net_head"},$t={class:"reports__net_title"},Mt={class:"reports__net_count el-table_count text_four"},Yt={class:"reports__net_list"},It=["onDragstart","onDrop"],Et={key:0,class:"reports__empty"},Tt={class:"reports__table"},Bt={class:"reports__table_head"},Pt={class:"reports__table_title"},Ft={key:0,class:"el-table_count text_four"},Lt={key:0,class:"reports__table_footer"},Ot={class:"reset_popup__scroll popup__scroll_buttons"},Ut={class:"reset_popup__block popup__block"},At={class:"reset_popup__head popup__head"},zt={class:"reset_popup__message popup__message text_two"},Wt={class:"popup__buttons"},jt={class:"ipopup__scroll popup__scroll"},qt={class:"ipopup__block popup__block"},Qt=Ie({__name:"Reports",setup(Gt){const{t:_}=Le(),S=g(!1),W=g(!1),L=g(!1),j=()=>{L.value=!L.value,W.value=!W.value,L.value?document.documentElement.classList.add("noscroll"):document.documentElement.classList.remove("noscroll")},I=[{prop:"id",label:"ID",width:80,type:"number",category:"basic"},{prop:"name",label:"Название",width:150,type:"text",category:"basic"},{prop:"description",label:"Описание",width:200,type:"text",category:"basic"},{prop:"created_at",label:"Дата создания",width:120,type:"date",category:"dates"},{prop:"updated_at",label:"Дата обновления",width:120,type:"date",category:"dates"},{prop:"timestamp",label:"Метка времени",width:150,type:"datetime",category:"dates"},{prop:"views",label:"Просмотры",width:100,type:"number",category:"stats"},{prop:"clicks",label:"Клики",width:100,type:"number",category:"stats"},{prop:"conversion",label:"Конверсия",width:110,type:"number",category:"stats"},{prop:"price",label:"Цена",width:100,type:"number",category:"finance"},{prop:"revenue",label:"Доход",width:120,type:"number",category:"finance"},{prop:"profit",label:"Прибыль",width:120,type:"number",category:"finance"},{prop:"status",label:"Статус",width:120,type:"text",category:"status"},{prop:"priority",label:"Приоритет",width:100,type:"text",category:"status"},{prop:"category",label:"Категория",width:120,type:"text",category:"status"}],O=g([{name:"Минимальный",columns:["id","name"]},{name:"Основной",columns:["id","name","description","status","created_at"]},{name:"Аналитический",columns:["id","name","views","clicks","conversion","revenue","profit"]},{name:"Полный",columns:["id","name","description","status","priority","category","created_at","updated_at","views","clicks","price","revenue"]},{name:"Финансовый",columns:["id","name","price","revenue","profit","conversion"]},{name:"Статистический",columns:["id","name","views","clicks","conversion","timestamp"]}]),V=g(""),G=P(()=>_("reports.constructor")),le=P(()=>{if(!V.value)return G.value;const s=r.value.map(n=>n.prop),t=O.value.find(n=>n.columns.length===s.length&&n.columns.every(l=>s.includes(l)));return t?t.name:G.value});Q(V,s=>{if(!s)return;const t=O.value.find(l=>l.name===s);if(!t)return;const n=[];t.columns.forEach(l=>{const c=I.find(v=>v.prop===l);c&&n.push({...c})}),n.length>0&&(r.value=n,k.success(`Применен набор "${s}"`))});const r=g([]),f=g([]),h=Ee({startDate:"",endDate:""}),E=g(null),T=g(null),re=P(()=>{const s={};return I.forEach(t=>{s[t.category]||(s[t.category]=[]),s[t.category].push(t)}),s}),ne=P(()=>{const s=r.value.map(t=>t.prop);return I.filter(t=>!s.includes(t.prop))}),ie=P(()=>!!h.startDate&&!!h.endDate),pe={basic:"Основные",dates:"Даты и время",stats:"Статистика",finance:"Финансы",status:"Статусы"},q=s=>{const t=r.value.findIndex(n=>n.prop===s.prop);if(t>=0){if(r.value.length<=0){k.warning("Должен остаться хотя бы один столбец");return}r.value.splice(t,1),k.success(`Столбец "${s.label}" удален`)}else r.value.push({...s}),k.success(`Столбец "${s.label}" добавлен`)},_e=s=>{T.value=s},ce=s=>{s.preventDefault()},de=s=>{if(T.value===null||T.value===s)return;const t=r.value.splice(T.value,1)[0];r.value.splice(s,0,t),T.value=null},H=async()=>{if(!ie.value){k.warning("Пожалуйста, выберите диапазон дат");return}S.value=!0;try{const s=await ue();f.value=s.data,k.success(`Загружено ${s.data.length} записей`)}catch(s){k.error("Ошибка при загрузке данных"),console.error("API Error:",s)}finally{S.value=!1}},ue=()=>new Promise(s=>{setTimeout(()=>{const t=Array.from({length:15},(n,l)=>{const c={id:l+1};return r.value.forEach(v=>{if(v.prop!=="id")switch(v.type){case"number":c[v.prop]=Math.floor(Math.random()*1e3);break;case"date":c[v.prop]=new Date().toISOString().split("T")[0];break;case"datetime":c[v.prop]=new Date().toISOString();break;default:c[v.prop]=`Значение ${l+1} для ${v.label}`}}),c});s({data:t})},1e3)}),N=()=>{if(f.value.length===0){k.warning("Нет данных для экспорта");return}const s=r.value.map(v=>`"${v.label}"`).join(","),t=f.value.map(v=>r.value.map(A=>`"${v[A.prop]||""}"`).join(",")).join(`
`),n=`data:text/csv;charset=utf-8,${s}
${t}`,l=encodeURI(n),c=document.createElement("a");c.setAttribute("href",l),c.setAttribute("download",`report_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)},D=g(!1),J=()=>{D.value=!0},me=()=>{r.value=[],B.value=[],h.startDate="",h.endDate="",E.value=null,f.value=[],V.value="",D.value=!1,k.success("Таблица сброшена")},K=s=>{if(s&&s[0]&&s[1]){const t=typeof s[0]=="string"?new Date(s[0]):s[0],n=typeof s[1]=="string"?new Date(s[1]):s[1];h.startDate=t.toISOString().split("T")[0],h.endDate=n.toISOString().split("T")[0]}else h.startDate="",h.endDate=""},B=g([]);Q(r,s=>{B.value=s.map(t=>t.prop)},{deep:!0});const ve=s=>{const t=[];s.forEach(n=>{const l=I.find(c=>c.prop===n);l&&t.push({...l})}),t.length>0?r.value=t:s.length===0&&r.value.length>0&&(B.value=r.value.map(n=>n.prop),k.warning("Должен остаться хотя бы один столбец"))};Q(r,s=>{const t=s.map(l=>l.prop),n=O.value.find(l=>l.columns.length===t.length&&l.columns.every(c=>t.includes(c)));V.value=n?n.name:""},{deep:!0});const U=g(window.innerWidth),X=()=>{U.value=window.innerWidth};return Te(()=>{window.addEventListener("resize",X)}),Be(()=>{window.removeEventListener("resize",X)}),(s,t)=>{const n=m("BrushFilled"),l=m("el-icon"),c=m("el-option"),v=m("el-select"),A=m("el-date-picker"),Z=m("Search"),z=m("el-button"),ee=m("Download"),be=m("Plus"),he=m("Close"),te=m("el-tag"),se=m("RouterLink"),ge=m("QuestionFilled"),fe=m("Rank"),ye=m("el-empty"),ke=m("el-table-column"),we=m("el-table"),De=m("el-pagination"),oe=m("CloseBold"),Ce=Fe("loading");return p(),b(x,null,[o(xe),S.value?(p(),C(Me,{key:0})):(p(),b("section",Oe,[e("div",Ue,[e("div",Ae,[e("div",ze,[U.value>=1280?(p(),b("div",We,[e("div",je,[e("div",qe,[e("div",Qe,[e("span",Ge,u(i(_)("reports.reportManagement")),1),e("button",{onClick:J,class:"reports__reset"},[o(l,null,{default:d(()=>[o(n)]),_:1})])]),e("div",He,[e("div",Ne,[t[8]||(t[8]=e("label",{class:"reports__standart_label text_three"},"Набор столбцов:",-1)),o(v,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a),placeholder:le.value,class:"reports__standart_select"},{default:d(()=>[(p(!0),b(x,null,M(O.value,a=>(p(),C(c,{key:a.name,label:a.name,value:a.name},null,8,["label","value"]))),128)),o(c,{label:i(_)("reports.constructor"),value:""},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),e("div",Je,[e("div",Ke,[e("label",Xe,u(i(_)("table.dateRange"))+":",1),o(A,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=a=>E.value=a),type:"daterange","range-separator":"—","start-placeholder":i(_)("table.startDate"),"end-placeholder":i(_)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:K,"unlink-panels":!1},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",Ze,[o(z,{type:"primary",onClick:H,loading:S.value,disabled:!h.startDate||!h.endDate||r.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(Z)]),_:1}),t[9]||(t[9]=w(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:N,disabled:f.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(ee)]),_:1}),t[10]||(t[10]=w(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",et,[e("div",tt,[e("span",st,u(i(_)("reports.availableColumns")),1),e("span",ot,u(ne.value.length),1)]),e("div",at,[(p(!0),b(x,null,M(re.value,(a,R)=>(p(),b("div",{key:R,class:"reports__available_group"},[e("p",lt,u(pe[R]||R),1),e("div",rt,[(p(!0),b(x,null,M(a,y=>(p(),C(te,{key:y.prop,type:r.value.some($=>$.prop===y.prop)?"success":"primary",closable:!1,class:F(["reports__available_tag",{active:r.value.some($=>$.prop===y.prop)}]),onClick:$=>q(y)},{default:d(()=>[w(u(y.label)+" ",1),o(l,{class:"reports__available_icon"},{default:d(()=>[r.value.some($=>$.prop===y.prop)?(p(),C(he,{key:1})):(p(),C(be,{key:0}))]),_:2},1024)]),_:2},1032,["type","class","onClick"]))),128))])]))),128))])])])])):Y("",!0),e("div",nt,[e("div",it,[e("ul",pt,[e("li",_t,[o(Ve)]),e("li",ct,[o(se,{class:"breadcrumbs__link text_four",to:i(ae).i18nRoute({name:"map"})},{default:d(()=>[w(u(i(_)("header.home")),1)]),_:1},8,["to"])]),e("li",dt,[o(se,{class:"breadcrumbs__link text_four",to:i(ae).i18nRoute({name:"reports"})},{default:d(()=>[w(u(i(_)("header.reports")),1)]),_:1},8,["to"])])]),e("button",{class:"breadcrumbs__instructions title_three",title:i(_)("header.instructions"),onClick:j},[e("span",mt,[o(l,null,{default:d(()=>[o(ge)]),_:1})])],8,ut)]),U.value<1280?(p(),b("div",vt,[e("div",bt,[e("div",ht,[e("span",gt,u(i(_)("reports.reportManagement")),1),e("button",{onClick:t[2]||(t[2]=a=>J()),class:"reports__reset"},[o(l,null,{default:d(()=>[o(n)]),_:1})])]),e("div",ft,[e("div",yt,[e("div",kt,[e("label",wt,u(i(_)("table.dateRange"))+":",1),o(A,{modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=a=>E.value=a),type:"daterange","range-separator":"—","start-placeholder":i(_)("table.startDate"),"end-placeholder":i(_)("table.endDate"),format:"DD.MM.YYYY","value-format":"YYYY-MM-DD",class:"reports__date_picker",onChange:K},null,8,["modelValue","start-placeholder","end-placeholder"])])]),e("div",Dt,[o(z,{type:"primary",onClick:H,loading:S.value,disabled:!h.startDate||!h.endDate||r.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(Z)]),_:1}),t[11]||(t[11]=w(" Запросить данные "))]),_:1},8,["loading","disabled"]),o(z,{type:"warning",onClick:N,disabled:f.value.length===0,class:"reports__button"},{default:d(()=>[o(l,null,{default:d(()=>[o(ee)]),_:1}),t[12]||(t[12]=w(" Экспорт в CSV "))]),_:1},8,["disabled"])])])]),e("div",Ct,[e("div",xt,[t[13]||(t[13]=e("span",{class:"reports__available_title"},"Выбор столбцов",-1)),e("span",St,u(r.value.length),1)]),o(v,{modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=a=>B.value=a),multiple:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Выберите столбцы",class:"reports__mobile_select",onChange:ve},{default:d(()=>[(p(),b(x,null,M(I,a=>o(c,{key:a.prop,label:a.label,value:a.prop},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):Y("",!0),U.value>=1280?(p(),b("div",Vt,[e("div",Rt,[e("span",$t,u(i(_)("reports.activeColumns")),1),e("span",Mt,u(r.value.length),1)]),e("div",Yt,[(p(!0),b(x,null,M(r.value,(a,R)=>(p(),b("div",{key:a.prop,class:"reports__net_item",draggable:"true",onDragstart:y=>_e(R),onDragover:ce,onDrop:y=>de(R)},[o(te,{closable:"","disable-transitions":!1,onClose:y=>q(a),onClick:y=>q(a),class:"reports__available_tag reports__available_grab"},{default:d(()=>[o(l,{class:"reports__drag"},{default:d(()=>[o(fe)]),_:1}),w(" "+u(a.label),1)]),_:2},1032,["onClose","onClick"])],40,It))),128)),r.value.length===0?(p(),b("div",Et,[o(ye,{description:i(_)("reports.addColumns"),"image-size":60},null,8,["description"])])):Y("",!0)])])):Y("",!0),e("div",Tt,[e("div",Bt,[e("span",Pt,u(i(_)("reports.reportData")),1),f.value.length>0?(p(),b("span",Ft,u(f.value.length),1)):Y("",!0)]),Pe((p(),C(we,{data:f.value,border:"",stripe:"",style:{width:"100%"},"empty-text":i(_)("table.noData"),class:"reports__table_element"},{default:d(()=>[(p(!0),b(x,null,M(r.value,a=>(p(),C(ke,{key:a.prop,prop:a.prop,label:a.label,"min-width":a.width,sortable:a.sortable},null,8,["prop","label","min-width","sortable"]))),128))]),_:1},8,["data","empty-text"])),[[Ce,S.value]]),f.value.length>0?(p(),b("div",Lt,[o(De,{"page-size":10,"pager-count":5,layout:"total, prev, pager, next",total:f.value.length,"hide-on-single-page":!0,class:"reports__pagination"},null,8,["total"])])):Y("",!0)]),o($e)])])])])])),e("div",{class:F(["overlay_full",{active:D.value}]),onClick:t[5]||(t[5]=a=>D.value=!1)},null,2),e("div",{class:F(["reset_popup popup popup__small",{active:D.value}])},[e("div",Ot,[e("div",Ut,[e("button",{class:"reset_popup__close popup__close",onClick:t[6]||(t[6]=a=>D.value=!1)},[o(l,null,{default:d(()=>[o(oe)]),_:1})]),e("h4",At,u(i(_)("reports.resetTable")),1),e("p",zt,u(i(_)("reports.resetMessage")),1)])]),e("div",Wt,[e("button",{class:"popup__button button__second button",onClick:t[7]||(t[7]=a=>D.value=!1)},[e("span",null,u(i(_)("button.cancel")),1)]),e("button",{class:"popup__button button__primary button",onClick:me},[e("span",null,u(i(_)("button.clear")),1)])])],2),e("div",{class:F(["overlay_full",{active:W.value}]),onClick:j},null,2),e("div",{class:F(["ipopup popup",{active:L.value}])},[e("div",jt,[e("div",qt,[e("button",{class:"ipopup__close popup__close",onClick:j},[o(l,null,{default:d(()=>[o(oe)]),_:1})]),o(Re)])])],2),o(Se)],64)}}}),Rs=Ye(Qt,[["__scopeId","data-v-c698c305"]]);export{Rs as default};
